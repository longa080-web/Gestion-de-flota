<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventario y Gesti贸n de Flota</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <!-- Versi贸n estable de Tailwind -->
    <script src="https://cdn.tailwindcss.com/3.3.0"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- jsPDF para generaci贸n de PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <!-- Firebase - Cargar de forma global -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            -webkit-text-size-adjust: 100%;
        }
        .bg-inter-primary { background-color: #005BAA; }
        .bg-inter-accent-light { background-color: #5CE1E6; }
        .bg-inter-accent-yellow { background-color: #FDD000; }
        .text-inter-primary { color: #005BAA; }
        
        /* Tabs responsivos */
        .tabs-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: thin;
        }
        .tabs-container::-webkit-scrollbar {
            height: 6px;
        }
        .tabs-container::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .tabs-container::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }
        
        .tab-link {
            white-space: nowrap;
            min-width: fit-content;
        }
        .tab-link.active span { 
            border-bottom-color: #005BAA; 
            color: #005BAA; 
        }
        
        /* Estilos para el sistema de pagos */
        .estado-pagado {
            background-color: #dcfce7;
            color: #166534;
            font-weight: 600;
        }

        .estado-pendiente {
            background-color: #fef3c7;
            color: #92400e;
            font-weight: 600;
        }

        .badge-pagado {
            background-color: #10b981;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }

        .badge-pendiente {
            background-color: #f59e0b;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }

        /* Responsive */
        .responsive-table {
            display: block;
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .form-grid {
            display: grid;
            gap: 1rem;
        }
        
        @media (min-width: 768px) {
            .form-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (min-width: 1024px) {
            .form-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        /* ESTILOS MEJORADOS PARA PDF - VERSIN CORREGIDA */
        .pdf-report {
            font-family: 'Arial', 'Helvetica', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            box-sizing: border-box;
        }
        
        .pdf-report h1 {
            color: #005BAA;
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 3px solid #005BAA;
            padding-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .pdf-report h2 {
            color: #005BAA;
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 25px;
            border-bottom: 2px solid #005BAA;
            padding-bottom: 10px;
            text-align: left;
        }

        /* Estilos mejorados para tablas PDF */
        .pdf-report table {
            width: 100%;
            border-collapse: collapse;
            border: 2px solid #000;
            margin-bottom: 40px;
            table-layout: fixed;
            background-color: white;
        }

        .pdf-report th {
            background-color: #e5e7eb;
            font-weight: bold;
            text-align: center;
            vertical-align: middle;
            padding: 15px 10px;
            border: 1px solid #000;
            font-size: 14px;
        }

        .pdf-report td {
            border: 1px solid #000;
            padding: 12px 10px;
            vertical-align: top;
            font-size: 13px;
        }

        .pdf-report .total-row {
            background-color: #e5e7eb;
            font-weight: bold;
        }

        .pdf-report .centro-total {
            font-size: 18px;
            font-weight: bold;
            color: #005BAA;
        }

        .pdf-report .resumen-table {
            width: 70%;
            margin: 0 auto;
            border-collapse: collapse;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .pdf-report .fecha-generacion {
            margin-top: 40px;
            text-align: right;
            font-size: 11px;
            color: #666;
            border-top: 1px solid #ccc;
            padding-top: 20px;
        }

        /* Estilos para el contenedor temporal de PDF */
        #temp-pdf-container {
            position: absolute;
            left: -9999px;
            top: 0;
            width: 1200px;
            background: white;
            padding: 40px;
            font-family: 'Arial', 'Helvetica', sans-serif;
            line-height: 1.5;
            box-sizing: border-box;
        }

        #temp-pdf-container table {
            page-break-inside: avoid;
        }

        /* Estilos para vista previa */
        #contenidoReporteMensual {
            font-family: 'Arial', 'Helvetica', sans-serif;
            background: white;
            padding: 20px;
            border-radius: 8px;
        }
    </style>
</head>
<body class="bg-gray-100">

    <header class="bg-inter-primary text-white p-4 shadow-md">
        <div class="container mx-auto flex flex-col md:flex-row justify-between items-center">
            <h1 class="text-xl font-bold">Gesti贸n de Flota</h1>
            <div class="flex items-center space-x-4">
                <span id="syncStatus" class="text-sm bg-green-500 px-2 py-1 rounded">Conectado</span>
                <button id="syncButton" class="bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700">
                    Sincronizar
                </button>
                <div id="totalPendienteBadge" class="hidden bg-red-500 text-white px-3 py-1 rounded text-sm">
                    Pendiente: $0.00
                </div>
            </div>
        </div>
    </header>

    <main class="container mx-auto p-4 md:p-6">
        <div class="bg-white p-4 md:p-6 rounded-lg shadow-md mb-6">
            <!-- Tabs -->
            <div class="tabs-container flex border-b border-gray-200">
                <button class="tab-link active focus:outline-none p-3 md:p-4" data-tab-id="vehiculos">
                    <span class="font-medium text-sm md:text-lg border-b-2 border-transparent pb-2 md:pb-4">Veh铆culos</span>
                </button>
                <button class="tab-link focus:outline-none p-3 md:p-4" data-tab-id="mantenimientos">
                    <span class="font-medium text-sm md:text-lg border-b-2 border-transparent pb-2 md:pb-4">Mantenimientos</span>
                </button>
                <button class="tab-link focus:outline-none p-3 md:p-4" data-tab-id="inspeccion">
                    <span class="font-medium text-sm md:text-lg border-b-2 border-transparent pb-2 md:pb-4">Inspecci贸n</span>
                </button>
                <button class="tab-link focus:outline-none p-3 md:p-4" data-tab-id="combustible">
                    <span class="font-medium text-sm md:text-lg border-b-2 border-transparent pb-2 md:pb-4">Combustible</span>
                </button>
                <button class="tab-link focus:outline-none p-3 md:p-4" data-tab-id="siniestros">
                    <span class="font-medium text-sm md:text-lg border-b-2 border-transparent pb-2 md:pb-4">Siniestros</span>
                </button>
                <button class="tab-link focus:outline-none p-3 md:p-4" data-tab-id="lavado">
                    <span class="font-medium text-sm md:text-lg border-b-2 border-transparent pb-2 md:pb-4">Lavado</span>
                </button>
                <button class="tab-link focus:outline-none p-3 md:p-4" data-tab-id="gasoil-head-end">
                    <span class="font-medium text-sm md:text-lg border-b-2 border-transparent pb-2 md:pb-4">Gasoil</span>
                </button>
                <button class="tab-link focus:outline-none p-3 md:p-4" data-tab-id="reportes">
                    <span class="font-medium text-sm md:text-lg border-b-2 border-transparent pb-2 md:pb-4">Reportes</span>
                </button>
                <button class="tab-link focus:outline-none p-3 md:p-4" data-tab-id="reporte-mensual-pdf">
                    <span class="font-medium text-sm md:text-lg border-b-2 border-transparent pb-2 md:pb-4"> Reporte Mensual</span>
                </button>
            </div>

            <div id="tab-content" class="mt-4 md:mt-6">
                <!-- ========== PESTAA DE VEHCULOS ========== -->
                <div id="vehiculos" class="tab-pane">
                    <!-- Contenido de veh铆culos -->
                    <h2 class="text-xl font-semibold text-inter-primary mb-4">Registro de Veh铆culos</h2>
                    <form id="vehicleForm" class="form-grid mb-6">
                        <input type="hidden" id="vehicleId">
                        <div>
                            <label for="placa" class="block text-sm font-medium text-gray-700">Placa</label>
                            <input type="text" id="placa" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2" required>
                        </div>
                        <div>
                            <label for="marca" class="block text-sm font-medium text-gray-700">Marca</label>
                            <input type="text" id="marca" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2" required>
                        </div>
                        <div>
                            <label for="modelo" class="block text-sm font-medium text-gray-700">Modelo</label>
                            <input type="text" id="modelo" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2" required>
                        </div>
                        <div>
                            <label for="anio" class="block text-sm font-medium text-gray-700">A帽o</label>
                            <input type="number" id="anio" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2" required>
                        </div>
                        <div>
                            <label for="centroOperaciones" class="block text-sm font-medium text-gray-700">Centro de Operaciones</label>
                            <input list="centroOperacionesList" id="centroOperaciones" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2" required>
                            <datalist id="centroOperacionesList">
                                <option value="MSO">
                                <option value="UN CCS">
                            </datalist>
                        </div>
                        <div>
                            <label for="capacidadTanque" class="block text-sm font-medium text-gray-700">Capacidad Tanque</label>
                            <input type="number" id="capacidadTanque" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2">
                        </div>
                        <div>
                            <label for="departamentoAsignado" class="block text-sm font-medium text-gray-700">Departamento Asignado</label>
                            <input type="text" id="departamentoAsignado" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2">
                        </div>
                        <div>
                            <label for="estado" class="block text-sm font-medium text-gray-700">Estado</label>
                            <input type="text" id="estado" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2">
                        </div>
                        <div class="col-span-full flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-2">
                            <button type="submit" class="bg-inter-primary text-white font-bold py-2 px-4 rounded-md shadow hover:bg-inter-accent-light hover:text-inter-primary transition duration-300 flex-1">
                                Guardar Veh铆culo
                            </button>
                            <button type="button" id="deleteMassiveBtn" class="bg-red-600 text-white font-bold py-2 px-4 rounded-md shadow hover:bg-red-700 transition duration-300 flex-1">
                                Eliminar Todos
                            </button>
                        </div>
                    </form>

                    <div class="flex flex-col md:flex-row md:justify-between md:items-center mb-4 space-y-2 md:space-y-0">
                        <div class="flex items-center">
                            <input type="file" id="importVehicleFile" accept=".xlsx, .xls, .csv" class="hidden">
                            <button id="importVehicleBtn" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-md shadow hover:bg-blue-700 transition duration-300">
                                Importar
                            </button>
                        </div>
                        <div class="flex-1 md:mx-4">
                            <input type="text" id="searchVehicleInput" placeholder="Buscar veh铆culo..." class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-inter-primary">
                        </div>
                        <button id="exportVehicleBtn" class="bg-green-600 text-white font-bold py-2 px-4 rounded-md shadow hover:bg-green-700 transition duration-300">
                            Exportar Excel
                        </button>
                    </div>

                    <div class="responsive-table">
                        <table class="min-w-full bg-white border border-gray-200" id="vehicleTable">
                            <thead>
                                <tr class="bg-gray-200 text-gray-600 uppercase text-xs md:text-sm leading-normal">
                                    <th class="py-3 px-4 md:px-6 text-left">Placa</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Marca</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Modelo</th>
                                    <th class="py-3 px-4 md:px-6 text-left">A帽o</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Centro</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Cap. Tanque</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Departamento</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Estado</th>
                                    <th class="py-3 px-4 md:px-6 text-center">Acciones</th>
                                </tr>
                            </thead>
                            <tbody class="text-gray-600 text-xs md:text-sm font-light" id="vehicleTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- ========== PESTAA DE MANTENIMIENTOS ========== -->
                <div id="mantenimientos" class="tab-pane hidden">
                    <h2 class="text-xl font-semibold text-inter-primary mb-4">Registro de Mantenimientos</h2>
                    <form id="maintenanceForm" class="form-grid mb-6">
                        <input type="hidden" id="maintenanceId">
                        <div>
                            <label for="placaMantenimiento" class="block text-sm font-medium text-gray-700">Placa</label>
                            <input list="placasList" id="placaMantenimiento" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2" required>
                            <datalist id="placasList"></datalist>
                        </div>
                        <div>
                            <label for="tipoMantenimiento" class="block text-sm font-medium text-gray-700">Tipo</label>
                            <select id="tipoMantenimiento" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2" required>
                                <option value="" disabled selected>Seleccione</option>
                                <option value="preventivo">Preventivo</option>
                                <option value="correctivo">Correctivo</option>
                            </select>
                        </div>
                        <div>
                            <label for="estadoPagoMantenimiento" class="block text-sm font-medium text-gray-700">Estado de Pago</label>
                            <select id="estadoPagoMantenimiento" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2" required>
                                <option value="pendiente">Pendiente</option>
                                <option value="pagado">Pagado</option>
                            </select>
                        </div>
                        <div id="camposPreventivo" class="hidden">
                            <label for="kilometrajePreventivo" class="block text-sm font-medium text-gray-700">Kilometraje</label>
                            <input type="number" id="kilometrajePreventivo" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2">
                            <label for="descripcionPreventivo" class="block text-sm font-medium text-gray-700 mt-2">Descripci贸n</label>
                            <textarea id="descripcionPreventivo" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2"></textarea>
                        </div>
                        <div id="camposCorrectivo" class="hidden">
                            <label for="descripcionCorrectivo" class="block text-sm font-medium text-gray-700">Descripci贸n</label>
                            <textarea id="descripcionCorrectivo" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2"></textarea>
                            <label for="causaCorrectivo" class="block text-sm font-medium text-gray-700 mt-2">Causa</label>
                            <input type="text" id="causaCorrectivo" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2">
                        </div>
                        <div>
                            <label for="fechaMantenimiento" class="block text-sm font-medium text-gray-700">Fecha</label>
                            <input type="date" id="fechaMantenimiento" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2" required>
                        </div>
                        <div>
                            <label for="costoMantenimiento" class="block text-sm font-medium text-gray-700">Costo</label>
                            <input type="number" id="costoMantenimiento" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2" required>
                        </div>
                        <div>
                            <label for="proveedorTaller" class="block text-sm font-medium text-gray-700">Proveedor/Taller</label>
                            <input type="text" id="proveedorTaller" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2" required>
                        </div>
                        <div>
                            <label for="centroMantenimiento" class="block text-sm font-medium text-gray-700">Centro</label>
                            <select id="centroMantenimiento" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2" required>
                                <option value="" disabled selected>Seleccione</option>
                                <option value="MSO">MSO</option>
                                <option value="UN CCS">UN CCS</option>
                            </select>
                        </div>
                        <div class="col-span-full">
                            <button type="submit" class="bg-inter-primary text-white font-bold py-2 px-4 rounded-md shadow hover:bg-inter-accent-light hover:text-inter-primary transition duration-300">
                                Guardar Mantenimiento
                            </button>
                        </div>
                    </form>

                    <div class="flex flex-col md:flex-row md:justify-between md:items-center mb-4 space-y-2 md:space-y-0">
                        <div class="flex items-center">
                            <input type="file" id="importMaintenanceFile" accept=".xlsx, .xls, .csv" class="hidden">
                            <button id="importMaintenanceBtn" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-md shadow hover:bg-blue-700 transition duration-300">
                                Importar
                            </button>
                        </div>
                        <div class="flex-1 md:mx-4">
                            <input type="text" id="searchMaintenanceInput" placeholder="Buscar mantenimiento..." class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-inter-primary">
                        </div>
                        <div class="flex space-x-2">
                            <button id="togglePendientesMantenimiento" class="bg-yellow-500 text-white font-bold py-2 px-4 rounded-md shadow hover:bg-yellow-600 transition duration-300">
                                Solo Pendientes
                            </button>
                            <button id="exportMaintenanceBtn" class="bg-green-600 text-white font-bold py-2 px-4 rounded-md shadow hover:bg-green-700 transition duration-300">
                                Exportar
                            </button>
                        </div>
                    </div>

                    <div class="responsive-table">
                        <table class="min-w-full bg-white border border-gray-200" id="maintenanceTable">
                            <thead>
                                <tr class="bg-gray-200 text-gray-600 uppercase text-xs md:text-sm leading-normal">
                                    <th class="py-3 px-4 md:px-6 text-left">Placa</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Tipo</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Fecha</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Costo</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Proveedor</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Centro</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Estado</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Descripci贸n</th>
                                    <th class="py-3 px-4 md:px-6 text-center">Acciones</th>
                                </tr>
                            </thead>
                            <tbody class="text-gray-600 text-xs md:text-sm font-light" id="maintenanceTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- ========== PESTAA DE INSPECCIN ========== -->
                <div id="inspeccion" class="tab-pane hidden">
                    <!-- Contenido similar al original pero simplificado -->
                    <h2 class="text-xl font-semibold text-inter-primary mb-4">Inspecci贸n Pre-Operacional</h2>
                    <form id="inspectionForm" class="form-grid mb-6">
                        <input type="hidden" id="inspectionId">
                        <div>
                            <label for="placaInspeccion" class="block text-sm font-medium text-gray-700">Placa</label>
                            <input list="placasList" id="placaInspeccion" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2" required>
                        </div>
                        <div>
                            <label for="conductorInspeccion" class="block text-sm font-medium text-gray-700">Conductor</label>
                            <input type="text" id="conductorInspeccion" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2" required>
                        </div>
                        <div>
                            <label for="kilometrajeInspeccion" class="block text-sm font-medium text-gray-700">Kilometraje</label>
                            <input type="number" id="kilometrajeInspeccion" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2" required>
                        </div>
                        <div>
                            <label for="fechaInspeccion" class="block text-sm font-medium text-gray-700">Fecha</label>
                            <input type="date" id="fechaInspeccion" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2" required>
                        </div>
                        <div class="col-span-full">
                            <h3 class="text-md font-semibold text-gray-800 my-2">Chequeo</h3>
                            <div class="grid grid-cols-2 md:grid-cols-3 gap-2 md:gap-4">
                                <label class="flex items-center text-sm"><input type="checkbox" name="Luces" value="ok" class="mr-2">Luces</label>
                                <label class="flex items-center text-sm"><input type="checkbox" name="Limpiaparabrisas" value="ok" class="mr-2">Limpiaparabrisas</label>
                                <label class="flex items-center text-sm"><input type="checkbox" name="Liquido_de_frenos" value="ok" class="mr-2">L铆quido de frenos</label>
                                <label class="flex items-center text-sm"><input type="checkbox" name="Frenos" value="ok" class="mr-2">Frenos</label>
                                <label class="flex items-center text-sm"><input type="checkbox" name="Cauchos" value="ok" class="mr-2">Cauchos</label>
                                <label class="flex items-center text-sm"><input type="checkbox" name="Retrovisores" value="ok" class="mr-2">Retrovisores</label>
                                <label class="flex items-center text-sm"><input type="checkbox" name="Aire_acondicionado" value="ok" class="mr-2">Aire</label>
                                <label class="flex items-center text-sm"><input type="checkbox" name="Gato" value="ok" class="mr-2">Gato</label>
                                <label class="flex items-center text-sm"><input type="checkbox" name="Triangulo" value="ok" class="mr-2">Tri谩ngulo</label>
                                <label class="flex items-center text-sm"><input type="checkbox" name="Extintor" value="ok" class="mr-2">Extintor</label>
                                <label class="flex items-center text-sm"><input type="checkbox" name="Caucho_de_repuesto" value="ok" class="mr-2">Caucho repuesto</label>
                                <label class="flex items-center text-sm"><input type="checkbox" name="Documentos" value="ok" class="mr-2">Documentos</label>
                            </div>
                        </div>
                        <div class="col-span-full">
                            <label for="observacionesInspeccion" class="block text-sm font-medium text-gray-700">Observaciones</label>
                            <textarea id="observacionesInspeccion" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2"></textarea>
                        </div>
                        <div class="col-span-full">
                            <button type="submit" class="bg-inter-primary text-white font-bold py-2 px-4 rounded-md shadow hover:bg-inter-accent-light hover:text-inter-primary transition duration-300">
                                Guardar Inspecci贸n
                            </button>
                        </div>
                    </form>
                    
                    <div class="flex flex-col md:flex-row md:justify-between md:items-center mb-4 space-y-2 md:space-y-0">
                        <div class="flex items-center">
                            <input type="file" id="importInspectionFile" accept=".xlsx, .xls, .csv" class="hidden">
                            <button id="importInspectionBtn" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-md shadow hover:bg-blue-700 transition duration-300">
                                Importar
                            </button>
                        </div>
                        <div class="flex-1 md:mx-4">
                            <input type="text" id="searchInspectionInput" placeholder="Buscar inspecci贸n..." class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-inter-primary">
                        </div>
                        <button id="exportInspectionBtn" class="bg-green-600 text-white font-bold py-2 px-4 rounded-md shadow hover:bg-green-700 transition duration-300">
                            Exportar
                        </button>
                    </div>

                    <div class="responsive-table">
                        <table class="min-w-full bg-white border border-gray-200" id="inspectionTable">
                            <thead>
                                <tr class="bg-gray-200 text-gray-600 uppercase text-xs md:text-sm leading-normal">
                                    <th class="py-3 px-4 md:px-6 text-left">Placa</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Conductor</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Kilometraje</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Fecha</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Chequeo</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Observaciones</th>
                                    <th class="py-3 px-4 md:px-6 text-center">Acciones</th>
                                </tr>
                            </thead>
                            <tbody class="text-gray-600 text-xs md:text-sm font-light" id="inspectionTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- ========== PESTAA DE COMBUSTIBLE ========== -->
                <div id="combustible" class="tab-pane hidden">
                    <h2 class="text-xl font-semibold text-inter-primary mb-4">Control de Combustible</h2>
                    <form id="fuelForm" class="form-grid mb-6">
                        <input type="hidden" id="fuelId">
                        <div>
                            <label for="placaCombustible" class="block text-sm font-medium text-gray-700">Placa</label>
                            <input list="placasList" id="placaCombustible" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2" required>
                        </div>
                        <div>
                            <label for="estadoPagoCombustible" class="block text-sm font-medium text-gray-700">Estado de Pago</label>
                            <select id="estadoPagoCombustible" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2" required>
                                <option value="pendiente">Pendiente</option>
                                <option value="pagado">Pagado</option>
                            </select>
                        </div>
                        <div>
                            <label for="fechaCombustible" class="block text-sm font-medium text-gray-700">Fecha</label>
                            <input type="date" id="fechaCombustible" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2" required>
                        </div>
                        <div>
                            <label for="litros" class="block text-sm font-medium text-gray-700">Litros</label>
                            <input type="number" id="litros" step="0.01" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2" required>
                        </div>
                        <div>
                            <label for="costoCombustible" class="block text-sm font-medium text-gray-700">Costo</label>
                            <input type="number" id="costoCombustible" step="0.01" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2" readonly>
                        </div>
                        <div>
                            <label for="centroCombustible" class="block text-sm font-medium text-gray-700">Centro</label>
                            <select id="centroCombustible" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2" required>
                                <option value="" disabled selected>Seleccione</option>
                                <option value="MSO">MSO</option>
                                <option value="UN CCS">UN CCS</option>
                            </select>
                        </div>
                        <div class="col-span-full">
                            <button type="submit" class="bg-inter-primary text-white font-bold py-2 px-4 rounded-md shadow hover:bg-inter-accent-light hover:text-inter-primary transition duration-300">
                                Guardar Combustible
                            </button>
                        </div>
                    </form>

                    <div class="flex flex-col md:flex-row md:justify-between md:items-center mb-4 space-y-2 md:space-y-0">
                        <div class="flex items-center">
                            <input type="file" id="importFuelFile" accept=".xlsx, .xls, .csv" class="hidden">
                            <button id="importFuelBtn" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-md shadow hover:bg-blue-700 transition duration-300">
                                Importar
                            </button>
                        </div>
                        <div class="flex-1 md:mx-4">
                            <input type="text" id="searchFuelInput" placeholder="Buscar combustible..." class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-inter-primary">
                        </div>
                        <div class="flex space-x-2">
                            <button id="togglePendientesCombustible" class="bg-yellow-500 text-white font-bold py-2 px-4 rounded-md shadow hover:bg-yellow-600 transition duration-300">
                                Solo Pendientes
                            </button>
                            <button id="exportFuelBtn" class="bg-green-600 text-white font-bold py-2 px-4 rounded-md shadow hover:bg-green-700 transition duration-300">
                                Exportar
                            </button>
                        </div>
                    </div>

                    <div class="responsive-table">
                        <table class="min-w-full bg-white border border-gray-200" id="fuelTable">
                            <thead>
                                <tr class="bg-gray-200 text-gray-600 uppercase text-xs md:text-sm leading-normal">
                                    <th class="py-3 px-4 md:px-6 text-left">Placa</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Fecha</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Litros</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Costo</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Centro</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Estado</th>
                                    <th class="py-3 px-4 md:px-6 text-center">Acciones</th>
                                </tr>
                            </thead>
                            <tbody class="text-gray-600 text-xs md:text-sm font-light" id="fuelTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- ========== PESTAA DE SINIESTROS ========== -->
                <div id="siniestros" class="tab-pane hidden">
                    <h2 class="text-xl font-semibold text-inter-primary mb-4">Registro de Siniestros</h2>
                    <form id="siniestroForm" class="form-grid mb-6">
                        <input type="hidden" id="siniestroId">
                        <div>
                            <label for="placaSiniestro" class="block text-sm font-medium text-gray-700">Placa</label>
                            <input list="placasList" id="placaSiniestro" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2" required>
                        </div>
                        <div>
                            <label for="fechaHoraSiniestro" class="block text-sm font-medium text-gray-700">Fecha y Hora</label>
                            <input type="datetime-local" id="fechaHoraSiniestro" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2" required>
                        </div>
                        <div>
                            <label for="conductorSiniestro" class="block text-sm font-medium text-gray-700">Conductor</label>
                            <input type="text" id="conductorSiniestro" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2" required>
                        </div>
                        <div>
                            <label for="polizaSiniestro" class="block text-sm font-medium text-gray-700">N煤mero de P贸liza</label>
                            <input type="text" id="polizaSiniestro" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2" required>
                        </div>
                        <div>
                            <label for="lugarSiniestro" class="block text-sm font-medium text-gray-700">Lugar</label>
                            <input type="text" id="lugarSiniestro" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2" required>
                        </div>
                        <div class="col-span-full">
                            <label for="descripcionSiniestro" class="block text-sm font-medium text-gray-700">Descripci贸n</label>
                            <textarea id="descripcionSiniestro" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2" required></textarea>
                        </div>
                        <div>
                            <label for="costoReparacion" class="block text-sm font-medium text-gray-700">Costo</label>
                            <input type="number" id="costoReparacion" step="0.01" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2" required>
                        </div>
                        <div>
                            <label for="centroSiniestro" class="block text-sm font-medium text-gray-700">Centro</label>
                            <select id="centroSiniestro" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2" required>
                                <option value="" disabled selected>Seleccione</option>
                                <option value="MSO">MSO</option>
                                <option value="UN CCS">UN CCS</option>
                            </select>
                        </div>
                        <div class="col-span-full">
                            <button type="submit" class="bg-inter-primary text-white font-bold py-2 px-4 rounded-md shadow hover:bg-inter-accent-light hover:text-inter-primary transition duration-300">
                                Guardar Siniestro
                            </button>
                        </div>
                    </form>

                    <div class="flex flex-col md:flex-row md:justify-between md:items-center mb-4 space-y-2 md:space-y-0">
                        <div class="flex items-center">
                            <input type="file" id="importSiniestroFile" accept=".xlsx, .xls, .csv" class="hidden">
                            <button id="importSiniestroBtn" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-md shadow hover:bg-blue-700 transition duration-300">
                                Importar
                            </button>
                        </div>
                        <div class="flex-1 md:mx-4">
                            <input type="text" id="searchSiniestroInput" placeholder="Buscar siniestro..." class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-inter-primary">
                        </div>
                        <button id="exportSiniestroBtn" class="bg-green-600 text-white font-bold py-2 px-4 rounded-md shadow hover:bg-green-700 transition duration-300">
                            Exportar
                        </button>
                    </div>

                    <div class="responsive-table">
                        <table class="min-w-full bg-white border border-gray-200" id="siniestroTable">
                            <thead>
                                <tr class="bg-gray-200 text-gray-600 uppercase text-xs md:text-sm leading-normal">
                                    <th class="py-3 px-4 md:px-6 text-left">Placa</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Fecha/Hora</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Conductor</th>
                                    <th class="py-3 px-4 md:px-6 text-left">P贸liza</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Lugar</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Descripci贸n</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Costo</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Centro</th>
                                    <th class="py-3 px-4 md:px-6 text-center">Acciones</th>
                                </tr>
                            </thead>
                            <tbody class="text-gray-600 text-xs md:text-sm font-light" id="siniestroTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- ========== PESTAA DE LAVADO ========== -->
                <div id="lavado" class="tab-pane hidden">
                    <h2 class="text-xl font-semibold text-inter-primary mb-4">Lavado de autos</h2>
                    <form id="lavadoForm" class="form-grid mb-6">
                        <input type="hidden" id="lavadoId">
                        <div>
                            <label for="placaLavado" class="block text-sm font-medium text-gray-700">Placa</label>
                            <input list="placasList" id="placaLavado" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2" required>
                        </div>
                        <div>
                            <label for="estadoPagoLavado" class="block text-sm font-medium text-gray-700">Estado de Pago</label>
                            <select id="estadoPagoLavado" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2" required>
                                <option value="pendiente">Pendiente</option>
                                <option value="pagado">Pagado</option>
                            </select>
                        </div>
                        <div>
                            <label for="fechaLavado" class="block text-sm font-medium text-gray-700">Fecha</label>
                            <input type="date" id="fechaLavado" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2" required>
                        </div>
                        <div>
                            <label for="costoLavado" class="block text-sm font-medium text-gray-700">Costo</label>
                            <input type="number" id="costoLavado" step="0.01" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2" required>
                        </div>
                        <div>
                            <label for="centroLavado" class="block text-sm font-medium text-gray-700">Centro</label>
                            <select id="centroLavado" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2" required>
                                <option value="" disabled selected>Seleccione</option>
                                <option value="MSO">MSO</option>
                                <option value="UN CCS">UN CCS</option>
                            </select>
                        </div>
                        <div class="col-span-full">
                            <button type="submit" class="bg-inter-primary text-white font-bold py-2 px-4 rounded-md shadow hover:bg-inter-accent-light hover:text-inter-primary transition duration-300">
                                Guardar Lavado
                            </button>
                        </div>
                    </form>

                    <div class="flex flex-col md:flex-row md:justify-between md:items-center mb-4 space-y-2 md:space-y-0">
                        <div class="flex items-center">
                            <input type="file" id="importLavadoFile" accept=".xlsx, .xls, .csv" class="hidden">
                            <button id="importLavadoBtn" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-md shadow hover:bg-blue-700 transition duration-300">
                                Importar
                            </button>
                        </div>
                        <div class="flex-1 md:mx-4">
                            <input type="text" id="searchLavadoInput" placeholder="Buscar lavado..." class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-inter-primary">
                        </div>
                        <div class="flex space-x-2">
                            <button id="togglePendientesLavado" class="bg-yellow-500 text-white font-bold py-2 px-4 rounded-md shadow hover:bg-yellow-600 transition duration-300">
                                Solo Pendientes
                            </button>
                            <button id="exportLavadoBtn" class="bg-green-600 text-white font-bold py-2 px-4 rounded-md shadow hover:bg-green-700 transition duration-300">
                                Exportar
                            </button>
                        </div>
                    </div>

                    <div class="responsive-table">
                        <table class="min-w-full bg-white border border-gray-200" id="lavadoTable">
                            <thead>
                                <tr class="bg-gray-200 text-gray-600 uppercase text-xs md:text-sm leading-normal">
                                    <th class="py-3 px-4 md:px-6 text-left">Placa</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Fecha</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Costo</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Centro</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Estado</th>
                                    <th class="py-3 px-4 md:px-6 text-center">Acciones</th>
                                </tr>
                            </thead>
                            <tbody class="text-gray-600 text-xs md:text-sm font-light" id="lavadoTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- ========== PESTAA DE GASOIL ========== -->
                <div id="gasoil-head-end" class="tab-pane hidden">
                    <h2 class="text-xl font-semibold text-inter-primary mb-4">Gasoil Head End</h2>
                    <form id="gasoilForm" class="form-grid mb-6">
                        <input type="hidden" id="gasoilId">
                        <div>
                            <label for="placaGasoil" class="block text-sm font-medium text-gray-700">Placa</label>
                            <input list="placasList" id="placaGasoil" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2" required>
                        </div>
                        <div>
                            <label for="estadoPagoGasoil" class="block text-sm font-medium text-gray-700">Estado de Pago</label>
                            <select id="estadoPagoGasoil" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2" required>
                                <option value="pendiente">Pendiente</option>
                                <option value="pagado">Pagado</option>
                            </select>
                        </div>
                        <div>
                            <label for="fechaGasoil" class="block text-sm font-medium text-gray-700">Fecha</label>
                            <input type="date" id="fechaGasoil" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2" required>
                        </div>
                        <div>
                            <label for="litrosGasoil" class="block text-sm font-medium text-gray-700">Litros</label>
                            <input type="number" id="litrosGasoil" step="0.01" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2" required>
                        </div>
                        <div>
                            <label for="fleteGasoil" class="block text-sm font-medium text-gray-700">Flete</label>
                            <input type="number" id="fleteGasoil" step="0.01" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2" required>
                        </div>
                        <div>
                            <label for="costoGasoil" class="block text-sm font-medium text-gray-700">Costo Total</label>
                            <input type="number" id="costoGasoil" step="0.01" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2" readonly>
                        </div>
                        <div>
                            <label for="centroGasoil" class="block text-sm font-medium text-gray-700">Centro</label>
                            <select id="centroGasoil" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2" required>
                                <option value="" disabled selected>Seleccione</option>
                                <option value="MSO">MSO</option>
                                <option value="UN CCS">UN CCS</option>
                            </select>
                        </div>
                        <div class="col-span-full">
                            <button type="submit" class="bg-inter-primary text-white font-bold py-2 px-4 rounded-md shadow hover:bg-inter-accent-light hover:text-inter-primary transition duration-300">
                                Guardar Gasoil
                            </button>
                        </div>
                    </form>

                    <div class="flex flex-col md:flex-row md:justify-between md:items-center mb-4 space-y-2 md:space-y-0">
                        <div class="flex items-center">
                            <input type="file" id="importGasoilFile" accept=".xlsx, .xls, .csv" class="hidden">
                            <button id="importGasoilBtn" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-md shadow hover:bg-blue-700 transition duration-300">
                                Importar
                            </button>
                        </div>
                        <div class="flex-1 md:mx-4">
                            <input type="text" id="searchGasoilInput" placeholder="Buscar gasoil..." class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-inter-primary">
                        </div>
                        <div class="flex space-x-2">
                            <button id="togglePendientesGasoil" class="bg-yellow-500 text-white font-bold py-2 px-4 rounded-md shadow hover:bg-yellow-600 transition duration-300">
                                Solo Pendientes
                            </button>
                            <button id="exportGasoilBtn" class="bg-green-600 text-white font-bold py-2 px-4 rounded-md shadow hover:bg-green-700 transition duration-300">
                                Exportar
                            </button>
                        </div>
                    </div>

                    <div class="responsive-table">
                        <table class="min-w-full bg-white border border-gray-200" id="gasoilTable">
                            <thead>
                                <tr class="bg-gray-200 text-gray-600 uppercase text-xs md:text-sm leading-normal">
                                    <th class="py-3 px-4 md:px-6 text-left">Placa</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Fecha</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Litros</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Flete</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Costo</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Centro</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Estado</th>
                                    <th class="py-3 px-4 md:px-6 text-center">Acciones</th>
                                </tr>
                            </thead>
                            <tbody class="text-gray-600 text-xs md:text-sm font-light" id="gasoilTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- ========== PESTAA DE REPORTES Y ESTADSTICAS ========== -->
                <div id="reportes" class="tab-pane hidden">
                    <h2 class="text-xl font-semibold text-inter-primary mb-4">Reportes y Estad铆sticas</h2>
                    
                    <div class="bg-white p-4 md:p-6 rounded-lg shadow-md mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-3">Filtros</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label for="reportYear" class="block text-sm font-medium text-gray-700">A帽o</label>
                                <select id="reportYear" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2">
                                </select>
                            </div>
                            <div>
                                <label for="reportMonth" class="block text-sm font-medium text-gray-700">Mes</label>
                                <select id="reportMonth" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2">
                                    <option value="all">Todos los meses</option>
                                    <option value="1">Enero</option>
                                    <option value="2">Febrero</option>
                                    <option value="3">Marzo</option>
                                    <option value="4">Abril</option>
                                    <option value="5">Mayo</option>
                                    <option value="6">Junio</option>
                                    <option value="7">Julio</option>
                                    <option value="8">Agosto</option>
                                    <option value="9">Septiembre</option>
                                    <option value="10">Octubre</option>
                                    <option value="11">Noviembre</option>
                                    <option value="12">Diciembre</option>
                                </select>
                            </div>
                            <div>
                                <label for="reportCenter" class="block text-sm font-medium text-gray-700">Centro</label>
                                <select id="reportCenter" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2">
                                    <option value="all">Todos los centros</option>
                                    <option value="MSO">MSO</option>
                                    <option value="UN CCS">UN CCS</option>
                                </select>
                            </div>
                        </div>
                        <div class="mt-4 flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-4">
                            <button id="applyFilters" class="bg-inter-primary text-white font-bold py-2 px-4 rounded-md shadow hover:bg-inter-accent-light hover:text-inter-primary transition duration-300">
                                Aplicar Filtros
                            </button>
                            <button id="mostrarSoloPendientesReporte" class="bg-yellow-500 text-white font-bold py-2 px-4 rounded-md shadow hover:bg-yellow-600 transition duration-300">
                                Solo Pendientes
                            </button>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                        <div class="bg-white p-4 md:p-6 rounded-lg shadow-md">
                            <h3 class="text-lg font-semibold text-gray-800 mb-2">Total MSO</h3>
                            <p class="text-2xl md:text-3xl font-bold text-inter-primary" id="totalMSO">$0</p>
                        </div>
                        <div class="bg-white p-4 md:p-6 rounded-lg shadow-md">
                            <h3 class="text-lg font-semibold text-gray-800 mb-2">Total UN CCS</h3>
                            <p class="text-2xl md:text-3xl font-bold text-inter-primary" id="totalUNCCS">$0</p>
                        </div>
                        <div class="bg-white p-4 md:p-6 rounded-lg shadow-md">
                            <h3 class="text-lg font-semibold text-gray-800 mb-2">Total Pendiente</h3>
                            <p class="text-2xl md:text-3xl font-bold text-yellow-600" id="totalPendiente">$0</p>
                        </div>
                        <div class="bg-white p-4 md:p-6 rounded-lg shadow-md">
                            <h3 class="text-lg font-semibold text-gray-800 mb-2">Total Pagado</h3>
                            <p class="text-2xl md:text-3xl font-bold text-green-600" id="totalPagado">$0</p>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <div class="bg-white p-4 md:p-6 rounded-lg shadow-md">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">Comparativa Mensual</h3>
                            <div style="position: relative; height: 300px;">
                                <canvas id="monthlyComparisonChart"></canvas>
                            </div>
                        </div>
                        <div class="bg-white p-4 md:p-6 rounded-lg shadow-md">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">Distribuci贸n de Gastos</h3>
                            <div style="position: relative; height: 300px;">
                                <canvas id="expenseDistributionChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ========== PESTAA DE REPORTE MENSUAL PDF - VERSIN CORREGIDA ========== -->
                <div id="reporte-mensual-pdf" class="tab-pane hidden">
                    <div class="bg-white p-4 md:p-6 rounded-lg shadow-md">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
                            <h2 class="text-2xl font-bold text-inter-primary mb-4 md:mb-0">
                                Relaci贸n de Gastos de Flota
                            </h2>
                            
                            <div class="flex flex-col sm:flex-row gap-4 items-end sm:items-center">
                                <div class="flex items-center gap-3">
                                    <div>
                                        <label for="reporteMes" class="block text-sm font-medium text-gray-700 mb-1">Mes</label>
                                        <select id="reporteMes" class="rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2">
                                            <option value="1">Enero</option>
                                            <option value="2">Febrero</option>
                                            <option value="3">Marzo</option>
                                            <option value="4">Abril</option>
                                            <option value="5">Mayo</option>
                                            <option value="6">Junio</option>
                                            <option value="7">Julio</option>
                                            <option value="8">Agosto</option>
                                            <option value="9">Septiembre</option>
                                            <option value="10">Octubre</option>
                                            <option value="11">Noviembre</option>
                                            <option value="12">Diciembre</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label for="reporteAnio" class="block text-sm font-medium text-gray-700 mb-1">A帽o</label>
                                        <select id="reporteAnio" class="rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2">
                                        </select>
                                    </div>
                                    <button id="btnGenerarReportePDF" class="bg-inter-primary text-white font-bold py-2 px-6 rounded-md shadow hover:bg-inter-accent-light hover:text-inter-primary transition duration-300 mt-5">
                                        <span class="flex items-center gap-2">
                                             Vista Previa
                                        </span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Contenedor con scroll para vista previa -->
                        <div id="vistaPreviaReporteMensual" class="border-2 border-gray-200 rounded-lg p-6 bg-white shadow-inner overflow-x-auto" style="max-height: 600px; overflow-y: auto;">
                            <div id="contenidoReporteMensual" class="font-sans" style="min-width: 1000px;">
                                <!-- El contenido se genera din谩micamente -->
                            </div>
                        </div>

                        <div class="mt-6 flex justify-end">
                            <button id="btnDescargarPDF" class="bg-green-600 text-white font-bold py-2 px-6 rounded-md shadow hover:bg-green-700 transition duration-300 flex items-center gap-2">
                                猬锔 Descargar PDF
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // ============ INICIALIZACIN DE FIREBASE ============
        const firebaseConfig = {
            apiKey: "AIzaSyCo5Q10ZQ42pwgGSS-v-yYmcoAxIo8vAoE",
            authDomain: "gestion-de-flota-5a657.firebaseapp.com",
            projectId: "gestion-de-flota-5a657",
            storageBucket: "gestion-de-flota-5a657.firebasestorage.app",
            messagingSenderId: "540590464439",
            appId: "1:540590464439:web:aa0a4d01209709a4821c32"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // ============ VARIABLES GLOBALES ============
        let vehicles = [];
        let maintenances = [];
        let inspections = [];
        let fuelRecords = [];
        let siniestros = [];
        let lavados = [];
        let gasoilRecords = [];

        // Variables para los gr谩ficos
        let monthlyComparisonChart = null;
        let expenseDistributionChart = null;

        // Variables para el control de pagos
        let mostrarSoloPendientes = {
            mantenimientos: false,
            combustible: false,
            lavados: false,
            gasoil: false
        };
        let mostrarSoloPendientesReporte = false;

        // Cargar datos de localStorage al iniciar
        function loadLocalData() {
            vehicles = JSON.parse(localStorage.getItem('vehicles')) || [];
            maintenances = JSON.parse(localStorage.getItem('maintenances')) || [];
            inspections = JSON.parse(localStorage.getItem('inspections')) || [];
            fuelRecords = JSON.parse(localStorage.getItem('fuelRecords')) || [];
            siniestros = JSON.parse(localStorage.getItem('siniestros')) || [];
            lavados = JSON.parse(localStorage.getItem('lavados')) || [];
            gasoilRecords = JSON.parse(localStorage.getItem('gasoilRecords')) || [];
        }

        // ============ FUNCIONES DE FIREBASE ============
        async function saveToFirebase(collectionName, data) {
            try {
                const docRef = await db.collection(collectionName).add({
                    ...data,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                console.log(` Guardado en Firebase: ${collectionName}`, docRef.id);
                return docRef.id;
            } catch (error) {
                console.error(` Error guardando en Firebase:`, error);
                return null;
            }
        }

        async function loadFromFirebase(collectionName) {
            try {
                const snapshot = await db.collection(collectionName).get();
                const data = [];
                snapshot.forEach(doc => {
                    data.push({
                        firebaseId: doc.id,
                        ...doc.data()
                    });
                });
                console.log(` Cargados ${data.length} registros de Firebase: ${collectionName}`);
                return data;
            } catch (error) {
                console.error(` Error cargando desde Firebase:`, error);
                return [];
            }
        }

        async function updateInFirebase(collectionName, docId, data) {
            try {
                await db.collection(collectionName).doc(docId).update({
                    ...data,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                console.log(` Actualizado en Firebase: ${collectionName}/${docId}`);
                return true;
            } catch (error) {
                console.error(` Error actualizando en Firebase:`, error);
                return false;
            }
        }

        async function deleteFromFirebase(collectionName, docId) {
            try {
                await db.collection(collectionName).doc(docId).delete();
                console.log(` Eliminado de Firebase: ${collectionName}/${docId}`);
                return true;
            } catch (error) {
                console.error(` Error eliminando de Firebase:`, error);
                return false;
            }
        }

        async function syncAllWithFirebase() {
            try {
                console.log(' Sincronizando con Firebase...');
                updateSyncStatus('loading', 'Sincronizando...');
                
                const [fbVehicles, fbMaintenances, fbInspections, fbFuel, fbSiniestros, fbLavados, fbGasoil] = await Promise.all([
                    loadFromFirebase('vehicles'),
                    loadFromFirebase('maintenances'),
                    loadFromFirebase('inspections'),
                    loadFromFirebase('fuelRecords'),
                    loadFromFirebase('siniestros'),
                    loadFromFirebase('lavados'),
                    loadFromFirebase('gasoilRecords')
                ]);

                if (fbVehicles.length > 0) vehicles = fbVehicles;
                if (fbMaintenances.length > 0) maintenances = fbMaintenances;
                if (fbInspections.length > 0) inspections = fbInspections;
                if (fbFuel.length > 0) fuelRecords = fbFuel;
                if (fbSiniestros.length > 0) siniestros = fbSiniestros;
                if (fbLavados.length > 0) lavados = fbLavados;
                if (fbGasoil.length > 0) gasoilRecords = fbGasoil;

                // Guardar en localStorage
                localStorage.setItem('vehicles', JSON.stringify(vehicles));
                localStorage.setItem('maintenances', JSON.stringify(maintenances));
                localStorage.setItem('inspections', JSON.stringify(inspections));
                localStorage.setItem('fuelRecords', JSON.stringify(fuelRecords));
                localStorage.setItem('siniestros', JSON.stringify(siniestros));
                localStorage.setItem('lavados', JSON.stringify(lavados));
                localStorage.setItem('gasoilRecords', JSON.stringify(gasoilRecords));

                // Actualizar todas las vistas
                loadAllData();
                updateReports();
                updateTotalPendienteHeader();
                actualizarVistaPreviaReporte();
                
                console.log(' Sincronizaci贸n completada');
                updateSyncStatus('success', 'Sincronizado');
            } catch (error) {
                console.error(' Error en sincronizaci贸n:', error);
                updateSyncStatus('error', 'Error');
            }
        }

        function updateSyncStatus(type, message) {
            const statusElement = document.getElementById('syncStatus');
            if (statusElement) {
                statusElement.textContent = message;
                statusElement.className = `text-sm px-2 py-1 rounded ${
                    type === 'success' ? 'bg-green-500 text-white' : 
                    type === 'error' ? 'bg-red-500 text-white' : 
                    'bg-yellow-500 text-white'
                }`;
            }
        }

        // ============ FUNCIONES DE UTILIDAD ============
        function formatearFecha(fechaInput) {
            try {
                if (!fechaInput) return 'N/A';
                const fecha = new Date(fechaInput);
                return fecha.toLocaleDateString('es-ES', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric'
                });
            } catch (error) {
                return fechaInput;
            }
        }

        function formatearFechaHora(fecha) {
            try {
                const date = new Date(fecha);
                return date.toLocaleDateString('es-ES', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            } catch (error) {
                return fecha;
            }
        }

        function ordenarPorFecha(datos, campoFecha = 'fecha') {
            return [...datos].sort((a, b) => {
                const fechaA = new Date(a[campoFecha] || a.fechaHora || a.fecha);
                const fechaB = new Date(b[campoFecha] || b.fechaHora || b.fecha);
                return fechaB - fechaA;
            });
        }

        function updatePlacasList() {
            const placasList = document.getElementById('placasList');
            if (placasList) {
                placasList.innerHTML = '';
                vehicles.forEach(vehicle => {
                    const option = document.createElement('option');
                    option.value = vehicle.placa;
                    placasList.appendChild(option);
                });
            }
        }

        // ============ FUNCIONES PARA VEHCULOS ============
        function setupVehicleForm() {
            const form = document.getElementById('vehicleForm');
            if (!form) return;

            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                const id = document.getElementById('vehicleId').value;
                const vehicle = {
                    placa: document.getElementById('placa').value.toUpperCase(),
                    marca: document.getElementById('marca').value,
                    modelo: document.getElementById('modelo').value,
                    anio: document.getElementById('anio').value,
                    centroOperaciones: document.getElementById('centroOperaciones').value,
                    capacidadTanque: document.getElementById('capacidadTanque').value || '',
                    departamentoAsignado: document.getElementById('departamentoAsignado').value || '',
                    estado: document.getElementById('estado').value || 'Operativo'
                };

                if (id === '') {
                    const firebaseId = await saveToFirebase('vehicles', vehicle);
                    if (firebaseId) vehicle.firebaseId = firebaseId;
                    vehicles.push(vehicle);
                } else {
                    if (vehicles[id]?.firebaseId) {
                        await updateInFirebase('vehicles', vehicles[id].firebaseId, vehicle);
                    }
                    vehicles[id] = vehicle;
                }

                localStorage.setItem('vehicles', JSON.stringify(vehicles));
                loadVehicleData();
                form.reset();
                document.getElementById('vehicleId').value = '';
                updateSyncStatus('success', 'Guardado');
            });

            document.getElementById('deleteMassiveBtn')?.addEventListener('click', async function() {
                if (confirm('驴Eliminar TODOS los veh铆culos? Esta acci贸n no se puede deshacer.')) {
                    for (const vehicle of vehicles) {
                        if (vehicle.firebaseId) {
                            await deleteFromFirebase('vehicles', vehicle.firebaseId);
                        }
                    }
                    vehicles = [];
                    localStorage.setItem('vehicles', JSON.stringify(vehicles));
                    loadVehicleData();
                    updateSyncStatus('success', 'Eliminados');
                }
            });
        }

        window.deleteVehicle = async function(index) {
            if (confirm('驴Eliminar este veh铆culo?')) {
                if (vehicles[index]?.firebaseId) {
                    await deleteFromFirebase('vehicles', vehicles[index].firebaseId);
                }
                vehicles.splice(index, 1);
                localStorage.setItem('vehicles', JSON.stringify(vehicles));
                loadVehicleData();
                updateSyncStatus('success', 'Eliminado');
            }
        };

        window.editVehicle = function(index) {
            const vehicle = vehicles[index];
            document.getElementById('vehicleId').value = index;
            document.getElementById('placa').value = vehicle.placa;
            document.getElementById('marca').value = vehicle.marca;
            document.getElementById('modelo').value = vehicle.modelo;
            document.getElementById('anio').value = vehicle.anio;
            document.getElementById('centroOperaciones').value = vehicle.centroOperaciones;
            document.getElementById('capacidadTanque').value = vehicle.capacidadTanque || '';
            document.getElementById('departamentoAsignado').value = vehicle.departamentoAsignado || '';
            document.getElementById('estado').value = vehicle.estado || '';
        };

        function loadVehicleData() {
            const tbody = document.getElementById('vehicleTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            vehicles.forEach((vehicle, index) => {
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-200 hover:bg-gray-100';
                row.innerHTML = `
                    <td class="py-3 px-4 md:px-6 text-left font-semibold">${vehicle.placa || ''}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${vehicle.marca || ''}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${vehicle.modelo || ''}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${vehicle.anio || ''}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${vehicle.centroOperaciones || ''}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${vehicle.capacidadTanque || 'N/A'}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${vehicle.departamentoAsignado || 'N/A'}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${vehicle.estado || 'N/A'}</td>
                    <td class="py-3 px-4 md:px-6 text-center">
                        <div class="flex flex-col md:flex-row md:space-x-1 space-y-1 md:space-y-0">
                            <button onclick="editVehicle(${index})" class="bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600 text-xs">Editar</button>
                            <button onclick="deleteVehicle(${index})" class="bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600 text-xs">Eliminar</button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
            updatePlacasList();
        }

        // ============ FUNCIONES PARA MANTENIMIENTOS ============
        function setupMaintenanceForm() {
            const form = document.getElementById('maintenanceForm');
            if (!form) return;

            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                const id = document.getElementById('maintenanceId').value;
                const tipo = document.getElementById('tipoMantenimiento').value;
                
                const maintenance = {
                    placa: document.getElementById('placaMantenimiento').value.toUpperCase(),
                    tipo: tipo,
                    fecha: document.getElementById('fechaMantenimiento').value,
                    costo: document.getElementById('costoMantenimiento').value,
                    proveedor: document.getElementById('proveedorTaller').value,
                    centro: document.getElementById('centroMantenimiento').value,
                    estadoPago: document.getElementById('estadoPagoMantenimiento').value,
                    descripcion: tipo === 'preventivo' ? 
                        document.getElementById('descripcionPreventivo').value : 
                        document.getElementById('descripcionCorrectivo').value,
                    kilometraje: tipo === 'preventivo' ? 
                        document.getElementById('kilometrajePreventivo').value : '',
                    causa: tipo === 'correctivo' ? 
                        document.getElementById('causaCorrectivo').value : ''
                };

                if (id === '') {
                    const firebaseId = await saveToFirebase('maintenances', maintenance);
                    if (firebaseId) maintenance.firebaseId = firebaseId;
                    maintenances.push(maintenance);
                } else {
                    if (maintenances[id]?.firebaseId) {
                        await updateInFirebase('maintenances', maintenances[id].firebaseId, maintenance);
                    }
                    maintenances[id] = maintenance;
                }

                localStorage.setItem('maintenances', JSON.stringify(maintenances));
                loadMaintenanceData();
                form.reset();
                document.getElementById('maintenanceId').value = '';
                updateReports();
                updateTotalPendienteHeader();
            });

            document.getElementById('tipoMantenimiento')?.addEventListener('change', function() {
                const tipo = this.value;
                document.getElementById('camposPreventivo').classList.add('hidden');
                document.getElementById('camposCorrectivo').classList.add('hidden');
                
                if (tipo === 'preventivo') {
                    document.getElementById('camposPreventivo').classList.remove('hidden');
                } else if (tipo === 'correctivo') {
                    document.getElementById('camposCorrectivo').classList.remove('hidden');
                }
            });

            document.getElementById('togglePendientesMantenimiento')?.addEventListener('click', function() {
                mostrarSoloPendientes.mantenimientos = !mostrarSoloPendientes.mantenimientos;
                this.textContent = mostrarSoloPendientes.mantenimientos ? 'Mostrar Todos' : 'Solo Pendientes';
                this.classList.toggle('bg-yellow-500', !mostrarSoloPendientes.mantenimientos);
                this.classList.toggle('bg-gray-500', mostrarSoloPendientes.mantenimientos);
                loadMaintenanceData();
            });
        }

        window.toggleEstadoPagoMantenimiento = async function(index) {
            if (index < 0 || index >= maintenances.length) return;
            const nuevoEstado = maintenances[index].estadoPago === 'pagado' ? 'pendiente' : 'pagado';
            
            if (confirm(`驴Cambiar estado a "${nuevoEstado.toUpperCase()}"?`)) {
                if (maintenances[index]?.firebaseId) {
                    await updateInFirebase('maintenances', maintenances[index].firebaseId, {
                        ...maintenances[index],
                        estadoPago: nuevoEstado
                    });
                }
                maintenances[index].estadoPago = nuevoEstado;
                localStorage.setItem('maintenances', JSON.stringify(maintenances));
                loadMaintenanceData();
                updateReports();
                updateTotalPendienteHeader();
            }
        };

        window.deleteMaintenance = async function(index) {
            if (confirm('驴Eliminar este mantenimiento?')) {
                if (maintenances[index]?.firebaseId) {
                    await deleteFromFirebase('maintenances', maintenances[index].firebaseId);
                }
                maintenances.splice(index, 1);
                localStorage.setItem('maintenances', JSON.stringify(maintenances));
                loadMaintenanceData();
                updateReports();
                updateTotalPendienteHeader();
            }
        };

        window.editMaintenance = function(index) {
            const m = maintenances[index];
            document.getElementById('maintenanceId').value = index;
            document.getElementById('placaMantenimiento').value = m.placa;
            document.getElementById('tipoMantenimiento').value = m.tipo;
            document.getElementById('fechaMantenimiento').value = m.fecha;
            document.getElementById('costoMantenimiento').value = m.costo;
            document.getElementById('proveedorTaller').value = m.proveedor;
            document.getElementById('centroMantenimiento').value = m.centro;
            document.getElementById('estadoPagoMantenimiento').value = m.estadoPago || 'pendiente';

            document.getElementById('tipoMantenimiento').dispatchEvent(new Event('change'));
            
            if (m.tipo === 'preventivo') {
                document.getElementById('kilometrajePreventivo').value = m.kilometraje || '';
                document.getElementById('descripcionPreventivo').value = m.descripcion || '';
            } else {
                document.getElementById('descripcionCorrectivo').value = m.descripcion || '';
                document.getElementById('causaCorrectivo').value = m.causa || '';
            }
        };

        function loadMaintenanceData() {
            const tbody = document.getElementById('maintenanceTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            let mantenimientosFiltrados = ordenarPorFecha(maintenances);
            
            if (mostrarSoloPendientes.mantenimientos) {
                mantenimientosFiltrados = mantenimientosFiltrados.filter(m => m.estadoPago === 'pendiente');
            }
            
            mantenimientosFiltrados.forEach((m, idx) => {
                const originalIndex = maintenances.findIndex(m2 => 
                    m2.placa === m.placa && m2.fecha === m.fecha && m2.costo === m.costo
                );
                
                const row = document.createElement('tr');
                row.className = `border-b border-gray-200 hover:bg-gray-100 ${m.estadoPago === 'pagado' ? 'estado-pagado' : 'estado-pendiente'}`;
                row.innerHTML = `
                    <td class="py-3 px-4 md:px-6 text-left font-semibold">${m.placa}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${m.tipo}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${formatearFecha(m.fecha)}</td>
                    <td class="py-3 px-4 md:px-6 text-left">$${parseFloat(m.costo).toFixed(2)}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${m.proveedor}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${m.centro}</td>
                    <td class="py-3 px-4 md:px-6 text-left">
                        <span class="${m.estadoPago === 'pagado' ? 'badge-pagado' : 'badge-pendiente'}">
                            ${m.estadoPago?.toUpperCase() || 'PENDIENTE'}
                        </span>
                    </td>
                    <td class="py-3 px-4 md:px-6 text-left">${m.descripcion?.substring(0, 30) || 'N/A'}</td>
                    <td class="py-3 px-4 md:px-6 text-center">
                        <div class="flex flex-col space-y-1">
                            <button onclick="editMaintenance(${originalIndex})" class="bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600 text-xs">Editar</button>
                            <button onclick="toggleEstadoPagoMantenimiento(${originalIndex})" class="bg-${m.estadoPago === 'pagado' ? 'yellow' : 'green'}-500 text-white px-2 py-1 rounded hover:bg-${m.estadoPago === 'pagado' ? 'yellow' : 'green'}-600 text-xs">
                                ${m.estadoPago === 'pagado' ? 'Pendiente' : 'Pagado'}
                            </button>
                            <button onclick="deleteMaintenance(${originalIndex})" class="bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600 text-xs">Eliminar</button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // ============ FUNCIONES PARA INSPECCIONES ============
        function setupInspectionForm() {
            const form = document.getElementById('inspectionForm');
            if (!form) return;

            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                const id = document.getElementById('inspectionId').value;
                
                const chequeo = {};
                document.querySelectorAll('#inspectionForm input[type="checkbox"]').forEach(checkbox => {
                    chequeo[checkbox.name] = checkbox.checked ? 'ok' : 'no';
                });

                const inspection = {
                    placa: document.getElementById('placaInspeccion').value.toUpperCase(),
                    conductor: document.getElementById('conductorInspeccion').value,
                    kilometraje: document.getElementById('kilometrajeInspeccion').value,
                    fecha: document.getElementById('fechaInspeccion').value,
                    chequeo: chequeo,
                    observaciones: document.getElementById('observacionesInspeccion').value
                };

                if (id === '') {
                    const firebaseId = await saveToFirebase('inspections', inspection);
                    if (firebaseId) inspection.firebaseId = firebaseId;
                    inspections.push(inspection);
                } else {
                    if (inspections[id]?.firebaseId) {
                        await updateInFirebase('inspections', inspections[id].firebaseId, inspection);
                    }
                    inspections[id] = inspection;
                }

                localStorage.setItem('inspections', JSON.stringify(inspections));
                loadInspectionData();
                form.reset();
                document.getElementById('inspectionId').value = '';
            });
        }

        window.editInspection = function(index) {
            const insp = inspections[index];
            document.getElementById('inspectionId').value = index;
            document.getElementById('placaInspeccion').value = insp.placa;
            document.getElementById('conductorInspeccion').value = insp.conductor;
            document.getElementById('kilometrajeInspeccion').value = insp.kilometraje;
            document.getElementById('fechaInspeccion').value = insp.fecha;
            document.getElementById('observacionesInspeccion').value = insp.observaciones || '';

            document.querySelectorAll('#inspectionForm input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = insp.chequeo?.[checkbox.name] === 'ok';
            });
        };

        window.deleteInspection = async function(index) {
            if (confirm('驴Eliminar esta inspecci贸n?')) {
                if (inspections[index]?.firebaseId) {
                    await deleteFromFirebase('inspections', inspections[index].firebaseId);
                }
                inspections.splice(index, 1);
                localStorage.setItem('inspections', JSON.stringify(inspections));
                loadInspectionData();
            }
        };

        function loadInspectionData() {
            const tbody = document.getElementById('inspectionTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            const inspeccionesOrdenadas = ordenarPorFecha(inspections);
            
            inspeccionesOrdenadas.forEach((insp, index) => {
                const checklistItems = Object.entries(insp.chequeo || {})
                    .filter(([k, v]) => v === 'ok')
                    .map(([k]) => k).join(', ');
                    
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-200 hover:bg-gray-100';
                row.innerHTML = `
                    <td class="py-3 px-4 md:px-6 text-left font-semibold">${insp.placa}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${insp.conductor}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${insp.kilometraje}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${formatearFecha(insp.fecha)}</td>
                    <td class="py-3 px-4 md:px-6 text-left text-xs">${checklistItems.substring(0, 50)}...</td>
                    <td class="py-3 px-4 md:px-6 text-left text-xs">${insp.observaciones?.substring(0, 50) || 'N/A'}</td>
                    <td class="py-3 px-4 md:px-6 text-center">
                        <div class="flex flex-col md:flex-row md:space-x-1 space-y-1">
                            <button onclick="editInspection(${index})" class="bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600 text-xs">Editar</button>
                            <button onclick="deleteInspection(${index})" class="bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600 text-xs">Eliminar</button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // ============ FUNCIONES PARA COMBUSTIBLE ============
        function setupFuelForm() {
            const form = document.getElementById('fuelForm');
            if (!form) return;

            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                const id = document.getElementById('fuelId').value;
                const litros = parseFloat(document.getElementById('litros').value) || 0;
                
                const fuel = {
                    placa: document.getElementById('placaCombustible').value.toUpperCase(),
                    fecha: document.getElementById('fechaCombustible').value,
                    litros: litros,
                    costo: litros * 0.50,
                    centro: document.getElementById('centroCombustible').value,
                    estadoPago: document.getElementById('estadoPagoCombustible').value
                };

                if (id === '') {
                    const firebaseId = await saveToFirebase('fuelRecords', fuel);
                    if (firebaseId) fuel.firebaseId = firebaseId;
                    fuelRecords.push(fuel);
                } else {
                    if (fuelRecords[id]?.firebaseId) {
                        await updateInFirebase('fuelRecords', fuelRecords[id].firebaseId, fuel);
                    }
                    fuelRecords[id] = fuel;
                }

                localStorage.setItem('fuelRecords', JSON.stringify(fuelRecords));
                loadFuelData();
                form.reset();
                document.getElementById('fuelId').value = '';
                updateReports();
                updateTotalPendienteHeader();
            });

            document.getElementById('litros')?.addEventListener('input', function() {
                const litros = parseFloat(this.value) || 0;
                document.getElementById('costoCombustible').value = (litros * 0.50).toFixed(2);
            });

            document.getElementById('togglePendientesCombustible')?.addEventListener('click', function() {
                mostrarSoloPendientes.combustible = !mostrarSoloPendientes.combustible;
                this.textContent = mostrarSoloPendientes.combustible ? 'Mostrar Todos' : 'Solo Pendientes';
                this.classList.toggle('bg-yellow-500', !mostrarSoloPendientes.combustible);
                this.classList.toggle('bg-gray-500', mostrarSoloPendientes.combustible);
                loadFuelData();
            });
        }

        window.toggleEstadoPagoCombustible = async function(index) {
            if (index < 0 || index >= fuelRecords.length) return;
            const nuevoEstado = fuelRecords[index].estadoPago === 'pagado' ? 'pendiente' : 'pagado';
            
            if (confirm(`驴Cambiar estado a "${nuevoEstado.toUpperCase()}"?`)) {
                if (fuelRecords[index]?.firebaseId) {
                    await updateInFirebase('fuelRecords', fuelRecords[index].firebaseId, {
                        ...fuelRecords[index],
                        estadoPago: nuevoEstado
                    });
                }
                fuelRecords[index].estadoPago = nuevoEstado;
                localStorage.setItem('fuelRecords', JSON.stringify(fuelRecords));
                loadFuelData();
                updateReports();
                updateTotalPendienteHeader();
            }
        };

        window.deleteFuel = async function(index) {
            if (confirm('驴Eliminar este registro?')) {
                if (fuelRecords[index]?.firebaseId) {
                    await deleteFromFirebase('fuelRecords', fuelRecords[index].firebaseId);
                }
                fuelRecords.splice(index, 1);
                localStorage.setItem('fuelRecords', JSON.stringify(fuelRecords));
                loadFuelData();
                updateReports();
                updateTotalPendienteHeader();
            }
        };

        window.editFuel = function(index) {
            const f = fuelRecords[index];
            document.getElementById('fuelId').value = index;
            document.getElementById('placaCombustible').value = f.placa;
            document.getElementById('fechaCombustible').value = f.fecha;
            document.getElementById('litros').value = f.litros;
            document.getElementById('costoCombustible').value = f.costo;
            document.getElementById('centroCombustible').value = f.centro;
            document.getElementById('estadoPagoCombustible').value = f.estadoPago || 'pendiente';
        };

        function loadFuelData() {
            const tbody = document.getElementById('fuelTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            let fuelFiltrados = ordenarPorFecha(fuelRecords);
            
            if (mostrarSoloPendientes.combustible) {
                fuelFiltrados = fuelFiltrados.filter(f => f.estadoPago === 'pendiente');
            }
            
            fuelFiltrados.forEach((f, idx) => {
                const originalIndex = fuelRecords.findIndex(f2 => 
                    f2.placa === f.placa && f2.fecha === f.fecha && f2.litros === f.litros
                );
                
                const row = document.createElement('tr');
                row.className = `border-b border-gray-200 hover:bg-gray-100 ${f.estadoPago === 'pagado' ? 'estado-pagado' : 'estado-pendiente'}`;
                row.innerHTML = `
                    <td class="py-3 px-4 md:px-6 text-left font-semibold">${f.placa}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${formatearFecha(f.fecha)}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${f.litros} L</td>
                    <td class="py-3 px-4 md:px-6 text-left">$${parseFloat(f.costo).toFixed(2)}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${f.centro}</td>
                    <td class="py-3 px-4 md:px-6 text-left">
                        <span class="${f.estadoPago === 'pagado' ? 'badge-pagado' : 'badge-pendiente'}">
                            ${f.estadoPago?.toUpperCase() || 'PENDIENTE'}
                        </span>
                    </td>
                    <td class="py-3 px-4 md:px-6 text-center">
                        <div class="flex flex-col space-y-1">
                            <button onclick="editFuel(${originalIndex})" class="bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600 text-xs">Editar</button>
                            <button onclick="toggleEstadoPagoCombustible(${originalIndex})" class="bg-${f.estadoPago === 'pagado' ? 'yellow' : 'green'}-500 text-white px-2 py-1 rounded hover:bg-${f.estadoPago === 'pagado' ? 'yellow' : 'green'}-600 text-xs">
                                ${f.estadoPago === 'pagado' ? 'Pendiente' : 'Pagado'}
                            </button>
                            <button onclick="deleteFuel(${originalIndex})" class="bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600 text-xs">Eliminar</button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // ============ FUNCIONES PARA SINIESTROS ============
        function setupSiniestroForm() {
            const form = document.getElementById('siniestroForm');
            if (!form) return;

            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                const id = document.getElementById('siniestroId').value;
                
                const siniestro = {
                    placa: document.getElementById('placaSiniestro').value.toUpperCase(),
                    fechaHora: document.getElementById('fechaHoraSiniestro').value,
                    conductor: document.getElementById('conductorSiniestro').value,
                    poliza: document.getElementById('polizaSiniestro').value,
                    lugar: document.getElementById('lugarSiniestro').value,
                    descripcion: document.getElementById('descripcionSiniestro').value,
                    costoReparacion: document.getElementById('costoReparacion').value,
                    centro: document.getElementById('centroSiniestro').value
                };

                if (id === '') {
                    const firebaseId = await saveToFirebase('siniestros', siniestro);
                    if (firebaseId) siniestro.firebaseId = firebaseId;
                    siniestros.push(siniestro);
                } else {
                    if (siniestros[id]?.firebaseId) {
                        await updateInFirebase('siniestros', siniestros[id].firebaseId, siniestro);
                    }
                    siniestros[id] = siniestro;
                }

                localStorage.setItem('siniestros', JSON.stringify(siniestros));
                loadSiniestroData();
                form.reset();
                document.getElementById('siniestroId').value = '';
                updateReports();
            });
        }

        window.editSiniestro = function(index) {
            const s = siniestros[index];
            document.getElementById('siniestroId').value = index;
            document.getElementById('placaSiniestro').value = s.placa;
            document.getElementById('fechaHoraSiniestro').value = s.fechaHora;
            document.getElementById('conductorSiniestro').value = s.conductor;
            document.getElementById('polizaSiniestro').value = s.poliza;
            document.getElementById('lugarSiniestro').value = s.lugar;
            document.getElementById('descripcionSiniestro').value = s.descripcion;
            document.getElementById('costoReparacion').value = s.costoReparacion;
            document.getElementById('centroSiniestro').value = s.centro;
        };

        window.deleteSiniestro = async function(index) {
            if (confirm('驴Eliminar este siniestro?')) {
                if (siniestros[index]?.firebaseId) {
                    await deleteFromFirebase('siniestros', siniestros[index].firebaseId);
                }
                siniestros.splice(index, 1);
                localStorage.setItem('siniestros', JSON.stringify(siniestros));
                loadSiniestroData();
                updateReports();
            }
        };

        function loadSiniestroData() {
            const tbody = document.getElementById('siniestroTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            const siniestrosOrdenados = ordenarPorFecha(siniestros, 'fechaHora');
            
            siniestrosOrdenados.forEach((s, index) => {
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-200 hover:bg-gray-100';
                row.innerHTML = `
                    <td class="py-3 px-4 md:px-6 text-left font-semibold">${s.placa}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${formatearFechaHora(s.fechaHora)}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${s.conductor}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${s.poliza}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${s.lugar.substring(0, 20)}...</td>
                    <td class="py-3 px-4 md:px-6 text-left text-xs">${s.descripcion.substring(0, 50)}...</td>
                    <td class="py-3 px-4 md:px-6 text-left">$${parseFloat(s.costoReparacion).toFixed(2)}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${s.centro}</td>
                    <td class="py-3 px-4 md:px-6 text-center">
                        <div class="flex flex-col md:flex-row space-y-1">
                            <button onclick="editSiniestro(${index})" class="bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600 text-xs">Editar</button>
                            <button onclick="deleteSiniestro(${index})" class="bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600 text-xs">Eliminar</button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // ============ FUNCIONES PARA LAVADOS ============
        function setupLavadoForm() {
            const form = document.getElementById('lavadoForm');
            if (!form) return;

            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                const id = document.getElementById('lavadoId').value;
                
                const lavado = {
                    placa: document.getElementById('placaLavado').value.toUpperCase(),
                    fecha: document.getElementById('fechaLavado').value,
                    costo: document.getElementById('costoLavado').value,
                    centro: document.getElementById('centroLavado').value,
                    estadoPago: document.getElementById('estadoPagoLavado').value
                };

                if (id === '') {
                    const firebaseId = await saveToFirebase('lavados', lavado);
                    if (firebaseId) lavado.firebaseId = firebaseId;
                    lavados.push(lavado);
                } else {
                    if (lavados[id]?.firebaseId) {
                        await updateInFirebase('lavados', lavados[id].firebaseId, lavado);
                    }
                    lavados[id] = lavado;
                }

                localStorage.setItem('lavados', JSON.stringify(lavados));
                loadLavadoData();
                form.reset();
                document.getElementById('lavadoId').value = '';
                updateReports();
                updateTotalPendienteHeader();
            });

            document.getElementById('togglePendientesLavado')?.addEventListener('click', function() {
                mostrarSoloPendientes.lavados = !mostrarSoloPendientes.lavados;
                this.textContent = mostrarSoloPendientes.lavados ? 'Mostrar Todos' : 'Solo Pendientes';
                this.classList.toggle('bg-yellow-500', !mostrarSoloPendientes.lavados);
                this.classList.toggle('bg-gray-500', mostrarSoloPendientes.lavados);
                loadLavadoData();
            });
        }

        window.toggleEstadoPagoLavado = async function(index) {
            if (index < 0 || index >= lavados.length) return;
            const nuevoEstado = lavados[index].estadoPago === 'pagado' ? 'pendiente' : 'pagado';
            
            if (confirm(`驴Cambiar estado a "${nuevoEstado.toUpperCase()}"?`)) {
                if (lavados[index]?.firebaseId) {
                    await updateInFirebase('lavados', lavados[index].firebaseId, {
                        ...lavados[index],
                        estadoPago: nuevoEstado
                    });
                }
                lavados[index].estadoPago = nuevoEstado;
                localStorage.setItem('lavados', JSON.stringify(lavados));
                loadLavadoData();
                updateReports();
                updateTotalPendienteHeader();
            }
        };

        window.deleteLavado = async function(index) {
            if (confirm('驴Eliminar este lavado?')) {
                if (lavados[index]?.firebaseId) {
                    await deleteFromFirebase('lavados', lavados[index].firebaseId);
                }
                lavados.splice(index, 1);
                localStorage.setItem('lavados', JSON.stringify(lavados));
                loadLavadoData();
                updateReports();
                updateTotalPendienteHeader();
            }
        };

        window.editLavado = function(index) {
            const l = lavados[index];
            document.getElementById('lavadoId').value = index;
            document.getElementById('placaLavado').value = l.placa;
            document.getElementById('fechaLavado').value = l.fecha;
            document.getElementById('costoLavado').value = l.costo;
            document.getElementById('centroLavado').value = l.centro;
            document.getElementById('estadoPagoLavado').value = l.estadoPago || 'pendiente';
        };

        function loadLavadoData() {
            const tbody = document.getElementById('lavadoTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            let lavadosFiltrados = ordenarPorFecha(lavados);
            
            if (mostrarSoloPendientes.lavados) {
                lavadosFiltrados = lavadosFiltrados.filter(l => l.estadoPago === 'pendiente');
            }
            
            lavadosFiltrados.forEach((l, idx) => {
                const originalIndex = lavados.findIndex(l2 => 
                    l2.placa === l.placa && l2.fecha === l.fecha && l2.costo === l.costo
                );
                
                const row = document.createElement('tr');
                row.className = `border-b border-gray-200 hover:bg-gray-100 ${l.estadoPago === 'pagado' ? 'estado-pagado' : 'estado-pendiente'}`;
                row.innerHTML = `
                    <td class="py-3 px-4 md:px-6 text-left font-semibold">${l.placa}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${formatearFecha(l.fecha)}</td>
                    <td class="py-3 px-4 md:px-6 text-left">$${parseFloat(l.costo).toFixed(2)}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${l.centro}</td>
                    <td class="py-3 px-4 md:px-6 text-left">
                        <span class="${l.estadoPago === 'pagado' ? 'badge-pagado' : 'badge-pendiente'}">
                            ${l.estadoPago?.toUpperCase() || 'PENDIENTE'}
                        </span>
                    </td>
                    <td class="py-3 px-4 md:px-6 text-center">
                        <div class="flex flex-col space-y-1">
                            <button onclick="editLavado(${originalIndex})" class="bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600 text-xs">Editar</button>
                            <button onclick="toggleEstadoPagoLavado(${originalIndex})" class="bg-${l.estadoPago === 'pagado' ? 'yellow' : 'green'}-500 text-white px-2 py-1 rounded hover:bg-${l.estadoPago === 'pagado' ? 'yellow' : 'green'}-600 text-xs">
                                ${l.estadoPago === 'pagado' ? 'Pendiente' : 'Pagado'}
                            </button>
                            <button onclick="deleteLavado(${originalIndex})" class="bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600 text-xs">Eliminar</button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // ============ FUNCIONES PARA GASOIL ============
        function setupGasoilForm() {
            const form = document.getElementById('gasoilForm');
            if (!form) return;

            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                const id = document.getElementById('gasoilId').value;
                const litros = parseFloat(document.getElementById('litrosGasoil').value) || 0;
                const flete = parseFloat(document.getElementById('fleteGasoil').value) || 0;
                
                const gasoil = {
                    placa: document.getElementById('placaGasoil').value.toUpperCase(),
                    fecha: document.getElementById('fechaGasoil').value,
                    litros: litros,
                    flete: flete,
                    costo: (litros * 0.48) + flete,
                    centro: document.getElementById('centroGasoil').value,
                    estadoPago: document.getElementById('estadoPagoGasoil').value
                };

                if (id === '') {
                    const firebaseId = await saveToFirebase('gasoilRecords', gasoil);
                    if (firebaseId) gasoil.firebaseId = firebaseId;
                    gasoilRecords.push(gasoil);
                } else {
                    if (gasoilRecords[id]?.firebaseId) {
                        await updateInFirebase('gasoilRecords', gasoilRecords[id].firebaseId, gasoil);
                    }
                    gasoilRecords[id] = gasoil;
                }

                localStorage.setItem('gasoilRecords', JSON.stringify(gasoilRecords));
                loadGasoilData();
                form.reset();
                document.getElementById('gasoilId').value = '';
                updateReports();
                updateTotalPendienteHeader();
            });

            function calcularCosto() {
                const litros = parseFloat(document.getElementById('litrosGasoil').value) || 0;
                const flete = parseFloat(document.getElementById('fleteGasoil').value) || 0;
                document.getElementById('costoGasoil').value = ((litros * 0.48) + flete).toFixed(2);
            }

            document.getElementById('litrosGasoil')?.addEventListener('input', calcularCosto);
            document.getElementById('fleteGasoil')?.addEventListener('input', calcularCosto);

            document.getElementById('togglePendientesGasoil')?.addEventListener('click', function() {
                mostrarSoloPendientes.gasoil = !mostrarSoloPendientes.gasoil;
                this.textContent = mostrarSoloPendientes.gasoil ? 'Mostrar Todos' : 'Solo Pendientes';
                this.classList.toggle('bg-yellow-500', !mostrarSoloPendientes.gasoil);
                this.classList.toggle('bg-gray-500', mostrarSoloPendientes.gasoil);
                loadGasoilData();
            });
        }

        window.toggleEstadoPagoGasoil = async function(index) {
            if (index < 0 || index >= gasoilRecords.length) return;
            const nuevoEstado = gasoilRecords[index].estadoPago === 'pagado' ? 'pendiente' : 'pagado';
            
            if (confirm(`驴Cambiar estado a "${nuevoEstado.toUpperCase()}"?`)) {
                if (gasoilRecords[index]?.firebaseId) {
                    await updateInFirebase('gasoilRecords', gasoilRecords[index].firebaseId, {
                        ...gasoilRecords[index],
                        estadoPago: nuevoEstado
                    });
                }
                gasoilRecords[index].estadoPago = nuevoEstado;
                localStorage.setItem('gasoilRecords', JSON.stringify(gasoilRecords));
                loadGasoilData();
                updateReports();
                updateTotalPendienteHeader();
            }
        };

        window.deleteGasoil = async function(index) {
            if (confirm('驴Eliminar este registro?')) {
                if (gasoilRecords[index]?.firebaseId) {
                    await deleteFromFirebase('gasoilRecords', gasoilRecords[index].firebaseId);
                }
                gasoilRecords.splice(index, 1);
                localStorage.setItem('gasoilRecords', JSON.stringify(gasoilRecords));
                loadGasoilData();
                updateReports();
                updateTotalPendienteHeader();
            }
        };

        window.editGasoil = function(index) {
            const g = gasoilRecords[index];
            document.getElementById('gasoilId').value = index;
            document.getElementById('placaGasoil').value = g.placa;
            document.getElementById('fechaGasoil').value = g.fecha;
            document.getElementById('litrosGasoil').value = g.litros;
            document.getElementById('fleteGasoil').value = g.flete;
            document.getElementById('costoGasoil').value = g.costo;
            document.getElementById('centroGasoil').value = g.centro;
            document.getElementById('estadoPagoGasoil').value = g.estadoPago || 'pendiente';
        };

        function loadGasoilData() {
            const tbody = document.getElementById('gasoilTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            let gasoilFiltrados = ordenarPorFecha(gasoilRecords);
            
            if (mostrarSoloPendientes.gasoil) {
                gasoilFiltrados = gasoilFiltrados.filter(g => g.estadoPago === 'pendiente');
            }
            
            gasoilFiltrados.forEach((g, idx) => {
                const originalIndex = gasoilRecords.findIndex(g2 => 
                    g2.placa === g.placa && g2.fecha === g.fecha && g2.litros === g.litros
                );
                
                const row = document.createElement('tr');
                row.className = `border-b border-gray-200 hover:bg-gray-100 ${g.estadoPago === 'pagado' ? 'estado-pagado' : 'estado-pendiente'}`;
                row.innerHTML = `
                    <td class="py-3 px-4 md:px-6 text-left font-semibold">${g.placa}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${formatearFecha(g.fecha)}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${g.litros} L</td>
                    <td class="py-3 px-4 md:px-6 text-left">$${parseFloat(g.flete).toFixed(2)}</td>
                    <td class="py-3 px-4 md:px-6 text-left">$${parseFloat(g.costo).toFixed(2)}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${g.centro}</td>
                    <td class="py-3 px-4 md:px-6 text-left">
                        <span class="${g.estadoPago === 'pagado' ? 'badge-pagado' : 'badge-pendiente'}">
                            ${g.estadoPago?.toUpperCase() || 'PENDIENTE'}
                        </span>
                    </td>
                    <td class="py-3 px-4 md:px-6 text-center">
                        <div class="flex flex-col space-y-1">
                            <button onclick="editGasoil(${originalIndex})" class="bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600 text-xs">Editar</button>
                            <button onclick="toggleEstadoPagoGasoil(${originalIndex})" class="bg-${g.estadoPago === 'pagado' ? 'yellow' : 'green'}-500 text-white px-2 py-1 rounded hover:bg-${g.estadoPago === 'pagado' ? 'yellow' : 'green'}-600 text-xs">
                                ${g.estadoPago === 'pagado' ? 'Pendiente' : 'Pagado'}
                            </button>
                            <button onclick="deleteGasoil(${originalIndex})" class="bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600 text-xs">Eliminar</button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // ============ FUNCIONES PARA REPORTES ============
        function setupYearSelector() {
            const yearSelect = document.getElementById('reportYear');
            if (!yearSelect) return;
            
            const currentYear = new Date().getFullYear();
            yearSelect.innerHTML = '';
            
            for (let year = 2022; year <= currentYear + 1; year++) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                if (year === currentYear) option.selected = true;
                yearSelect.appendChild(option);
            }
        }

        function setupReporteAnioSelector() {
            const selectAnio = document.getElementById('reporteAnio');
            if (!selectAnio) return;
            
            const currentYear = new Date().getFullYear();
            selectAnio.innerHTML = '';
            
            for (let year = 2022; year <= currentYear + 1; year++) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                if (year === currentYear) option.selected = true;
                selectAnio.appendChild(option);
            }
        }

        function calcularTotalPendiente() {
            let total = 0;
            total += maintenances.filter(m => m.estadoPago === 'pendiente')
                .reduce((sum, m) => sum + parseFloat(m.costo || 0), 0);
            total += fuelRecords.filter(f => f.estadoPago === 'pendiente')
                .reduce((sum, f) => sum + parseFloat(f.costo || 0), 0);
            total += lavados.filter(l => l.estadoPago === 'pendiente')
                .reduce((sum, l) => sum + parseFloat(l.costo || 0), 0);
            total += gasoilRecords.filter(g => g.estadoPago === 'pendiente')
                .reduce((sum, g) => sum + parseFloat(g.costo || 0), 0);
            return total;
        }

        function calcularTotalPagado() {
            let total = 0;
            total += maintenances.filter(m => m.estadoPago === 'pagado')
                .reduce((sum, m) => sum + parseFloat(m.costo || 0), 0);
            total += fuelRecords.filter(f => f.estadoPago === 'pagado')
                .reduce((sum, f) => sum + parseFloat(f.costo || 0), 0);
            total += lavados.filter(l => l.estadoPago === 'pagado')
                .reduce((sum, l) => sum + parseFloat(l.costo || 0), 0);
            total += gasoilRecords.filter(g => g.estadoPago === 'pagado')
                .reduce((sum, g) => sum + parseFloat(g.costo || 0), 0);
            return total;
        }

        function calculateTotalExpenses(center, year, month = 'all', soloPendientes = false) {
            let total = 0;
            
            total += maintenances.filter(m => 
                m.centro === center && 
                (!soloPendientes || m.estadoPago !== 'pagado') &&
                (month === 'all' || new Date(m.fecha).getMonth() + 1 == month) &&
                new Date(m.fecha).getFullYear() == year
            ).reduce((sum, m) => sum + parseFloat(m.costo || 0), 0);
            
            total += fuelRecords.filter(f => 
                f.centro === center && 
                (!soloPendientes || f.estadoPago !== 'pagado') &&
                (month === 'all' || new Date(f.fecha).getMonth() + 1 == month) &&
                new Date(f.fecha).getFullYear() == year
            ).reduce((sum, f) => sum + parseFloat(f.costo || 0), 0);
            
            total += siniestros.filter(s => 
                s.centro === center && 
                (month === 'all' || new Date(s.fechaHora).getMonth() + 1 == month) &&
                new Date(s.fechaHora).getFullYear() == year
            ).reduce((sum, s) => sum + parseFloat(s.costoReparacion || 0), 0);
            
            total += lavados.filter(l => 
                l.centro === center && 
                (!soloPendientes || l.estadoPago !== 'pagado') &&
                (month === 'all' || new Date(l.fecha).getMonth() + 1 == month) &&
                new Date(l.fecha).getFullYear() == year
            ).reduce((sum, l) => sum + parseFloat(l.costo || 0), 0);
            
            total += gasoilRecords.filter(g => 
                g.centro === center && 
                (!soloPendientes || g.estadoPago !== 'pagado') &&
                (month === 'all' || new Date(g.fecha).getMonth() + 1 == month) &&
                new Date(g.fecha).getFullYear() == year
            ).reduce((sum, g) => sum + parseFloat(g.costo || 0), 0);
            
            return total;
        }

        function calculateCategoryExpenses(category, year, center = 'all', soloPendientes = false) {
            let total = 0;
            let records = [];
            
            switch (category) {
                case 'maintenances': records = maintenances; break;
                case 'fuel': records = fuelRecords; break;
                case 'siniestros': records = siniestros; break;
                case 'lavados': records = lavados; break;
                case 'gasoil': records = gasoilRecords; break;
                default: return 0;
            }
            
            records.forEach(record => {
                const fecha = new Date(record.fecha || record.fechaHora);
                if (fecha.getFullYear() == year &&
                    (center === 'all' || record.centro === center) &&
                    (!soloPendientes || category === 'siniestros' || record.estadoPago !== 'pagado')) {
                    
                    if (category === 'siniestros') {
                        total += parseFloat(record.costoReparacion || 0);
                    } else {
                        total += parseFloat(record.costo || 0);
                    }
                }
            });
            
            return total;
        }

        function updateTotalPendienteHeader() {
            const total = calcularTotalPendiente();
            const badge = document.getElementById('totalPendienteBadge');
            if (badge) {
                if (total > 0) {
                    badge.textContent = `Pendiente: $${total.toFixed(2)}`;
                    badge.classList.remove('hidden');
                } else {
                    badge.classList.add('hidden');
                }
            }
        }

        function updateReports() {
            const year = document.getElementById('reportYear')?.value || new Date().getFullYear();
            const month = document.getElementById('reportMonth')?.value || 'all';
            const center = document.getElementById('reportCenter')?.value || 'all';
            
            // Actualizar totales por centro
            const totalMSO = calculateTotalExpenses('MSO', year, month, mostrarSoloPendientesReporte);
            const totalUNCCS = calculateTotalExpenses('UN CCS', year, month, mostrarSoloPendientesReporte);
            
            document.getElementById('totalMSO').textContent = `$${totalMSO.toFixed(2)}`;
            document.getElementById('totalUNCCS').textContent = `$${totalUNCCS.toFixed(2)}`;
            
            // Actualizar totales de pagos
            const totalPendiente = calcularTotalPendiente();
            const totalPagado = calcularTotalPagado();
            
            document.getElementById('totalPendiente').textContent = `$${totalPendiente.toFixed(2)}`;
            document.getElementById('totalPagado').textContent = `$${totalPagado.toFixed(2)}`;
            
            // Actualizar gr谩ficos
            updateMonthlyComparisonChart(year);
            updateExpenseDistributionChart(year, center);
        }

        function updateMonthlyComparisonChart(year) {
            const ctx = document.getElementById('monthlyComparisonChart');
            if (!ctx) return;
            
            const months = ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'];
            const msoData = [];
            const unccsData = [];
            
            for (let month = 1; month <= 12; month++) {
                msoData.push(calculateTotalExpenses('MSO', year, month, mostrarSoloPendientesReporte));
                unccsData.push(calculateTotalExpenses('UN CCS', year, month, mostrarSoloPendientesReporte));
            }
            
            if (monthlyComparisonChart) {
                monthlyComparisonChart.destroy();
            }
            
            monthlyComparisonChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [
                        {
                            label: 'MSO',
                            data: msoData,
                            borderColor: '#005BAA',
                            backgroundColor: 'rgba(0, 91, 170, 0.1)',
                            tension: 0.1
                        },
                        {
                            label: 'UN CCS',
                            data: unccsData,
                            borderColor: '#FDD000',
                            backgroundColor: 'rgba(253, 208, 0, 0.1)',
                            tension: 0.1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: $${context.raw.toFixed(2)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toFixed(0);
                                }
                            }
                        }
                    }
                }
            });
        }

        function updateExpenseDistributionChart(year, center) {
            const ctx = document.getElementById('expenseDistributionChart');
            if (!ctx) return;
            
            const data = [
                calculateCategoryExpenses('maintenances', year, center, mostrarSoloPendientesReporte),
                calculateCategoryExpenses('fuel', year, center, mostrarSoloPendientesReporte),
                calculateCategoryExpenses('siniestros', year, center, false),
                calculateCategoryExpenses('lavados', year, center, mostrarSoloPendientesReporte),
                calculateCategoryExpenses('gasoil', year, center, mostrarSoloPendientesReporte)
            ];
            
            if (expenseDistributionChart) {
                expenseDistributionChart.destroy();
            }
            
            expenseDistributionChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Mantenimientos', 'Combustible', 'Siniestros', 'Lavados', 'Gasoil'],
                    datasets: [{
                        data: data,
                        backgroundColor: [
                            '#005BAA',
                            '#5CE1E6',
                            '#FDD000',
                            '#10b981',
                            '#8b5cf6'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = context.raw;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : '0.0';
                                    return `${context.label}: $${value.toFixed(2)} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // ============ FUNCIONES PARA IMPORTACIN/EXPORTACIN ============
        function setupImportButtons() {
            setupImportButton('importVehicleBtn', 'importVehicleFile', 'vehicles');
            setupImportButton('importMaintenanceBtn', 'importMaintenanceFile', 'maintenances');
            setupImportButton('importInspectionBtn', 'importInspectionFile', 'inspections');
            setupImportButton('importFuelBtn', 'importFuelFile', 'fuel');
            setupImportButton('importSiniestroBtn', 'importSiniestroFile', 'siniestros');
            setupImportButton('importLavadoBtn', 'importLavadoFile', 'lavados');
            setupImportButton('importGasoilBtn', 'importGasoilFile', 'gasoil');
        }

        function setupImportButton(buttonId, fileInputId, type) {
            const button = document.getElementById(buttonId);
            const fileInput = document.getElementById(fileInputId);
            
            if (button && fileInput) {
                button.addEventListener('click', () => fileInput.click());
                fileInput.addEventListener('change', (e) => {
                    if (e.target.files[0]) {
                        importFromExcel(e.target.files[0], type);
                    }
                });
            }
        }

        function importFromExcel(file, type) {
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                    
                    if (jsonData.length === 0) {
                        alert('El archivo est谩 vac铆o');
                        return;
                    }
                    
                    if (confirm(`驴Importar ${jsonData.length} registros?`)) {
                        saveImportedData(type, jsonData);
                    }
                } catch (error) {
                    console.error('Error importando:', error);
                    alert('Error al importar el archivo');
                }
            };
            reader.readAsArrayBuffer(file);
        }

        async function saveImportedData(type, jsonData) {
            const importedData = [];
            
            jsonData.forEach(row => {
                let item = {};
                switch(type) {
                    case 'vehicles':
                        item = {
                            placa: String(row.Placa || row.placa || '').toUpperCase(),
                            marca: String(row.Marca || row.marca || ''),
                            modelo: String(row.Modelo || row.modelo || ''),
                            anio: row.A帽o || row.anio || '',
                            centroOperaciones: String(row['Centro de Operaciones'] || row.centroOperaciones || row.Centro || ''),
                            capacidadTanque: row['Capacidad Tanque'] || row.capacidadTanque || '',
                            departamentoAsignado: String(row['Departamento Asignado'] || row.departamentoAsignado || ''),
                            estado: String(row.Estado || row.estado || 'Operativo')
                        };
                        break;
                    case 'maintenances':
                        item = {
                            placa: String(row.Placa || row.placa || '').toUpperCase(),
                            tipo: String(row.Tipo || row.tipo || 'preventivo'),
                            fecha: row.Fecha || row.fecha || '',
                            costo: parseFloat(row.Costo || row.costo || 0),
                            proveedor: String(row.Proveedor || row.proveedor || ''),
                            centro: String(row.Centro || row.centro || ''),
                            estadoPago: String(row['Estado de Pago'] || row.estadoPago || 'pendiente'),
                            descripcion: String(row.Descripci贸n || row.descripcion || '')
                        };
                        break;
                    case 'fuel':
                        const litros = parseFloat(row.Litros || row.litros || 0);
                        item = {
                            placa: String(row.Placa || row.placa || '').toUpperCase(),
                            fecha: row.Fecha || row.fecha || '',
                            litros: litros,
                            costo: litros * 0.50,
                            centro: String(row.Centro || row.centro || ''),
                            estadoPago: String(row['Estado de Pago'] || row.estadoPago || 'pendiente')
                        };
                        break;
                    case 'lavados':
                        item = {
                            placa: String(row.Placa || row.placa || '').toUpperCase(),
                            fecha: row.Fecha || row.fecha || '',
                            costo: parseFloat(row.Costo || row.costo || 0),
                            centro: String(row.Centro || row.centro || ''),
                            estadoPago: String(row['Estado de Pago'] || row.estadoPago || 'pendiente')
                        };
                        break;
                    case 'gasoil':
                        const litrosG = parseFloat(row.Litros || row.litros || 0);
                        const flete = parseFloat(row.Flete || row.flete || 0);
                        item = {
                            placa: String(row.Placa || row.placa || '').toUpperCase(),
                            fecha: row.Fecha || row.fecha || '',
                            litros: litrosG,
                            flete: flete,
                            costo: (litrosG * 0.48) + flete,
                            centro: String(row.Centro || row.centro || ''),
                            estadoPago: String(row['Estado de Pago'] || row.estadoPago || 'pendiente')
                        };
                        break;
                    case 'siniestros':
                        item = {
                            placa: String(row.Placa || row.placa || '').toUpperCase(),
                            fechaHora: row['Fecha y Hora'] || row.fechaHora || row.Fecha || '',
                            conductor: String(row.Conductor || row.conductor || ''),
                            poliza: String(row.P贸liza || row.poliza || ''),
                            lugar: String(row.Lugar || row.lugar || ''),
                            descripcion: String(row.Descripci贸n || row.descripcion || ''),
                            costoReparacion: parseFloat(row['Costo de Reparaci贸n'] || row.costoReparacion || 0),
                            centro: String(row.Centro || row.centro || '')
                        };
                        break;
                    case 'inspections':
                        const chequeo = {};
                        ['Luces', 'Limpiaparabrisas', 'Liquido_de_frenos', 'Frenos', 'Cauchos', 
                         'Retrovisores', 'Aire_acondicionado', 'Gato', 'Triangulo', 'Extintor', 
                         'Caucho_de_repuesto', 'Documentos'].forEach(field => {
                            chequeo[field] = row[field] === 'ok' ? 'ok' : 'no';
                        });
                        item = {
                            placa: String(row.Placa || row.placa || '').toUpperCase(),
                            conductor: String(row.Conductor || row.conductor || ''),
                            kilometraje: parseFloat(row.Kilometraje || row.kilometraje || 0),
                            fecha: row.Fecha || row.fecha || '',
                            chequeo: chequeo,
                            observaciones: String(row.Observaciones || row.observaciones || '')
                        };
                        break;
                }
                
                if (item.placa) {
                    importedData.push(item);
                }
            });

            for (const item of importedData) {
                const firebaseId = await saveToFirebase(type, item);
                if (firebaseId) item.firebaseId = firebaseId;
            }

            switch(type) {
                case 'vehicles':
                    vehicles = [...vehicles, ...importedData];
                    localStorage.setItem('vehicles', JSON.stringify(vehicles));
                    loadVehicleData();
                    break;
                case 'maintenances':
                    maintenances = [...maintenances, ...importedData];
                    localStorage.setItem('maintenances', JSON.stringify(maintenances));
                    loadMaintenanceData();
                    break;
                case 'inspections':
                    inspections = [...inspections, ...importedData];
                    localStorage.setItem('inspections', JSON.stringify(inspections));
                    loadInspectionData();
                    break;
                case 'fuel':
                    fuelRecords = [...fuelRecords, ...importedData];
                    localStorage.setItem('fuelRecords', JSON.stringify(fuelRecords));
                    loadFuelData();
                    break;
                case 'siniestros':
                    siniestros = [...siniestros, ...importedData];
                    localStorage.setItem('siniestros', JSON.stringify(siniestros));
                    loadSiniestroData();
                    break;
                case 'lavados':
                    lavados = [...lavados, ...importedData];
                    localStorage.setItem('lavados', JSON.stringify(lavados));
                    loadLavadoData();
                    break;
                case 'gasoil':
                    gasoilRecords = [...gasoilRecords, ...importedData];
                    localStorage.setItem('gasoilRecords', JSON.stringify(gasoilRecords));
                    loadGasoilData();
                    break;
            }
            
            updateReports();
            updateTotalPendienteHeader();
            actualizarVistaPreviaReporte();
            alert(`Importados ${importedData.length} registros`);
        }

        function setupExportButtons() {
            document.getElementById('exportVehicleBtn')?.addEventListener('click', () => exportToExcel('vehicles'));
            document.getElementById('exportMaintenanceBtn')?.addEventListener('click', () => exportToExcel('maintenances'));
            document.getElementById('exportInspectionBtn')?.addEventListener('click', () => exportToExcel('inspections'));
            document.getElementById('exportFuelBtn')?.addEventListener('click', () => exportToExcel('fuel'));
            document.getElementById('exportSiniestroBtn')?.addEventListener('click', () => exportToExcel('siniestros'));
            document.getElementById('exportLavadoBtn')?.addEventListener('click', () => exportToExcel('lavados'));
            document.getElementById('exportGasoilBtn')?.addEventListener('click', () => exportToExcel('gasoil'));
        }

        function exportToExcel(type) {
            let data = [];
            let fileName = '';
            
            switch(type) {
                case 'vehicles': data = vehicles; fileName = 'vehiculos.xlsx'; break;
                case 'maintenances': data = maintenances; fileName = 'mantenimientos.xlsx'; break;
                case 'inspections': data = inspections; fileName = 'inspecciones.xlsx'; break;
                case 'fuel': data = fuelRecords; fileName = 'combustible.xlsx'; break;
                case 'siniestros': data = siniestros; fileName = 'siniestros.xlsx'; break;
                case 'lavados': data = lavados; fileName = 'lavados.xlsx'; break;
                case 'gasoil': data = gasoilRecords; fileName = 'gasoil.xlsx'; break;
            }
            
            if (data.length === 0) {
                alert('No hay datos para exportar');
                return;
            }
            
            const ws = XLSX.utils.json_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Datos');
            XLSX.writeFile(wb, fileName);
        }

        // ============ FUNCIONES PARA BSQUEDA ============
        function setupSearchFunctionality() {
            setupSearchInput('searchVehicleInput', 'vehicleTableBody');
            setupSearchInput('searchMaintenanceInput', 'maintenanceTableBody');
            setupSearchInput('searchInspectionInput', 'inspectionTableBody');
            setupSearchInput('searchFuelInput', 'fuelTableBody');
            setupSearchInput('searchSiniestroInput', 'siniestroTableBody');
            setupSearchInput('searchLavadoInput', 'lavadoTableBody');
            setupSearchInput('searchGasoilInput', 'gasoilTableBody');
        }

        function setupSearchInput(inputId, tbodyId) {
            const input = document.getElementById(inputId);
            if (input) {
                input.addEventListener('input', function(e) {
                    const searchTerm = e.target.value.toLowerCase();
                    const tbody = document.getElementById(tbodyId);
                    if (tbody) {
                        const rows = tbody.querySelectorAll('tr');
                        rows.forEach(row => {
                            row.style.display = row.textContent.toLowerCase().includes(searchTerm) ? '' : 'none';
                        });
                    }
                });
            }
        }

        // ============ FUNCIONES PARA REPORTE MENSUAL PDF - VERSIN CORREGIDA Y MEJORADA ============
        function calcularEstadisticasMensuales(mes, anio) {
            const stats = {
                'UN CCS': {
                    mantenimientos: { preventivos: 0, correctivos: 0, total: 0 },
                    lavados: { cantidad: 0, total: 0 },
                    gasolina: { litros: 0, total: 0 },
                    gasoil: { litros: 0, flete: 0, total: 0 }
                },
                'MSO': {
                    mantenimientos: { preventivos: 0, correctivos: 0, total: 0 },
                    lavados: { cantidad: 0, total: 0 },
                    gasolina: { litros: 0, total: 0 },
                    gasoil: { litros: 0, flete: 0, total: 0 }
                }
            };

            // Calcular mantenimientos
            maintenances.forEach(m => {
                if (!m.centro || !stats[m.centro]) return;
                const fecha = new Date(m.fecha);
                if (fecha.getMonth() + 1 == mes && fecha.getFullYear() == anio) {
                    const costo = parseFloat(m.costo || 0);
                    stats[m.centro].mantenimientos.total += costo;
                    if (m.tipo === 'preventivo') stats[m.centro].mantenimientos.preventivos++;
                    else if (m.tipo === 'correctivo') stats[m.centro].mantenimientos.correctivos++;
                }
            });

            // Calcular lavados
            lavados.forEach(l => {
                if (!l.centro || !stats[l.centro]) return;
                const fecha = new Date(l.fecha);
                if (fecha.getMonth() + 1 == mes && fecha.getFullYear() == anio) {
                    stats[l.centro].lavados.cantidad++;
                    stats[l.centro].lavados.total += parseFloat(l.costo || 0);
                }
            });

            // Calcular combustible (gasolina)
            fuelRecords.forEach(f => {
                if (!f.centro || !stats[f.centro]) return;
                const fecha = new Date(f.fecha);
                if (fecha.getMonth() + 1 == mes && fecha.getFullYear() == anio) {
                    stats[f.centro].gasolina.litros += parseFloat(f.litros || 0);
                    stats[f.centro].gasolina.total += parseFloat(f.costo || 0);
                }
            });

            // Calcular gasoil
            gasoilRecords.forEach(g => {
                if (!g.centro || !stats[g.centro]) return;
                const fecha = new Date(g.fecha);
                if (fecha.getMonth() + 1 == mes && fecha.getFullYear() == anio) {
                    stats[g.centro].gasoil.litros += parseFloat(g.litros || 0);
                    stats[g.centro].gasoil.flete += parseFloat(g.flete || 0);
                    stats[g.centro].gasoil.total += parseFloat(g.costo || 0);
                }
            });

            return stats;
        }

        function generarHTMLReporteMensual(mes, anio) {
            const meses = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 
                           'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
            const nombreMes = meses[mes - 1];
            const stats = calcularEstadisticasMensuales(mes, anio);
            
            // Calcular totales
            const totalMantenimientos = stats['UN CCS'].mantenimientos.total + stats['MSO'].mantenimientos.total;
            const totalLavados = stats['UN CCS'].lavados.total + stats['MSO'].lavados.total;
            const totalGasolina = stats['UN CCS'].gasolina.total + stats['MSO'].gasolina.total;
            const totalGasoil = stats['UN CCS'].gasoil.total + stats['MSO'].gasoil.total;
            const totalCaracas = stats['UN CCS'].mantenimientos.total + stats['UN CCS'].lavados.total + 
                                stats['UN CCS'].gasolina.total + stats['UN CCS'].gasoil.total;
            const totalMSO = stats['MSO'].mantenimientos.total + stats['MSO'].lavados.total + 
                            stats['MSO'].gasolina.total + stats['MSO'].gasoil.total;
            const totalGeneral = totalCaracas + totalMSO;

            return `
                <div class="pdf-report" style="font-family: Arial, Helvetica, sans-serif; max-width: 1200px; margin: 0 auto; background: white; padding: 30px;">
                    <h1 style="color: #005BAA; font-size: 24px; font-weight: bold; text-align: center; margin-bottom: 30px; border-bottom: 3px solid #005BAA; padding-bottom: 15px; text-transform: uppercase; letter-spacing: 1px;">
                        RELACIN DE GASTOS FLOTA - ${nombreMes.toUpperCase()} ${anio}
                    </h1>

                    <!-- Tabla principal de gastos -->
                    <table style="width: 100%; border-collapse: collapse; border: 2px solid #000; margin-bottom: 40px; table-layout: fixed;">
                        <thead>
                            <tr style="background-color: #e5e7eb;">
                                <th style="border: 1px solid #000; padding: 15px; text-align: center; font-weight: bold; width: 15%;">CENTRO</th>
                                <th style="border: 1px solid #000; padding: 15px; text-align: center; font-weight: bold; width: 25%;">MANTENIMIENTOS</th>
                                <th style="border: 1px solid #000; padding: 15px; text-align: center; font-weight: bold; width: 15%;">LAVADO</th>
                                <th style="border: 1px solid #000; padding: 15px; text-align: center; font-weight: bold; width: 20%;">GASOLINA</th>
                                <th style="border: 1px solid #000; padding: 15px; text-align: center; font-weight: bold; width: 25%;">GASOIL</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- UN CCS -->
                            <tr>
                                <td style="border: 1px solid #000; padding: 12px; font-weight: bold; background-color: #f9fafb;">UN CCS</td>
                                <td style="border: 1px solid #000; padding: 12px; vertical-align: top;">
                                    <div style="margin-bottom: 8px;"> Preventivos: <strong>${stats['UN CCS'].mantenimientos.preventivos}</strong></div>
                                    <div style="margin-bottom: 8px;"> Correctivos: <strong>${stats['UN CCS'].mantenimientos.correctivos}</strong></div>
                                    <div style="margin-top: 15px; font-weight: bold; color: #005BAA; font-size: 14px;">
                                        TOTAL: $${stats['UN CCS'].mantenimientos.total.toFixed(2)}
                                    </div>
                                </td>
                                <td style="border: 1px solid #000; padding: 12px; vertical-align: top;">
                                    <div style="margin-bottom: 8px;"> Veh铆culos: <strong>${stats['UN CCS'].lavados.cantidad}</strong></div>
                                    <div style="margin-top: 15px; font-weight: bold; color: #005BAA; font-size: 14px;">
                                        TOTAL: $${stats['UN CCS'].lavados.total.toFixed(2)}
                                    </div>
                                </td>
                                <td style="border: 1px solid #000; padding: 12px; vertical-align: top;">
                                    <div style="margin-bottom: 8px;"> Litros: <strong>${stats['UN CCS'].gasolina.litros.toFixed(2)} L</strong></div>
                                    <div style="margin-top: 15px; font-weight: bold; color: #005BAA; font-size: 14px;">
                                        TOTAL: $${stats['UN CCS'].gasolina.total.toFixed(2)}
                                    </div>
                                </td>
                                <td style="border: 1px solid #000; padding: 12px; vertical-align: top;">
                                    <div style="margin-bottom: 8px;">锔 Litros: <strong>${stats['UN CCS'].gasoil.litros.toFixed(2)} L</strong></div>
                                    <div style="margin-bottom: 8px;"> Flete: <strong>$${stats['UN CCS'].gasoil.flete.toFixed(2)}</strong></div>
                                    <div style="margin-top: 15px; font-weight: bold; color: #005BAA; font-size: 14px;">
                                        TOTAL: $${stats['UN CCS'].gasoil.total.toFixed(2)}
                                    </div>
                                </td>
                            </tr>
                            
                            <!-- MSO -->
                            <tr>
                                <td style="border: 1px solid #000; padding: 12px; font-weight: bold; background-color: #f9fafb;">MSO</td>
                                <td style="border: 1px solid #000; padding: 12px; vertical-align: top;">
                                    <div style="margin-bottom: 8px;"> Preventivos: <strong>${stats['MSO'].mantenimientos.preventivos}</strong></div>
                                    <div style="margin-bottom: 8px;"> Correctivos: <strong>${stats['MSO'].mantenimientos.correctivos}</strong></div>
                                    <div style="margin-top: 15px; font-weight: bold; color: #005BAA; font-size: 14px;">
                                        TOTAL: $${stats['MSO'].mantenimientos.total.toFixed(2)}
                                    </div>
                                </td>
                                <td style="border: 1px solid #000; padding: 12px; vertical-align: top;">
                                    <div style="margin-bottom: 8px;"> Veh铆culos: <strong>${stats['MSO'].lavados.cantidad}</strong></div>
                                    <div style="margin-top: 15px; font-weight: bold; color: #005BAA; font-size: 14px;">
                                        TOTAL: $${stats['MSO'].lavados.total.toFixed(2)}
                                    </div>
                                </td>
                                <td style="border: 1px solid #000; padding: 12px; vertical-align: top;">
                                    <div style="margin-bottom: 8px;"> Litros: <strong>${stats['MSO'].gasolina.litros.toFixed(2)} L</strong></div>
                                    <div style="margin-top: 15px; font-weight: bold; color: #005BAA; font-size: 14px;">
                                        TOTAL: $${stats['MSO'].gasolina.total.toFixed(2)}
                                    </div>
                                </td>
                                <td style="border: 1px solid #000; padding: 12px; vertical-align: top;">
                                    <div style="margin-bottom: 8px;">锔 Litros: <strong>${stats['MSO'].gasoil.litros.toFixed(2)} L</strong></div>
                                    <div style="margin-bottom: 8px;"> Flete: <strong>$${stats['MSO'].gasoil.flete.toFixed(2)}</strong></div>
                                    <div style="margin-top: 15px; font-weight: bold; color: #005BAA; font-size: 14px;">
                                        TOTAL: $${stats['MSO'].gasoil.total.toFixed(2)}
                                    </div>
                                </td>
                            </tr>
                            
                            <!-- Fila de totales -->
                            <tr style="background-color: #e5e7eb; font-weight: bold;">
                                <td style="border: 1px solid #000; padding: 12px; text-align: right;">TOTALES</td>
                                <td style="border: 1px solid #000; padding: 12px; text-align: left; font-weight: bold;">
                                    $${totalMantenimientos.toFixed(2)}
                                </td>
                                <td style="border: 1px solid #000; padding: 12px; text-align: left; font-weight: bold;">
                                    $${totalLavados.toFixed(2)}
                                </td>
                                <td style="border: 1px solid #000; padding: 12px; text-align: left; font-weight: bold;">
                                    $${totalGasolina.toFixed(2)}
                                </td>
                                <td style="border: 1px solid #000; padding: 12px; text-align: left; font-weight: bold;">
                                    $${totalGasoil.toFixed(2)}
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- Resumen por centro -->
                    <div style="margin-top: 40px;">
                        <h2 style="color: #005BAA; font-size: 20px; font-weight: bold; margin-bottom: 25px; border-bottom: 2px solid #005BAA; padding-bottom: 10px;">
                            RESUMEN POR CENTRO
                        </h2>
                        <table style="width: 70%; border-collapse: collapse; border: 2px solid #000; margin: 0 auto;">
                            <tr style="background-color: #e5e7eb;">
                                <th style="border: 1px solid #000; padding: 15px; text-align: left; font-weight: bold;">CENTRO</th>
                                <th style="border: 1px solid #000; padding: 15px; text-align: right; font-weight: bold;">TOTAL</th>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 15px; font-weight: bold;">UN CCS (CARACAS)</td>
                                <td style="border: 1px solid #000; padding: 15px; text-align: right; font-weight: bold; color: #005BAA; font-size: 16px;">
                                    $${totalCaracas.toFixed(2)}
                                </td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 15px; font-weight: bold;">MSO</td>
                                <td style="border: 1px solid #000; padding: 15px; text-align: right; font-weight: bold; color: #005BAA; font-size: 16px;">
                                    $${totalMSO.toFixed(2)}
                                </td>
                            </tr>
                            <tr style="background-color: #f0f0f0; font-weight: bold;">
                                <td style="border: 1px solid #000; padding: 15px;">TOTAL GENERAL</td>
                                <td style="border: 1px solid #000; padding: 15px; text-align: right; font-size: 18px; color: #005BAA; font-weight: bold;">
                                    $${totalGeneral.toFixed(2)}
                                </td>
                            </tr>
                        </table>
                    </div>

                    <!-- Fecha de generaci贸n -->
                    <div style="margin-top: 50px; text-align: right; font-size: 11px; color: #666; border-top: 1px solid #ccc; padding-top: 20px;">
                        <p style="margin: 5px 0;"> Fecha de generaci贸n: ${new Date().toLocaleDateString('es-ES', {
                            day: '2-digit',
                            month: '2-digit',
                            year: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit'
                        })}</p>
                        <p style="margin: 5px 0;">Sistema de Gesti贸n de Flota - Reporte Mensual</p>
                    </div>
                </div>
            `;
        }

        function actualizarVistaPreviaReporte() {
            const mes = document.getElementById('reporteMes')?.value || new Date().getMonth() + 1;
            const anio = document.getElementById('reporteAnio')?.value || new Date().getFullYear();
            const contenedor = document.getElementById('contenidoReporteMensual');
            
            if (contenedor) {
                contenedor.innerHTML = generarHTMLReporteMensual(parseInt(mes), parseInt(anio));
            }
        }

        async function generarPDFReporteMensual() {
            const mes = document.getElementById('reporteMes')?.value;
            const anio = document.getElementById('reporteAnio')?.value;
            const meses = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 
                           'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
            const nombreMes = meses[parseInt(mes) - 1];
            
            // Crear un contenedor temporal con estilos espec铆ficos para PDF
            const tempContainer = document.createElement('div');
            tempContainer.id = 'temp-pdf-container';
            tempContainer.style.position = 'absolute';
            tempContainer.style.left = '-9999px';
            tempContainer.style.top = '0';
            tempContainer.style.width = '1200px';
            tempContainer.style.background = 'white';
            tempContainer.style.padding = '40px';
            tempContainer.style.fontFamily = 'Arial, Helvetica, sans-serif';
            tempContainer.style.lineHeight = '1.5';
            tempContainer.style.boxSizing = 'border-box';
            
            // Agregar el contenido HTML
            tempContainer.innerHTML = generarHTMLReporteMensual(parseInt(mes), parseInt(anio));
            document.body.appendChild(tempContainer);
            
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF({
                    orientation: 'landscape',
                    unit: 'px',
                    format: 'a4'
                });
                
                // Configuraci贸n optimizada para html2canvas
                const canvas = await html2canvas(tempContainer, {
                    scale: 1.2,
                    letterRendering: true,
                    useCORS: true,
                    logging: false,
                    allowTaint: true,
                    backgroundColor: '#ffffff',
                    windowWidth: 1200,
                    windowHeight: tempContainer.scrollHeight,
                    onclone: function(clonedDoc) {
                        const clonedContainer = clonedDoc.getElementById('temp-pdf-container');
                        if (clonedContainer) {
                            clonedContainer.style.width = '1200px';
                            clonedContainer.style.padding = '40px';
                            clonedContainer.style.margin = '0';
                            clonedContainer.style.boxSizing = 'border-box';
                        }
                    }
                });
                
                const imgData = canvas.toDataURL('image/png');
                
                // Calcular dimensiones para que se ajuste perfectamente
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                
                const imgWidth = pageWidth - 30;
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                
                // Centrar la imagen en la p谩gina
                const xPosition = (pageWidth - imgWidth) / 2;
                const yPosition = 15;
                
                doc.addImage(imgData, 'PNG', xPosition, yPosition, imgWidth, imgHeight);
                doc.save(`Gastos_Flota_${nombreMes}_${anio}.pdf`);
                
            } catch (error) {
                console.error('Error generando PDF:', error);
                alert('Error al generar el PDF. Por favor intente nuevamente.');
            } finally {
                // Limpiar el contenedor temporal
                if (tempContainer && tempContainer.parentNode) {
                    tempContainer.parentNode.removeChild(tempContainer);
                }
            }
        }

        function setupReporteMensualPDFListeners() {
            setupReporteAnioSelector();
            
            document.getElementById('reporteMes')?.addEventListener('change', actualizarVistaPreviaReporte);
            document.getElementById('reporteAnio')?.addEventListener('change', actualizarVistaPreviaReporte);
            
            document.getElementById('btnGenerarReportePDF')?.addEventListener('click', function() {
                actualizarVistaPreviaReporte();
                const btn = this;
                const originalText = btn.innerHTML;
                btn.innerHTML = '<span class="flex items-center gap-2"> Vista Previa Actualizada</span>';
                setTimeout(() => {
                    btn.innerHTML = originalText;
                }, 2000);
            });
            
            document.getElementById('btnDescargarPDF')?.addEventListener('click', async function() {
                this.disabled = true;
                const originalText = this.innerHTML;
                this.innerHTML = '<span class="flex items-center gap-2"> Generando PDF...</span>';
                
                try {
                    await generarPDFReporteMensual();
                } catch (error) {
                    console.error('Error:', error);
                    alert('Error al generar el PDF');
                } finally {
                    this.disabled = false;
                    this.innerHTML = originalText;
                }
            });
            
            // Actualizar vista previa inicial
            actualizarVistaPreviaReporte();
        }

        // ============ FUNCIONES DE TABS ============
        function initializeTabs() {
            const tabLinks = document.querySelectorAll('.tab-link');
            tabLinks.forEach(link => {
                link.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab-id');
                    switchTab(tabId);
                });
            });
        }

        function switchTab(tabId) {
            document.querySelectorAll('.tab-pane').forEach(pane => {
                pane.classList.add('hidden');
            });
            document.querySelectorAll('.tab-link').forEach(link => {
                link.classList.remove('active');
            });
            
            const selectedTab = document.getElementById(tabId);
            if (selectedTab) {
                selectedTab.classList.remove('hidden');
                const activeLink = document.querySelector(`[data-tab-id="${tabId}"]`);
                if (activeLink) activeLink.classList.add('active');
            }
            
            if (tabId === 'reportes') {
                setupYearSelector();
                updateReports();
            } else if (tabId === 'reporte-mensual-pdf') {
                setupReporteAnioSelector();
                actualizarVistaPreviaReporte();
            }
        }

        function loadAllData() {
            loadVehicleData();
            loadMaintenanceData();
            loadInspectionData();
            loadFuelData();
            loadSiniestroData();
            loadLavadoData();
            loadGasoilData();
        }

        function setupEventListeners() {
            setupVehicleForm();
            setupMaintenanceForm();
            setupInspectionForm();
            setupFuelForm();
            setupSiniestroForm();
            setupLavadoForm();
            setupGasoilForm();
            setupSearchFunctionality();
            setupExportButtons();
            setupImportButtons();
            setupReporteMensualPDFListeners();
            
            document.getElementById('applyFilters')?.addEventListener('click', updateReports);
            
            document.getElementById('mostrarSoloPendientesReporte')?.addEventListener('click', function() {
                mostrarSoloPendientesReporte = !mostrarSoloPendientesReporte;
                this.textContent = mostrarSoloPendientesReporte ? 'Mostrar Todos' : 'Solo Pendientes';
                this.classList.toggle('bg-yellow-500', !mostrarSoloPendientesReporte);
                this.classList.toggle('bg-gray-500', mostrarSoloPendientesReporte);
                updateReports();
            });
            
            document.getElementById('syncButton')?.addEventListener('click', syncAllWithFirebase);
        }

        // ============ INICIALIZACIN ============
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Inicializando sistema...');
            
            // Cargar datos locales
            loadLocalData();
            
            // Inicializar componentes
            initializeTabs();
            loadAllData();
            setupEventListeners();
            setupYearSelector();
            setupReporteAnioSelector();
            updateReports();
            updateTotalPendienteHeader();
            actualizarVistaPreviaReporte();
            
            // Sincronizar con Firebase
            setTimeout(() => {
                syncAllWithFirebase();
            }, 1000);
            
            console.log('Sistema inicializado correctamente');
        });
    </script>
</body>
</html>
