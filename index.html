<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventario y Gestión de Flota</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <!-- Versión estable de Tailwind -->
    <script src="https://cdn.tailwindcss.com/3.3.0"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- jsPDF para generación de PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    
    <!-- Firebase App -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCo5Q10ZQ42pwgGSS-v-yYmcoAxIo8vAoE",
            authDomain: "gestion-de-flota-5a657.firebaseapp.com",
            projectId: "gestion-de-flota-5a657",
            storageBucket: "gestion-de-flota-5a657.firebasestorage.app",
            messagingSenderId: "540590464439",
            appId: "1:540590464439:web:aa0a4d01209709a4821c32"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        // Hacer disponible globalmente
        window.firebaseApp = app;
        window.db = db;
        window.firebaseModules = { getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc };
        
        console.log('Firebase y Firestore inicializados correctamente');
    </script>

    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            -webkit-text-size-adjust: 100%;
        }
        .bg-inter-primary { background-color: #005BAA; }
        .bg-inter-accent-light { background-color: #5CE1E6; }
        .bg-inter-accent-yellow { background-color: #FDD000; }
        .text-inter-primary { color: #005BAA; }
        
        /* Tabs responsivos */
        .tabs-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: thin;
        }
        .tabs-container::-webkit-scrollbar {
            height: 6px;
        }
        .tabs-container::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .tabs-container::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }
        
        .tab-link {
            white-space: nowrap;
            min-width: fit-content;
        }
        .tab-link.active span { 
            border-bottom-color: #005BAA; 
            color: #005BAA; 
        }
        .tab-link:not(.active) span:hover { color: #005BAA; }
        .tab-link.active svg path { fill: #005BAA; }
        .tab-link:not(.active) svg:hover path { fill: #005BAA; }
        
        /* Estilos para el sistema de pagos */
        .estado-pagado {
            background-color: #dcfce7;
            color: #166534;
            font-weight: 600;
        }

        .estado-pendiente {
            background-color: #fef3c7;
            color: #92400e;
            font-weight: 600;
        }

        .badge-pagado {
            background-color: #10b981;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }

        .badge-pendiente {
            background-color: #f59e0b;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }

        .badge-no-aplica {
            background-color: #6b7280;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }
        
        .filtro-activo {
            background-color: #fbbf24 !important;
        }
        
        /* Mejoras responsive para tablas */
        .responsive-table {
            display: block;
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .responsive-table table {
            min-width: 640px;
        }
        
        /* Formularios responsive */
        .form-grid {
            display: grid;
            gap: 1rem;
        }
        
        @media (min-width: 640px) {
            .form-grid {
                grid-template-columns: repeat(1, 1fr);
            }
        }
        
        @media (min-width: 768px) {
            .form-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (min-width: 1024px) {
            .form-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        /* Mejoras para móviles */
        .mobile-optimized {
            padding: 0.75rem;
        }
        
        .mobile-header {
            flex-direction: column;
            gap: 0.5rem;
            padding: 0.75rem;
        }
        
        .mobile-header > div {
            width: 100%;
            justify-content: space-between;
        }
        
        /* Botones responsive */
        .btn-responsive {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            white-space: nowrap;
        }
        
        @media (max-width: 640px) {
            .btn-responsive {
                padding: 0.375rem 0.75rem;
                font-size: 0.75rem;
            }
        }
        
        /* Tarjetas responsive */
        .card-grid {
            display: grid;
            gap: 1rem;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }
        
        /* Inputs responsive */
        .input-responsive {
            width: 100%;
            font-size: 0.875rem;
        }
        
        @media (min-width: 768px) {
            .input-responsive {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body class="bg-gray-100">

    <header class="bg-inter-primary text-white p-4 shadow-md">
        <div class="container mx-auto mobile-header">
            <h1 class="text-xl font-bold text-center md:text-left">Gestión de Flota</h1>
            <div class="flex flex-col md:flex-row items-center space-y-2 md:space-y-0 md:space-x-4">
                <div class="flex items-center space-x-2 w-full md:w-auto justify-center md:justify-start">
                    <span id="syncStatus" class="text-sm bg-green-500 px-2 py-1 rounded">Conectado</span>
                    <button id="syncButton" class="bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700 btn-responsive">
                        Sincronizar
                    </button>
                </div>
                <!-- Mostrar total pendiente -->
                <div id="totalPendienteBadge" class="hidden bg-red-500 text-white px-3 py-1 rounded text-sm text-center md:text-left">
                    Pendiente: $0.00
                </div>
            </div>
        </div>
    </header>

    <main class="container mx-auto p-4 md:p-6">
        <div class="bg-white p-4 md:p-6 rounded-lg shadow-md mb-6">
            <div class="tabs-container flex border-b border-gray-200">
                <button class="tab-link active focus:outline-none p-3 md:p-4" data-tab-id="vehiculos">
                    <span class="font-medium text-sm md:text-lg border-b-2 border-transparent pb-2 md:pb-4">Vehículos</span>
                </button>
                <button class="tab-link focus:outline-none p-3 md:p-4" data-tab-id="mantenimientos">
                    <span class="font-medium text-sm md:text-lg border-b-2 border-transparent pb-2 md:pb-4">Mantenimientos</span>
                </button>
                <button class="tab-link focus:outline-none p-3 md:p-4" data-tab-id="inspeccion">
                    <span class="font-medium text-sm md:text-lg border-b-2 border-transparent pb-2 md:pb-4">Inspección</span>
                </button>
                <button class="tab-link focus:outline-none p-3 md:p-4" data-tab-id="combustible">
                    <span class="font-medium text-sm md:text-lg border-b-2 border-transparent pb-2 md:pb-4">Combustible</span>
                </button>
                <button class="tab-link focus:outline-none p-3 md:p-4" data-tab-id="siniestros">
                    <span class="font-medium text-sm md:text-lg border-b-2 border-transparent pb-2 md:pb-4">Siniestros</span>
                </button>
                <button class="tab-link focus:outline-none p-3 md:p-4" data-tab-id="lavado">
                    <span class="font-medium text-sm md:text-lg border-b-2 border-transparent pb-2 md:pb-4">Lavado</span>
                </button>
                <button class="tab-link focus:outline-none p-3 md:p-4" data-tab-id="gasoil-head-end">
                    <span class="font-medium text-sm md:text-lg border-b-2 border-transparent pb-2 md:pb-4">Gasoil</span>
                </button>
                <button class="tab-link focus:outline-none p-3 md:p-4" data-tab-id="reportes">
                    <span class="font-medium text-sm md:text-lg border-b-2 border-transparent pb-2 md:pb-4">Reportes</span>
                </button>
                <button class="tab-link focus:outline-none p-3 md:p-4" data-tab-id="reportes-pdf">
                    <span class="font-medium text-sm md:text-lg border-b-2 border-transparent pb-2 md:pb-4">PDF</span>
                </button>
            </div>

            <div id="tab-content" class="mt-4 md:mt-6">

                <!-- Pestaña de Vehículos -->
                <div id="vehiculos" class="tab-pane">
                    <h2 class="text-xl font-semibold text-inter-primary mb-4">Registro de Vehículos</h2>
                    <form id="vehicleForm" class="form-grid mb-6">
                        <input type="hidden" id="vehicleId">
                        <div>
                            <label for="placa" class="block text-sm font-medium text-gray-700">Placa</label>
                            <input type="text" id="placa" name="placa" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive" required>
                        </div>
                        <div>
                            <label for="marca" class="block text-sm font-medium text-gray-700">Marca</label>
                            <input type="text" id="marca" name="marca" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive" required>
                        </div>
                        <div>
                            <label for="modelo" class="block text-sm font-medium text-gray-700">Modelo</label>
                            <input type="text" id="modelo" name="modelo" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive" required>
                        </div>
                        <div>
                            <label for="anio" class="block text-sm font-medium text-gray-700">Año</label>
                            <input type="number" id="anio" name="anio" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive" required>
                        </div>
                        <div>
                            <label for="centroOperaciones" class="block text-sm font-medium text-gray-700">Centro de Operaciones</label>
                            <input list="centroOperacionesList" id="centroOperaciones" name="centroOperaciones" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive" required>
                            <datalist id="centroOperacionesList">
                                <option value="MSO">
                                <option value="UN CCS">
                            </datalist>
                        </div>
                        <div>
                            <label for="capacidadTanque" class="block text-sm font-medium text-gray-700">Capacidad Tanque</label>
                            <input type="number" id="capacidadTanque" name="capacidadTanque" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive">
                        </div>
                        <div>
                            <label for="departamentoAsignado" class="block text-sm font-medium text-gray-700">Departamento Asignado</label>
                            <input type="text" id="departamentoAsignado" name="departamentoAsignado" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive">
                        </div>
                        <div>
                            <label for="estado" class="block text-sm font-medium text-gray-700">Estado</label>
                            <input type="text" id="estado" name="estado" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive">
                        </div>
                        <div class="col-span-full flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-2">
                            <button type="submit" class="bg-inter-primary text-white font-bold py-2 px-4 rounded-md shadow hover:bg-inter-accent-light hover:text-inter-primary transition duration-300 btn-responsive flex-1">
                                Guardar Vehículo
                            </button>
                            <button type="button" id="deleteMassiveBtn" class="bg-red-600 text-white font-bold py-2 px-4 rounded-md shadow hover:bg-red-700 transition duration-300 btn-responsive flex-1">
                                Eliminar Todos los Vehículos
                            </button>
                        </div>
                    </form>

                    <div class="flex flex-col md:flex-row md:justify-between md:items-center mb-4 space-y-2 md:space-y-0">
                        <div class="flex items-center">
                            <input type="file" id="importVehicleFile" accept=".xlsx, .xls, .csv" class="hidden">
                            <button id="importVehicleBtn" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-md shadow hover:bg-blue-700 transition duration-300 btn-responsive">
                                Importar Vehículos
                            </button>
                        </div>
                        <div class="flex-1 md:mx-4">
                            <input type="text" id="searchVehicleInput" placeholder="Buscar vehículo..." class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-inter-primary input-responsive">
                        </div>
                        <button id="exportVehicleBtn" class="bg-green-600 text-white font-bold py-2 px-4 rounded-md shadow hover:bg-green-700 transition duration-300 btn-responsive">
                            Exportar Excel
                        </button>
                    </div>

                    <div class="responsive-table">
                        <table class="min-w-full bg-white border border-gray-200" id="vehicleTable">
                            <thead>
                                <tr class="bg-gray-200 text-gray-600 uppercase text-xs md:text-sm leading-normal">
                                    <th class="py-3 px-4 md:px-6 text-left">Placa</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Marca</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Modelo</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Año</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Centro</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Cap. Tanque</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Departamento</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Estado</th>
                                    <th class="py-3 px-4 md:px-6 text-center">Acciones</th>
                                </tr>
                            </thead>
                            <tbody class="text-gray-600 text-xs md:text-sm font-light" id="vehicleTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Pestaña de Mantenimientos -->
                <div id="mantenimientos" class="tab-pane hidden">
                    <h2 class="text-xl font-semibold text-inter-primary mb-4">Registro de Mantenimientos</h2>
                    <form id="maintenanceForm" class="form-grid mb-6">
                        <input type="hidden" id="maintenanceId">
                        <div>
                            <label for="placaMantenimiento" class="block text-sm font-medium text-gray-700">Placa</label>
                            <input list="placasList" id="placaMantenimiento" name="placaMantenimiento" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive" required>
                            <datalist id="placasList"></datalist>
                        </div>
                        <div>
                            <label for="tipoMantenimiento" class="block text-sm font-medium text-gray-700">Tipo de Mantenimiento</label>
                            <select id="tipoMantenimiento" name="tipoMantenimiento" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive" required>
                                <option value="" disabled selected>Seleccione un tipo</option>
                                <option value="preventivo">Preventivo</option>
                                <option value="correctivo">Correctivo</option>
                            </select>
                        </div>
                        <div>
                            <label for="estadoPagoMantenimiento" class="block text-sm font-medium text-gray-700">Estado de Pago</label>
                            <select id="estadoPagoMantenimiento" name="estadoPagoMantenimiento" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive" required>
                                <option value="pendiente" selected>Pendiente de Pago</option>
                                <option value="pagado">Pagado</option>
                            </select>
                        </div>
                        <div id="camposPreventivo" class="hidden">
                            <label for="kilometrajePreventivo" class="block text-sm font-medium text-gray-700">Kilometraje (Preventivo)</label>
                            <input type="number" id="kilometrajePreventivo" name="kilometrajePreventivo" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive">
                            <label for="descripcionPreventivo" class="block text-sm font-medium text-gray-700">Descripción (Preventivo)</label>
                            <textarea id="descripcionPreventivo" name="descripcionPreventivo" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive"></textarea>
                        </div>
                        <div id="camposCorrectivo" class="hidden">
                            <label for="descripcionCorrectivo" class="block text-sm font-medium text-gray-700">Descripción (Correctivo)</label>
                            <textarea id="descripcionCorrectivo" name="descripcionCorrectivo" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive"></textarea>
                            <label for="causaCorrectivo" class="block text-sm font-medium text-gray-700">Causa (Correctivo)</label>
                            <input type="text" id="causaCorrectivo" name="causaCorrectivo" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive">
                        </div>
                        <div>
                            <label for="fechaMantenimiento" class="block text-sm font-medium text-gray-700">Fecha</label>
                            <input type="date" id="fechaMantenimiento" name="fechaMantenimiento" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive" required>
                        </div>
                        <div>
                            <label for="costoMantenimiento" class="block text-sm font-medium text-gray-700">Costo</label>
                            <input type="number" id="costoMantenimiento" name="costoMantenimiento" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive" required>
                        </div>
                        <div>
                            <label for="proveedorTaller" class="block text-sm font-medium text-gray-700">Proveedor/Taller</label>
                            <input type="text" id="proveedorTaller" name="proveedorTaller" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive" required>
                        </div>
                        <div>
                            <label for="centroMantenimiento" class="block text-sm font-medium text-gray-700">Centro de Operaciones</label>
                            <select id="centroMantenimiento" name="centroMantenimiento" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive" required>
                                <option value="" disabled selected>Seleccione una opción</option>
                                <option value="MSO">MSO</option>
                                <option value="UN CCS">UN CCS</option>
                            </select>
                        </div>
                        <div class="col-span-full">
                            <button type="submit" class="bg-inter-primary text-white font-bold py-2 px-4 rounded-md shadow hover:bg-inter-accent-light hover:text-inter-primary transition duration-300 btn-responsive w-full md:w-auto">
                                Guardar Mantenimiento
                            </button>
                        </div>
                    </form>

                    <div class="flex flex-col md:flex-row md:justify-between md:items-center mb-4 space-y-2 md:space-y-0">
                        <div class="flex items-center">
                            <input type="file" id="importMaintenanceFile" accept=".xlsx, .xls, .csv" class="hidden">
                            <button id="importMaintenanceBtn" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-md shadow hover:bg-blue-700 transition duration-300 btn-responsive">
                                Importar Mantenimientos
                            </button>
                        </div>
                        <div class="flex-1 md:mx-4">
                            <input type="text" id="searchMaintenanceInput" placeholder="Buscar mantenimiento..." class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-inter-primary input-responsive">
                        </div>
                        <div class="flex space-x-2">
                            <button id="togglePendientesMantenimiento" class="bg-yellow-500 text-white font-bold py-2 px-4 rounded-md shadow hover:bg-yellow-600 transition duration-300 btn-responsive">
                                Solo Pendientes
                            </button>
                            <button id="exportMaintenanceBtn" class="bg-green-600 text-white font-bold py-2 px-4 rounded-md shadow hover:bg-green-700 transition duration-300 btn-responsive">
                                Exportar Excel
                            </button>
                        </div>
                    </div>

                    <div class="responsive-table">
                        <table class="min-w-full bg-white border border-gray-200" id="maintenanceTable">
                            <thead>
                                <tr class="bg-gray-200 text-gray-600 uppercase text-xs md:text-sm leading-normal">
                                    <th class="py-3 px-4 md:px-6 text-left">Placa</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Tipo</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Fecha</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Costo</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Proveedor</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Centro</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Estado</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Descripción</th>
                                    <th class="py-3 px-4 md:px-6 text-center">Acciones</th>
                                </tr>
                            </thead>
                            <tbody class="text-gray-600 text-xs md:text-sm font-light" id="maintenanceTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Pestaña de Inspección Pre-Operacional -->
                <div id="inspeccion" class="tab-pane hidden">
                    <h2 class="text-xl font-semibold text-inter-primary mb-4">Inspección Pre-Operacional</h2>
                    <form id="inspectionForm" class="form-grid mb-6">
                        <input type="hidden" id="inspectionId">
                        <div>
                            <label for="placaInspeccion" class="block text-sm font-medium text-gray-700">Placa</label>
                            <input list="placasList" id="placaInspeccion" name="placaInspeccion" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive" required>
                        </div>
                        <div>
                            <label for="conductorInspeccion" class="block text-sm font-medium text-gray-700">Conductor</label>
                            <input type="text" id="conductorInspeccion" name="conductorInspeccion" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive" required>
                        </div>
                        <div>
                            <label for="kilometrajeInspeccion" class="block text-sm font-medium text-gray-700">Kilometraje</label>
                            <input type="number" id="kilometrajeInspeccion" name="kilometrajeInspeccion" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive" required>
                        </div>
                        <div>
                            <label for="fechaInspeccion" class="block text-sm font-medium text-gray-700">Fecha de Inspección</label>
                            <input type="date" id="fechaInspeccion" name="fechaInspeccion" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive" required>
                        </div>
                        <div class="col-span-full">
                            <h3 class="text-md font-semibold text-gray-800 my-2">Chequeo</h3>
                            <div class="grid grid-cols-2 md:grid-cols-3 gap-2 md:gap-4">
                                <label class="flex items-center text-sm"><input type="checkbox" name="Luces" value="ok" class="mr-2">Luces</label>
                                <label class="flex items-center text-sm"><input type="checkbox" name="Limpiaparabrisas" value="ok" class="mr-2">Limpiaparabrisas</label>
                                <label class="flex items-center text-sm"><input type="checkbox" name="Liquido_de_frenos" value="ok" class="mr-2">Líquido de frenos</label>
                                <label class="flex items-center text-sm"><input type="checkbox" name="Frenos" value="ok" class="mr-2">Frenos</label>
                                <label class="flex items-center text-sm"><input type="checkbox" name="Cauchos" value="ok" class="mr-2">Cauchos</label>
                                <label class="flex items-center text-sm"><input type="checkbox" name="Retrovisores" value="ok" class="mr-2">Retrovisores</label>
                                <label class="flex items-center text-sm"><input type="checkbox" name="Aire_acondicionado" value="ok" class="mr-2">Aire acondicionado</label>
                                <label class="flex items-center text-sm"><input type="checkbox" name="Gato" value="ok" class="mr-2">Gato</label>
                                <label class="flex items-center text-sm"><input type="checkbox" name="Triangulo" value="ok" class="mr-2">Triángulo</label>
                                <label class="flex items-center text-sm"><input type="checkbox" name="Extintor" value="ok" class="mr-2">Extintor</label>
                                <label class="flex items-center text-sm"><input type="checkbox" name="Caucho_de_repuesto" value="ok" class="mr-2">Caucho de repuesto</label>
                                <label class="flex items-center text-sm"><input type="checkbox" name="Documentos" value="ok" class="mr-2">Documentos</label>
                            </div>
                        </div>
                        <div class="col-span-full">
                            <label for="observacionesInspeccion" class="block text-sm font-medium text-gray-700">Observaciones</label>
                            <textarea id="observacionesInspeccion" name="observacionesInspeccion" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive"></textarea>
                        </div>
                        <div class="col-span-full">
                            <button type="submit" class="bg-inter-primary text-white font-bold py-2 px-4 rounded-md shadow hover:bg-inter-accent-light hover:text-inter-primary transition duration-300 btn-responsive w-full md:w-auto">
                                Guardar Inspección
                            </button>
                        </div>
                    </form>

                    <div class="flex flex-col md:flex-row md:justify-between md:items-center mb-4 space-y-2 md:space-y-0">
                        <div class="flex items-center">
                            <input type="file" id="importInspectionFile" accept=".xlsx, .xls, .csv" class="hidden">
                            <button id="importInspectionBtn" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-md shadow hover:bg-blue-700 transition duration-300 btn-responsive">
                                Importar Inspecciones
                            </button>
                        </div>
                        <div class="flex-1 md:mx-4">
                            <input type="text" id="searchInspectionInput" placeholder="Buscar inspección..." class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-inter-primary input-responsive">
                        </div>
                        <button id="exportInspectionBtn" class="bg-green-600 text-white font-bold py-2 px-4 rounded-md shadow hover:bg-green-700 transition duration-300 btn-responsive">
                            Exportar Excel
                        </button>
                    </div>

                    <div class="responsive-table">
                        <table class="min-w-full bg-white border border-gray-200" id="inspectionTable">
                            <thead>
                                <tr class="bg-gray-200 text-gray-600 uppercase text-xs md:text-sm leading-normal">
                                    <th class="py-3 px-4 md:px-6 text-left">Placa</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Conductor</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Kilometraje</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Fecha</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Chequeo</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Observaciones</th>
                                    <th class="py-3 px-4 md:px-6 text-center">Acciones</th>
                                </tr>
                            </thead>
                            <tbody class="text-gray-600 text-xs md:text-sm font-light" id="inspectionTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Pestaña de Control de Combustible -->
                <div id="combustible" class="tab-pane hidden">
                    <h2 class="text-xl font-semibold text-inter-primary mb-4">Control de Combustible</h2>
                    <form id="fuelForm" class="form-grid mb-6">
                        <input type="hidden" id="fuelId">
                        <div>
                            <label for="placaCombustible" class="block text-sm font-medium text-gray-700">Placa</label>
                            <input list="placasList" id="placaCombustible" name="placaCombustible" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive" required>
                        </div>
                        <div>
                            <label for="estadoPagoCombustible" class="block text-sm font-medium text-gray-700">Estado de Pago</label>
                            <select id="estadoPagoCombustible" name="estadoPagoCombustible" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive" required>
                                <option value="pendiente" selected>Pendiente de Pago</option>
                                <option value="pagado">Pagado</option>
                            </select>
                        </div>
                        <div>
                            <label for="fechaCombustible" class="block text-sm font-medium text-gray-700">Fecha</label>
                            <input type="date" id="fechaCombustible" name="fechaCombustible" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive" required>
                        </div>
                        <div>
                            <label for="litros" class="block text-sm font-medium text-gray-700">Litros</label>
                            <input type="number" id="litros" name="litros" step="0.01" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive" required>
                        </div>
                        <div>
                            <label for="costoCombustible" class="block text-sm font-medium text-gray-700">Costo ($0.50/L)</label>
                            <input type="number" id="costoCombustible" name="costoCombustible" step="0.01" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive" required readonly>
                        </div>
                        <div>
                            <label for="centroCombustible" class="block text-sm font-medium text-gray-700">Centro de Operaciones</label>
                            <select id="centroCombustible" name="centroCombustible" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive" required>
                                <option value="" disabled selected>Seleccione una opción</option>
                                <option value="MSO">MSO</option>
                                <option value="UN CCS">UN CCS</option>
                            </select>
                        </div>
                        <div class="col-span-full">
                            <button type="submit" class="bg-inter-primary text-white font-bold py-2 px-4 rounded-md shadow hover:bg-inter-accent-light hover:text-inter-primary transition duration-300 btn-responsive w-full md:w-auto">
                                Guardar Combustible
                            </button>
                        </div>
                    </form>

                    <div class="flex flex-col md:flex-row md:justify-between md:items-center mb-4 space-y-2 md:space-y-0">
                        <div class="flex items-center">
                            <input type="file" id="importFuelFile" accept=".xlsx, .xls, .csv" class="hidden">
                            <button id="importFuelBtn" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-md shadow hover:bg-blue-700 transition duration-300 btn-responsive">
                                Importar Combustible
                            </button>
                        </div>
                        <div class="flex-1 md:mx-4">
                            <input type="text" id="searchFuelInput" placeholder="Buscar combustible..." class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-inter-primary input-responsive">
                        </div>
                        <div class="flex space-x-2">
                            <button id="togglePendientesCombustible" class="bg-yellow-500 text-white font-bold py-2 px-4 rounded-md shadow hover:bg-yellow-600 transition duration-300 btn-responsive">
                                Solo Pendientes
                            </button>
                            <button id="exportFuelBtn" class="bg-green-600 text-white font-bold py-2 px-4 rounded-md shadow hover:bg-green-700 transition duration-300 btn-responsive">
                                Exportar Excel
                            </button>
                        </div>
                    </div>

                    <div class="responsive-table">
                        <table class="min-w-full bg-white border border-gray-200" id="fuelTable">
                            <thead>
                                <tr class="bg-gray-200 text-gray-600 uppercase text-xs md:text-sm leading-normal">
                                    <th class="py-3 px-4 md:px-6 text-left">Placa</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Fecha</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Litros</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Costo</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Centro</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Estado</th>
                                    <th class="py-3 px-4 md:px-6 text-center">Acciones</th>
                                </tr>
                            </thead>
                            <tbody class="text-gray-600 text-xs md:text-sm font-light" id="fuelTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Pestaña de Siniestros -->
                <div id="siniestros" class="tab-pane hidden">
                    <h2 class="text-xl font-semibold text-inter-primary mb-4">Registro de Siniestros</h2>
                    <form id="siniestroForm" class="form-grid mb-6">
                        <input type="hidden" id="siniestroId">
                        <div>
                            <label for="placaSiniestro" class="block text-sm font-medium text-gray-700">Placa</label>
                            <input list="placasList" id="placaSiniestro" name="placaSiniestro" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive" required>
                        </div>
                        <div>
                            <label for="fechaHoraSiniestro" class="block text-sm font-medium text-gray-700">Fecha y Hora</label>
                            <input type="datetime-local" id="fechaHoraSiniestro" name="fechaHoraSiniestro" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive" required>
                        </div>
                        <div>
                            <label for="conductorSiniestro" class="block text-sm font-medium text-gray-700">Conductor</label>
                            <input type="text" id="conductorSiniestro" name="conductorSiniestro" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive" required>
                        </div>
                        <div>
                            <label for="polizaSiniestro" class="block text-sm font-medium text-gray-700">Número de Póliza</label>
                            <input type="text" id="polizaSiniestro" name="polizaSiniestro" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive" required>
                        </div>
                        <div>
                            <label for="lugarSiniestro" class="block text-sm font-medium text-gray-700">Lugar del Siniestro</label>
                            <input type="text" id="lugarSiniestro" name="lugarSiniestro" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive" required>
                        </div>
                        <div class="col-span-full">
                            <label for="descripcionSiniestro" class="block text-sm font-medium text-gray-700">Descripción del Siniestro</label>
                            <textarea id="descripcionSiniestro" name="descripcionSiniestro" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive" required></textarea>
                        </div>
                        <div>
                            <label for="costoReparacion" class="block text-sm font-medium text-gray-700">Costo de Reparación</label>
                            <input type="number" id="costoReparacion" name="costoReparacion" step="0.01" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive" required>
                        </div>
                        <div>
                            <label for="centroSiniestro" class="block text-sm font-medium text-gray-700">Centro de Operaciones</label>
                            <select id="centroSiniestro" name="centroSiniestro" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive" required>
                                <option value="" disabled selected>Seleccione una opción</option>
                                <option value="MSO">MSO</option>
                                <option value="UN CCS">UN CCS</option>
                            </select>
                        </div>
                        <div class="col-span-full">
                            <button type="submit" class="bg-inter-primary text-white font-bold py-2 px-4 rounded-md shadow hover:bg-inter-accent-light hover:text-inter-primary transition duration-300 btn-responsive w-full md:w-auto">
                                Guardar Siniestro
                            </button>
                        </div>
                    </form>

                    <div class="flex flex-col md:flex-row md:justify-between md:items-center mb-4 space-y-2 md:space-y-0">
                        <div class="flex items-center">
                            <input type="file" id="importSiniestroFile" accept=".xlsx, .xls, .csv" class="hidden">
                            <button id="importSiniestroBtn" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-md shadow hover:bg-blue-700 transition duration-300 btn-responsive">
                                Importar Siniestros
                            </button>
                        </div>
                        <div class="flex-1 md:mx-4">
                            <input type="text" id="searchSiniestroInput" placeholder="Buscar siniestro..." class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-inter-primary input-responsive">
                        </div>
                        <button id="exportSiniestroBtn" class="bg-green-600 text-white font-bold py-2 px-4 rounded-md shadow hover:bg-green-700 transition duration-300 btn-responsive">
                            Exportar Excel
                        </button>
                    </div>

                    <div class="responsive-table">
                        <table class="min-w-full bg-white border border-gray-200" id="siniestroTable">
                            <thead>
                                <tr class="bg-gray-200 text-gray-600 uppercase text-xs md:text-sm leading-normal">
                                    <th class="py-3 px-4 md:px-6 text-left">Placa</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Fecha/Hora</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Conductor</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Póliza</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Lugar</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Descripción</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Costo</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Centro</th>
                                    <th class="py-3 px-4 md:px-6 text-center">Acciones</th>
                                </tr>
                            </thead>
                            <tbody class="text-gray-600 text-xs md:text-sm font-light" id="siniestroTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Pestaña de Lavado de autos -->
                <div id="lavado" class="tab-pane hidden">
                    <h2 class="text-xl font-semibold text-inter-primary mb-4">Lavado de autos</h2>
                    <form id="lavadoForm" class="form-grid mb-6">
                        <input type="hidden" id="lavadoId">
                        <div>
                            <label for="placaLavado" class="block text-sm font-medium text-gray-700">Placa</label>
                            <input list="placasList" id="placaLavado" name="placaLavado" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive" required>
                        </div>
                        <div>
                            <label for="estadoPagoLavado" class="block text-sm font-medium text-gray-700">Estado de Pago</label>
                            <select id="estadoPagoLavado" name="estadoPagoLavado" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive" required>
                                <option value="pendiente" selected>Pendiente de Pago</option>
                                <option value="pagado">Pagado</option>
                            </select>
                        </div>
                        <div>
                            <label for="fechaLavado" class="block text-sm font-medium text-gray-700">Fecha</label>
                            <input type="date" id="fechaLavado" name="fechaLavado" class="mt-1 block w-full rounded-md border-gray-300 shadowSm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive" required>
                        </div>
                        <div>
                            <label for="costoLavado" class="block text-sm font-medium text-gray-700">Costo</label>
                            <input type="number" id="costoLavado" name="costoLavado" step="0.01" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive" required>
                        </div>
                        <div>
                            <label for="centroLavado" class="block text-sm font-medium text-gray-700">Centro de Operaciones</label>
                            <select id="centroLavado" name="centroLavado" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive" required>
                                <option value="" disabled selected>Seleccione una opción</option>
                                <option value="MSO">MSO</option>
                                <option value="UN CCS">UN CCS</option>
                            </select>
                        </div>
                        <div class="col-span-full">
                            <button type="submit" class="bg-inter-primary text-white font-bold py-2 px-4 rounded-md shadow hover:bg-inter-accent-light hover:text-inter-primary transition duration-300 btn-responsive w-full md:w-auto">
                                Guardar Lavado
                            </button>
                        </div>
                    </form>

                    <div class="flex flex-col md:flex-row md:justify-between md:items-center mb-4 space-y-2 md:space-y-0">
                        <div class="flex items-center">
                            <input type="file" id="importLavadoFile" accept=".xlsx, .xls, .csv" class="hidden">
                            <button id="importLavadoBtn" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-md shadow hover:bg-blue-700 transition duration-300 btn-responsive">
                                Importar Lavados
                            </button>
                        </div>
                        <div class="flex-1 md:mx-4">
                            <input type="text" id="searchLavadoInput" placeholder="Buscar lavado..." class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-inter-primary input-responsive">
                        </div>
                        <div class="flex space-x-2">
                            <button id="togglePendientesLavado" class="bg-yellow-500 text-white font-bold py-2 px-4 rounded-md shadow hover:bg-yellow-600 transition duration-300 btn-responsive">
                                Solo Pendientes
                            </button>
                            <button id="exportLavadoBtn" class="bg-green-600 text-white font-bold py-2 px-4 rounded-md shadow hover:bg-green-700 transition duration-300 btn-responsive">
                                Exportar Excel
                            </button>
                        </div>
                    </div>

                    <div class="responsive-table">
                        <table class="min-w-full bg-white border border-gray-200" id="lavadoTable">
                            <thead>
                                <tr class="bg-gray-200 text-gray-600 uppercase text-xs md:text-sm leading-normal">
                                    <th class="py-3 px-4 md:px-6 text-left">Placa</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Fecha</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Costo</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Centro</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Estado</th>
                                    <th class="py-3 px-4 md:px-6 text-center">Acciones</th>
                                </tr>
                            </thead>
                            <tbody class="text-gray-600 text-xs md:text-sm font-light" id="lavadoTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Pestaña de Gasoil Head End -->
                <div id="gasoil-head-end" class="tab-pane hidden">
                    <h2 class="text-xl font-semibold text-inter-primary mb-4">Gasoil Head End</h2>
                    <form id="gasoilForm" class="form-grid mb-6">
                        <input type="hidden" id="gasoilId">
                        <div>
                            <label for="placaGasoil" class="block text-sm font-medium text-gray-700">Placa</label>
                            <input list="placasList" id="placaGasoil" name="placaGasoil" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive" required>
                        </div>
                        <div>
                            <label for="estadoPagoGasoil" class="block text-sm font-medium text-gray-700">Estado de Pago</label>
                            <select id="estadoPagoGasoil" name="estadoPagoGasoil" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive" required>
                                <option value="pendiente" selected>Pendiente de Pago</option>
                                <option value="pagado">Pagado</option>
                            </select>
                        </div>
                        <div>
                            <label for="fechaGasoil" class="block text-sm font-medium text-gray-700">Fecha</label>
                            <input type="date" id="fechaGasoil" name="fechaGasoil" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive" required>
                        </div>
                        <div>
                            <label for="litrosGasoil" class="block text-sm font-medium text-gray-700">Litros</label>
                            <input type="number" id="litrosGasoil" name="litrosGasoil" step="0.01" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive" required>
                        </div>
                        <div>
                            <label for="fleteGasoil" class="block text-sm font-medium text-gray-700">Flete</label>
                            <input type="number" id="fleteGasoil" name="fleteGasoil" step="0.01" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive" required>
                        </div>
                        <div>
                            <label for="costoGasoil" class="block text-sm font-medium text-gray-700">Costo Total ($0.48/L + Flete)</label>
                            <input type="number" id="costoGasoil" name="costoGasoil" step="0.01" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive" required readonly>
                        </div>
                        <div>
                            <label for="centroGasoil" class="block text-sm font-medium text-gray-700">Centro de Operaciones</label>
                            <select id="centroGasoil" name="centroGasoil" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive" required>
                                <option value="" disabled selected>Seleccione una opción</option>
                                <option value="MSO">MSO</option>
                                <option value="UN CCS">UN CCS</option>
                            </select>
                        </div>
                        <div class="col-span-full">
                            <button type="submit" class="bg-inter-primary text-white font-bold py-2 px-4 rounded-md shadow hover:bg-inter-accent-light hover:text-inter-primary transition duration-300 btn-responsive w-full md:w-auto">
                                Guardar Gasoil
                            </button>
                        </div>
                    </form>

                    <div class="flex flex-col md:flex-row md:justify-between md:items-center mb-4 space-y-2 md:space-y-0">
                        <div class="flex items-center">
                            <input type="file" id="importGasoilFile" accept=".xlsx, .xls, .csv" class="hidden">
                            <button id="importGasoilBtn" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-md shadow hover:bg-blue-700 transition duration-300 btn-responsive">
                                Importar Gasoil
                            </button>
                        </div>
                        <div class="flex-1 md:mx-4">
                            <input type="text" id="searchGasoilInput" placeholder="Buscar gasoil..." class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-inter-primary input-responsive">
                        </div>
                        <div class="flex space-x-2">
                            <button id="togglePendientesGasoil" class="bg-yellow-500 text-white font-bold py-2 px-4 rounded-md shadow hover:bg-yellow-600 transition duration-300 btn-responsive">
                                Solo Pendientes
                            </button>
                            <button id="exportGasoilBtn" class="bg-green-600 text-white font-bold py-2 px-4 rounded-md shadow hover:bg-green-700 transition duration-300 btn-responsive">
                                Exportar Excel
                            </button>
                        </div>
                    </div>

                    <div class="responsive-table">
                        <table class="min-w-full bg-white border border-gray-200" id="gasoilTable">
                            <thead>
                                <tr class="bg-gray-200 text-gray-600 uppercase text-xs md:text-sm leading-normal">
                                    <th class="py-3 px-4 md:px-6 text-left">Placa</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Fecha</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Litros</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Flete</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Costo</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Centro</th>
                                    <th class="py-3 px-4 md:px-6 text-left">Estado</th>
                                    <th class="py-3 px-4 md:px-6 text-center">Acciones</th>
                                </tr>
                            </thead>
                            <tbody class="text-gray-600 text-xs md:text-sm font-light" id="gasoilTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Pestaña de Reportes y Estadísticas -->
                <div id="reportes" class="tab-pane hidden">
                    <h2 class="text-xl font-semibold text-inter-primary mb-4">Reportes y Estadísticas</h2>
                    
                    <!-- Filtros -->
                    <div class="bg-white p-4 md:p-6 rounded-lg shadow-md mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-3">Filtros</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label for="reportYear" class="block text-sm font-medium text-gray-700">Año</label>
                                <select id="reportYear" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive">
                                    <!-- Se llenará dinámicamente con JavaScript -->
                                </select>
                            </div>
                            <div>
                                <label for="reportMonth" class="block text-sm font-medium text-gray-700">Mes</label>
                                <select id="reportMonth" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive">
                                    <option value="all">Todos los meses</option>
                                    <option value="1">Enero</option>
                                    <option value="2">Febrero</option>
                                    <option value="3">Marzo</option>
                                    <option value="4">Abril</option>
                                    <option value="5">Mayo</option>
                                    <option value="6">Junio</option>
                                    <option value="7">Julio</option>
                                    <option value="8">Agosto</option>
                                    <option value="9">Septiembre</option>
                                    <option value="10">Octubre</option>
                                    <option value="11">Noviembre</option>
                                    <option value="12">Diciembre</option>
                                </select>
                            </div>
                            <div>
                                <label for="reportCenter" class="block text-sm font-medium text-gray-700">Centro</label>
                                <select id="reportCenter" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive">
                                    <option value="all">Todos los centros</option>
                                    <option value="MSO">MSO</option>
                                    <option value="UN CCS">UN CCS</option>
                                </select>
                            </div>
                        </div>
                        <div class="mt-4 flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-4">
                            <button id="applyFilters" class="bg-inter-primary text-white font-bold py-2 px-4 rounded-md shadow hover:bg-inter-accent-light hover:text-inter-primary transition duration-300 btn-responsive">
                                Aplicar Filtros
                            </button>
                            <button id="mostrarSoloPendientesReporte" class="bg-yellow-500 text-white font-bold py-2 px-4 rounded-md shadow hover:bg-yellow-600 transition duration-300 btn-responsive">
                                Solo Pendientes de Pago
                            </button>
                        </div>
                    </div>

                    <!-- Resumen de Gastos por Centro -->
                    <div class="card-grid mb-6">
                        <div class="bg-white p-4 md:p-6 rounded-lg shadow-md">
                            <h3 class="text-lg font-semibold text-gray-800 mb-2">Total MSO</h3>
                            <p class="text-2xl md:text-3xl font-bold text-inter-primary" id="totalMSO">$0</p>
                            <p class="text-sm text-gray-600 mt-1" id="msoTrend"></p>
                        </div>
                        <div class="bg-white p-4 md:p-6 rounded-lg shadow-md">
                            <h3 class="text-lg font-semibold text-gray-800 mb-2">Total UN CCS</h3>
                            <p class="text-2xl md:text-3xl font-bold text-inter-primary" id="totalUNCCS">$0</p>
                            <p class="text-sm text-gray-600 mt-1" id="unccsTrend"></p>
                        </div>
                        <div class="bg-white p-4 md:p-6 rounded-lg shadow-md">
                            <h3 class="text-lg font-semibold text-gray-800 mb-2">Total Pendiente</h3>
                            <p class="text-2xl md:text-3xl font-bold text-yellow-600" id="totalPendiente">$0</p>
                            <p class="text-sm text-gray-600 mt-1" id="pendienteInfo"></p>
                        </div>
                        <div class="bg-white p-4 md:p-6 rounded-lg shadow-md">
                            <h3 class="text-lg font-semibold text-gray-800 mb-2">Total Pagado</h3>
                            <p class="text-2xl md:text-3xl font-bold text-green-600" id="totalPagado">$0</p>
                            <p class="text-sm text-gray-600 mt-1" id="pagadoInfo"></p>
                        </div>
                    </div>

                    <!-- Gráficos Comparativos -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <div class="bg-white p-4 md:p-6 rounded-lg shadow-md">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">Comparativa Mensual MSO vs UN CCS</h3>
                            <div class="chart-container" style="position: relative; height: 300px;">
                                <canvas id="monthlyComparisonChart"></canvas>
                            </div>
                        </div>
                        <div class="bg-white p-4 md:p-6 rounded-lg shadow-md">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">Distribución de Gastos por Categoría</h3>
                            <div class="chart-container" style="position: relative; height: 300px;">
                                <canvas id="expenseDistributionChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Gastos Mensuales Detallados -->
                    <div class="grid grid-cols-1 gap-6 mb-6">
                        <div class="bg-white p-4 md:p-6 rounded-lg shadow-md">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">Gastos Mensuales Detallados - MSO</h3>
                            <div class="responsive-table">
                                <table class="min-w-full bg-white border border-gray-200" id="msoMonthlyTable">
                                    <thead>
                                        <tr class="bg-gray-200 text-gray-600 uppercase text-xs md:text-sm leading-normal">
                                            <th class="py-3 px-4 md:px-6 text-left">Vehículo</th>
                                            <th class="py-3 px-2 md:px-3 text-left">Ene</th>
                                            <th class="py-3 px-2 md:px-3 text-left">Feb</th>
                                            <th class="py-3 px-2 md:px-3 text-left">Mar</th>
                                            <th class="py-3 px-2 md:px-3 text-left">Abr</th>
                                            <th class="py-3 px-2 md:px-3 text-left">May</th>
                                            <th class="py-3 px-2 md:px-3 text-left">Jun</th>
                                            <th class="py-3 px-2 md:px-3 text-left">Jul</th>
                                            <th class="py-3 px-2 md:px-3 text-left">Ago</th>
                                            <th class="py-3 px-2 md:px-3 text-left">Sep</th>
                                            <th class="py-3 px-2 md:px-3 text-left">Oct</th>
                                            <th class="py-3 px-2 md:px-3 text-left">Nov</th>
                                            <th class="py-3 px-2 md:px-3 text-left">Dic</th>
                                            <th class="py-3 px-4 md:px-6 text-left">Total</th>
                                        </tr>
                                    </thead>
                                    <tbody class="text-gray-600 text-xs md:text-sm font-light" id="msoMonthlyTableBody">
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div class="bg-white p-4 md:p-6 rounded-lg shadow-md">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">Gastos Mensuales Detallados - UN CCS</h3>
                            <div class="responsive-table">
                                <table class="min-w-full bg-white border border-gray-200" id="unccsMonthlyTable">
                                    <thead>
                                        <tr class="bg-gray-200 text-gray-600 uppercase text-xs md:text-sm leading-normal">
                                            <th class="py-3 px-4 md:px-6 text-left">Vehículo</th>
                                            <th class="py-3 px-2 md:px-3 text-left">Ene</th>
                                            <th class="py-3 px-2 md:px-3 text-left">Feb</th>
                                            <th class="py-3 px-2 md:px-3 text-left">Mar</th>
                                            <th class="py-3 px-2 md:px-3 text-left">Abr</th>
                                            <th class="py-3 px-2 md:px-3 text-left">May</th>
                                            <th class="py-3 px-2 md:px-3 text-left">Jun</th>
                                            <th class="py-3 px-2 md:px-3 text-left">Jul</th>
                                            <th class="py-3 px-2 md:px-3 text-left">Ago</th>
                                            <th class="py-3 px-2 md:px-3 text-left">Sep</th>
                                            <th class="py-3 px-2 md:px-3 text-left">Oct</th>
                                            <th class="py-3 px-2 md:px-3 text-left">Nov</th>
                                            <th class="py-3 px-2 md:px-3 text-left">Dic</th>
                                            <th class="py-3 px-4 md:px-6 text-left">Total</th>
                                        </tr>
                                    </thead>
                                    <tbody class="text-gray-600 text-xs md:text-sm font-light" id="unccsMonthlyTableBody">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Combustible por Vehículo -->
                    <div class="grid grid-cols-1 gap-6 mb-6">
                        <div class="bg-white p-4 md:p-6 rounded-lg shadow-md">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">Consumo de Combustible - MSO</h3>
                            <div class="responsive-table">
                                <table class="min-w-full bg-white border border-gray-200" id="msoFuelTable">
                                    <thead>
                                        <tr class="bg-gray-200 text-gray-600 uppercase text-xs md:text-sm leading-normal">
                                            <th class="py-3 px-4 md:px-6 text-left">Vehículo</th>
                                            <th class="py-3 px-2 md:px-3 text-left">Ene</th>
                                            <th class="py-3 px-2 md:px-3 text-left">Feb</th>
                                            <th class="py-3 px-2 md:px-3 text-left">Mar</th>
                                            <th class="py-3 px-2 md:px-3 text-left">Abr</th>
                                            <th class="py-3 px-2 md:px-3 text-left">May</th>
                                            <th class="py-3 px-2 md:px-3 text-left">Jun</th>
                                            <th class="py-3 px-2 md:px-3 text-left">Jul</th>
                                            <th class="py-3 px-2 md:px-3 text-left">Ago</th>
                                            <th class="py-3 px-2 md:px-3 text-left">Sep</th>
                                            <th class="py-3 px-2 md:px-3 text-left">Oct</th>
                                            <th class="py-3 px-2 md:px-3 text-left">Nov</th>
                                            <th class="py-3 px-2 md:px-3 text-left">Dic</th>
                                            <th class="py-3 px-4 md:px-6 text-left">Total</th>
                                            <th class="py-3 px-4 md:px-6 text-left">Costo</th>
                                        </tr>
                                    </thead>
                                    <tbody class="text-gray-600 text-xs md:text-sm font-light" id="msoFuelTableBody">
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div class="bg-white p-4 md:p-6 rounded-lg shadow-md">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">Consumo de Combustible - UN CCS</h3>
                            <div class="responsive-table">
                                <table class="min-w-full bg-white border border-gray-200" id="unccsFuelTable">
                                    <thead>
                                        <tr class="bg-gray-200 text-gray-600 uppercase text-xs md:text-sm leading-normal">
                                            <th class="py-3 px-4 md:px-6 text-left">Vehículo</th>
                                            <th class="py-3 px-2 md:px-3 text-left">Ene</th>
                                            <th class="py-3 px-2 md:px-3 text-left">Feb</th>
                                            <th class="py-3 px-2 md:px-3 text-left">Mar</th>
                                            <th class="py-3 px-2 md:px-3 text-left">Abr</th>
                                            <th class="py-3 px-2 md:px-3 text-left">May</th>
                                            <th class="py-3 px-2 md:px-3 text-left">Jun</th>
                                            <th class="py-3 px-2 md:px-3 text-left">Jul</th>
                                            <th class="py-3 px-2 md:px-3 text-left">Ago</th>
                                            <th class="py-3 px-2 md:px-3 text-left">Sep</th>
                                            <th class="py-3 px-2 md:px-3 text-left">Oct</th>
                                            <th class="py-3 px-2 md:px-3 text-left">Nov</th>
                                            <th class="py-3 px-2 md:px-3 text-left">Dic</th>
                                            <th class="py-3 px-4 md:px-6 text-left">Total</th>
                                            <th class="py-3 px-4 md:px-6 text-left">Costo</th>
                                        </tr>
                                    </thead>
                                    <tbody class="text-gray-600 text-xs md:text-sm font-light" id="unccsFuelTableBody">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Resumen Anual -->
                    <div class="bg-white p-4 md:p-6 rounded-lg shadow-md mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Resumen Anual Comparativo</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-semibold text-gray-700 mb-2">MSO - Desglose Anual</h4>
                                <div id="msoAnnualBreakdown" class="space-y-2">
                                    <!-- Se llenará dinámicamente -->
                                </div>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-700 mb-2">UN CCS - Desglose Anual</h4>
                                <div id="unccsAnnualBreakdown" class="space-y-2">
                                    <!-- Se llenará dinámicamente -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Contadores Originales -->
                    <div class="card-grid mb-6">
                        <div class="bg-white p-4 md:p-6 rounded-lg shadow-md">
                            <h3 class="text-lg font-semibold text-gray-800 mb-2">Total de Vehículos</h3>
                            <p class="text-2xl md:text-3xl font-bold text-inter-primary" id="totalVehicles">0</p>
                        </div>
                        <div class="bg-white p-4 md:p-6 rounded-lg shadow-md">
                            <h3 class="text-lg font-semibold text-gray-800 mb-2">Total de Mantenimientos</h3>
                            <p class="text-2xl md:text-3xl font-bold text-inter-primary" id="totalMaintenances">0</p>
                        </div>
                        <div class="bg-white p-4 md:p-6 rounded-lg shadow-md">
                            <h3 class="text-lg font-semibold text-gray-800 mb-2">Total de Combustible</h3>
                            <p class="text-2xl md:text-3xl font-bold text-inter-primary" id="totalFuel">0 L</p>
                        </div>
                        <div class="bg-white p-4 md:p-6 rounded-lg shadow-md">
                            <h3 class="text-lg font-semibold text-gray-800 mb-2">Total de Siniestros</h3>
                            <p class="text-2xl md:text-3xl font-bold text-inter-primary" id="totalSiniestros">0</p>
                        </div>
                        <div class="bg-white p-4 md:p-6 rounded-lg shadow-md">
                            <h3 class="text-lg font-semibold text-gray-800 mb-2">Total de Lavados</h3>
                            <p class="text-2xl md:text-3xl font-bold text-inter-primary" id="totalLavados">0</p>
                        </div>
                        <div class="bg-white p-4 md:p-6 rounded-lg shadow-md">
                            <h3 class="text-lg font-semibold text-gray-800 mb-2">Total de Gasoil</h3>
                            <p class="text-2xl md:text-3xl font-bold text-inter-primary" id="totalGasoil">0 L</p>
                        </div>
                    </div>
                </div>

                <!-- Pestaña: REPORTES PDF -->
                <div id="reportes-pdf" class="tab-pane hidden">
                    <h2 class="text-xl font-semibold text-inter-primary mb-4">Reportes de Gastos en PDF</h2>
                    
                    <!-- Filtros para Reportes PDF -->
                    <div class="bg-white p-4 md:p-6 rounded-lg shadow-md mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Configurar Reporte</h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                            <div>
                                <label for="pdfYear" class="block text-sm font-medium text-gray-700">Año</label>
                                <select id="pdfYear" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive">
                                    <!-- Se llenará dinámicamente -->
                                </select>
                            </div>
                            <div>
                                <label for="pdfMonth" class="block text-sm font-medium text-gray-700">Mes</label>
                                <select id="pdfMonth" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive">
                                    <option value="all">Todos los meses</option>
                                    <option value="1">Enero</option>
                                    <option value="2">Febrero</option>
                                    <option value="3">Marzo</option>
                                    <option value="4">Abril</option>
                                    <option value="5">Mayo</option>
                                    <option value="6">Junio</option>
                                    <option value="7">Julio</option>
                                    <option value="8">Agosto</option>
                                    <option value="9">Septiembre</option>
                                    <option value="10">Octubre</option>
                                    <option value="11">Noviembre</option>
                                    <option value="12">Diciembre</option>
                                </select>
                            </div>
                            <div>
                                <label for="pdfCenter" class="block text-sm font-medium text-gray-700">Centro</label>
                                <select id="pdfCenter" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive">
                                    <option value="all">Todos los centros</option>
                                    <option value="MSO">MSO</option>
                                    <option value="UN CCS">UN CCS</option>
                                </select>
                            </div>
                            <div>
                                <label for="pdfTipoReporte" class="block text-sm font-medium text-gray-700">Tipo de Reporte</label>
                                <select id="pdfTipoReporte" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-inter-primary focus:ring focus:ring-inter-primary focus:ring-opacity-50 p-2 input-responsive">
                                    <option value="completo">Reporte Completo</option>
                                    <option value="pagados">Solo Pagados</option>
                                    <option value="pendientes">Solo Pendientes</option>
                                    <option value="detallado">Detallado por Categoría</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Categorías a Incluir</label>
                                <div class="space-y-2">
                                    <label class="flex items-center text-sm">
                                        <input type="checkbox" id="pdfMantenimientos" checked class="mr-2">
                                        <span>Mantenimientos</span>
                                    </label>
                                    <label class="flex items-center text-sm">
                                        <input type="checkbox" id="pdfCombustible" checked class="mr-2">
                                        <span>Combustible</span>
                                    </label>
                                    <label class="flex items-center text-sm">
                                        <input type="checkbox" id="pdfLavados" checked class="mr-2">
                                        <span>Lavados</span>
                                    </label>
                                    <label class="flex items-center text-sm">
                                        <input type="checkbox" id="pdfGasoil" checked class="mr-2">
                                        <span>Gasoil Head End</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Opciones del Reporte</label>
                                <div class="space-y-2">
                                    <label class="flex items-center text-sm">
                                        <input type="checkbox" id="pdfResumen" checked class="mr-2">
                                        <span>Incluir Resumen</span>
                                    </label>
                                    <label class="flex items-center text-sm">
                                        <input type="checkbox" id="pdfDetalle" checked class="mr-2">
                                        <span>Incluir Detalle</span>
                                    </label>
                                    <label class="flex items-center text-sm">
                                        <input type="checkbox" id="pdfSumatorias" checked class="mr-2">
                                        <span>Incluir Sumatorias</span>
                                    </label>
                                    <label class="flex items-center text-sm">
                                        <input type="checkbox" id="pdfFechaGeneracion" checked class="mr-2">
                                        <span>Incluir Fecha</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-4">
                            <button id="previewReport" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-md shadow hover:bg-blue-700 transition duration-300 btn-responsive">
                                Vista Previa
                            </button>
                            <button id="generatePDF" class="bg-inter-primary text-white font-bold py-2 px-4 rounded-md shadow hover:bg-inter-accent-light hover:text-inter-primary transition duration-300 btn-responsive">
                                Generar PDF
                            </button>
                            <button id="generateExcel" class="bg-green-600 text-white font-bold py-2 px-4 rounded-md shadow hover:bg-green-700 transition duration-300 btn-responsive">
                                Exportar Excel
                            </button>
                        </div>
                    </div>
                    
                    <!-- Vista Previa del Reporte -->
                    <div id="reportPreview" class="bg-white p-4 md:p-6 rounded-lg shadow-md mb-6 hidden">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-gray-800">Vista Previa del Reporte</h3>
                            <button id="closePreview" class="text-gray-500 hover:text-gray-700">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                        
                        <div id="previewContent" class="border border-gray-200 p-4 rounded-lg max-h-96 overflow-y-auto">
                            <!-- El contenido de la vista previa se generará aquí -->
                        </div>
                    </div>
                    
                    <!-- Información de Gastos -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <!-- Resumen de Gastos -->
                        <div class="bg-white p-4 md:p-6 rounded-lg shadow-md">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">Resumen de Gastos</h3>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">Total Pagado:</span>
                                    <span class="font-semibold text-green-600" id="resumenPagado">$0.00</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">Total Pendiente:</span>
                                    <span class="font-semibold text-yellow-600" id="resumenPendiente">$0.00</span>
                                </div>
                                <div class="flex justify-between items-center border-t pt-3">
                                    <span class="text-gray-800 font-semibold">Total General:</span>
                                    <span class="font-bold text-inter-primary" id="resumenTotal">$0.00</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Distribución por Categoría -->
                        <div class="bg-white p-4 md:p-6 rounded-lg shadow-md">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">Distribución por Categoría</h3>
                            <div id="distribucionCategoria" class="space-y-2">
                                <!-- Se llenará dinámicamente -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Tabla de Gastos Detallados -->
                    <div class="bg-white p-4 md:p-6 rounded-lg shadow-md">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Gastos Detallados</h3>
                        
                        <div class="mb-4">
                            <div class="flex flex-wrap gap-2">
                                <button id="showPagados" class="bg-green-100 text-green-700 px-3 py-1 md:px-4 md:py-2 rounded-md hover:bg-green-200 transition duration-300 text-sm">
                                    Mostrar Pagados
                                </button>
                                <button id="showPendientes" class="bg-yellow-100 text-yellow-700 px-3 py-1 md:px-4 md:py-2 rounded-md hover:bg-yellow-200 transition duration-300 text-sm">
                                    Mostrar Pendientes
                                </button>
                                <button id="showTodos" class="bg-blue-100 text-blue-700 px-3 py-1 md:px-4 md:py-2 rounded-md hover:bg-blue-200 transition duration-300 text-sm">
                                    Mostrar Todos
                                </button>
                            </div>
                        </div>
                        
                        <div class="responsive-table">
                            <table class="min-w-full bg-white border border-gray-200" id="detailedExpensesTable">
                                <thead>
                                    <tr class="bg-gray-200 text-gray-600 uppercase text-xs md:text-sm leading-normal">
                                        <th class="py-3 px-4 md:px-6 text-left">Fecha</th>
                                        <th class="py-3 px-4 md:px-6 text-left">Categoría</th>
                                        <th class="py-3 px-4 md:px-6 text-left">Vehículo</th>
                                        <th class="py-3 px-4 md:px-6 text-left">Descripción</th>
                                        <th class="py-3 px-4 md:px-6 text-left">Centro</th>
                                        <th class="py-3 px-4 md:px-6 text-left">Estado</th>
                                        <th class="py-3 px-4 md:px-6 text-left">Monto</th>
                                    </tr>
                                </thead>
                                <tbody class="text-gray-600 text-xs md:text-sm font-light" id="detailedExpensesBody">
                                    <!-- Se llenará dinámicamente -->
                                </tbody>
                                <tfoot class="bg-gray-50 font-semibold">
                                    <tr>
                                        <td colspan="6" class="py-3 px-4 md:px-6 text-right">Total Pagado:</td>
                                        <td class="py-3 px-4 md:px-6 text-left text-green-600" id="tablePagado">$0.00</td>
                                    </tr>
                                    <tr>
                                        <td colspan="6" class="py-3 px-4 md:px-6 text-right">Total Pendiente:</td>
                                        <td class="py-3 px-4 md:px-6 text-left text-yellow-600" id="tablePendiente">$0.00</td>
                                    </tr>
                                    <tr class="border-t border-gray-300">
                                        <td colspan="6" class="py-3 px-4 md:px-6 text-right font-bold">Total General:</td>
                                        <td class="py-3 px-4 md:px-6 text-left font-bold text-inter-primary" id="tableTotal">$0.00</td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </main>

    <script>
        // Variables globales para todas las pestañas
        let vehicles = JSON.parse(localStorage.getItem('vehicles')) || [];
        let maintenances = JSON.parse(localStorage.getItem('maintenances')) || [];
        let inspections = JSON.parse(localStorage.getItem('inspections')) || [];
        let fuelRecords = JSON.parse(localStorage.getItem('fuelRecords')) || [];
        let siniestros = JSON.parse(localStorage.getItem('siniestros')) || [];
        let lavados = JSON.parse(localStorage.getItem('lavados')) || [];
        let gasoilRecords = JSON.parse(localStorage.getItem('gasoilRecords')) || [];

        // Variables para los gráficos
        let monthlyComparisonChart = null;
        let expenseDistributionChart = null;

        // Variables para el control de pagos
        let mostrarSoloPendientes = {
            mantenimientos: false,
            combustible: false,
            lavados: false,
            gasoil: false
        };
        
        let mostrarSoloPendientesReporte = false;

        // Variables para reportes PDF
        let currentFilterYear = new Date().getFullYear();
        let currentFilterMonth = 'all';
        let currentFilterCenter = 'all';
        let currentViewType = 'todos'; // 'todos', 'pagados', 'pendientes'

        // ==================== FUNCIONES DE FIREBASE ====================
        
        // Función para guardar en Firebase
        async function saveToFirebase(collectionName, data) {
            try {
                if (!window.db) {
                    console.log('Firebase no está disponible, guardando solo en localStorage');
                    return null;
                }
                
                const { addDoc, collection } = window.firebaseModules;
                const docRef = await addDoc(collection(window.db, collectionName), {
                    ...data,
                    createdAt: new Date(),
                    updatedAt: new Date()
                });
                console.log(`✅ Guardado en Firebase: ${collectionName}`, docRef.id);
                return docRef.id;
            } catch (error) {
                console.error(`❌ Error guardando en Firebase (${collectionName}):`, error);
                return null;
            }
        }

        // Función para cargar desde Firebase
        async function loadFromFirebase(collectionName) {
            try {
                if (!window.db) {
                    console.log('Firebase no está disponible, cargando desde localStorage');
                    return [];
                }
                
                const { getDocs, collection } = window.firebaseModules;
                const querySnapshot = await getDocs(collection(window.db, collectionName));
                const data = [];
                querySnapshot.forEach((doc) => {
                    data.push({
                        firebaseId: doc.id,
                        ...doc.data()
                    });
                });
                console.log(`✅ Cargados ${data.length} registros de Firebase: ${collectionName}`);
                return data;
            } catch (error) {
                console.error(`❌ Error cargando desde Firebase (${collectionName}):`, error);
                return [];
            }
        }

        // Función para actualizar en Firebase
        async function updateInFirebase(collectionName, docId, data) {
            try {
                if (!window.db) {
                    console.log('Firebase no está disponible, actualizando solo en localStorage');
                    return false;
                }
                
                const { updateDoc, doc } = window.firebaseModules;
                const docRef = doc(window.db, collectionName, docId);
                await updateDoc(docRef, {
                    ...data,
                    updatedAt: new Date()
                });
                console.log(`✅ Actualizado en Firebase: ${collectionName}/${docId}`);
                return true;
            } catch (error) {
                console.error(`❌ Error actualizando en Firebase (${collectionName}/${docId}):`, error);
                return false;
            }
        }

        // Función para eliminar de Firebase
        async function deleteFromFirebase(collectionName, docId) {
            try {
                if (!window.db) {
                    console.log('Firebase no está disponible, eliminando solo de localStorage');
                    return false;
                }
                
                const { deleteDoc, doc } = window.firebaseModules;
                await deleteDoc(doc(window.db, collectionName, docId));
                console.log(`✅ Eliminado de Firebase: ${collectionName}/${docId}`);
                return true;
            } catch (error) {
                console.error(`❌ Error eliminando de Firebase (${collectionName}/${docId}):`, error);
                return false;
            }
        }

        // Función para sincronizar todos los datos con Firebase
        async function syncAllWithFirebase() {
            try {
                console.log('🔄 Sincronizando con Firebase...');
                updateSyncStatus('loading', 'Sincronizando...');
                
                // Cargar datos desde Firebase
                const [
                    fbVehicles, 
                    fbMaintenances, 
                    fbInspections, 
                    fbFuel, 
                    fbSiniestros, 
                    fbLavados, 
                    fbGasoil
                ] = await Promise.all([
                    loadFromFirebase('vehicles'),
                    loadFromFirebase('maintenances'),
                    loadFromFirebase('inspections'),
                    loadFromFirebase('fuelRecords'),
                    loadFromFirebase('siniestros'),
                    loadFromFirebase('lavados'),
                    loadFromFirebase('gasoilRecords')
                ]);

                // Combinar datos: prioridad a Firebase, luego localStorage
                vehicles = fbVehicles.length > 0 ? fbVehicles : vehicles;
                maintenances = fbMaintenances.length > 0 ? fbMaintenances : maintenances;
                inspections = fbInspections.length > 0 ? fbInspections : inspections;
                fuelRecords = fbFuel.length > 0 ? fbFuel : fuelRecords;
                siniestros = fbSiniestros.length > 0 ? fbSiniestros : siniestros;
                lavados = fbLavados.length > 0 ? fbLavados : lavados;
                gasoilRecords = fbGasoil.length > 0 ? fbGasoil : gasoilRecords;

                // Asegurar que todos los registros tengan estado de pago
                ensurePaymentStatus();

                // Guardar en localStorage como respaldo
                localStorage.setItem('vehicles', JSON.stringify(vehicles));
                localStorage.setItem('maintenances', JSON.stringify(maintenances));
                localStorage.setItem('inspections', JSON.stringify(inspections));
                localStorage.setItem('fuelRecords', JSON.stringify(fuelRecords));
                localStorage.setItem('siniestros', JSON.stringify(siniestros));
                localStorage.setItem('lavados', JSON.stringify(lavados));
                localStorage.setItem('gasoilRecords', JSON.stringify(gasoilRecords));

                console.log('✅ Sincronización completada');
                updateSyncStatus('success', 'Datos sincronizados');
                
                // Recargar la interfaz
                loadAllData();
                updateReports();
                updateTotalPendienteHeader();
                updatePDFReportData();
                
            } catch (error) {
                console.error('❌ Error en sincronización:', error);
                updateSyncStatus('error', 'Error en sincronización');
            }
        }

        // Función para asegurar que todos los registros tengan estado de pago
        function ensurePaymentStatus() {
            maintenances.forEach(m => {
                if (!m.estadoPago) m.estadoPago = 'pendiente';
            });
            fuelRecords.forEach(f => {
                if (!f.estadoPago) f.estadoPago = 'pendiente';
            });
            lavados.forEach(l => {
                if (!l.estadoPago) l.estadoPago = 'pendiente';
            });
            gasoilRecords.forEach(g => {
                if (!g.estadoPago) g.estadoPago = 'pendiente';
            });
        }

        // Función para actualizar el estado de sincronización
        function updateSyncStatus(type, message) {
            const statusElement = document.getElementById('syncStatus');
            if (statusElement) {
                statusElement.textContent = message;
                statusElement.className = `text-sm px-2 py-1 rounded ${
                    type === 'success' ? 'bg-green-500 text-white' : 
                    type === 'error' ? 'bg-red-500 text-white' : 
                    type === 'loading' ? 'bg-yellow-500 text-white' :
                    'bg-gray-500 text-white'
                }`;
            }
        }

        // ==================== FUNCIONES MEJORADAS CON ORDENACIÓN POR FECHA ====================

        // Función para ordenar datos por fecha (mes actual primero, luego meses anteriores)
        function ordenarPorFecha(datos, campoFecha = 'fecha') {
            const ahora = new Date();
            const mesActual = ahora.getMonth() + 1;
            const añoActual = ahora.getFullYear();
            
            return datos.sort((a, b) => {
                const fechaA = new Date(a[campoFecha] || a.fechaHora || a.fecha);
                const fechaB = new Date(b[campoFecha] || b.fechaHora || b.fecha);
                
                // Primero comparar por año
                const añoA = fechaA.getFullYear();
                const añoB = fechaB.getFullYear();
                
                if (añoA !== añoB) {
                    return añoB - añoA; // Años más recientes primero
                }
                
                // Luego comparar por mes (mes actual primero)
                const mesA = fechaA.getMonth() + 1;
                const mesB = fechaB.getMonth() + 1;
                
                // Si un registro es del mes actual y otro no, el del mes actual va primero
                if (mesA === mesActual && añoA === añoActual && 
                    (mesB !== mesActual || añoB !== añoActual)) {
                    return -1;
                }
                if (mesB === mesActual && añoB === añoActual && 
                    (mesA !== mesActual || añoA !== añoActual)) {
                    return 1;
                }
                
                // Si ambos son del mismo mes o ambos no son del mes actual, ordenar por fecha descendente
                return fechaB - fechaA;
            });
        }

        // Función para formatear fecha para mostrar
        function formatearFecha(fecha) {
            const date = new Date(fecha);
            return date.toLocaleDateString('es-ES', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
        }

        // Función para formatear fecha y hora
        function formatearFechaHora(fecha) {
            const date = new Date(fecha);
            return date.toLocaleDateString('es-ES', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // ==================== FUNCIONES MODIFICADAS CON FIREBASE ====================

        // Función modificada para guardar vehículos
        async function setupVehicleForm() {
            const form = document.getElementById('vehicleForm');
            if (form) {
                form.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    const id = document.getElementById('vehicleId').value;
                    const vehicle = {
                        placa: document.getElementById('placa').value,
                        marca: document.getElementById('marca').value,
                        modelo: document.getElementById('modelo').value,
                        anio: document.getElementById('anio').value,
                        centroOperaciones: document.getElementById('centroOperaciones').value,
                        capacidadTanque: document.getElementById('capacidadTanque').value,
                        departamentoAsignado: document.getElementById('departamentoAsignado').value,
                        estado: document.getElementById('estado').value,
                        lastUpdated: new Date().toISOString()
                    };

                    if (id === '') {
                        // NUEVO: Guardar en Firebase
                        const firebaseId = await saveToFirebase('vehicles', vehicle);
                        if (firebaseId) {
                            vehicle.firebaseId = firebaseId;
                        }
                        // Guardar en localStorage
                        vehicles.push(vehicle);
                        localStorage.setItem('vehicles', JSON.stringify(vehicles));
                    } else {
                        // EDITAR: Actualizar en Firebase si tiene ID
                        if (vehicles[id].firebaseId) {
                            await updateInFirebase('vehicles', vehicles[id].firebaseId, vehicle);
                        }
                        vehicles[id] = vehicle;
                        localStorage.setItem('vehicles', JSON.stringify(vehicles));
                    }

                    loadVehicleData();
                    this.reset();
                    document.getElementById('vehicleId').value = '';
                    updateReports();
                    updatePDFReportData();
                    updateSyncStatus('success', 'Guardado en Firebase');
                });
            }

            const deleteBtn = document.getElementById('deleteMassiveBtn');
            if (deleteBtn) {
                deleteBtn.addEventListener('click', async function() {
                    if (confirm('¿Está seguro de que desea eliminar TODOS los vehículos? Esta acción no se puede deshacer.')) {
                        // Eliminar de Firebase
                        for (const vehicle of vehicles) {
                            if (vehicle.firebaseId) {
                                await deleteFromFirebase('vehicles', vehicle.firebaseId);
                            }
                        }
                        // Eliminar de localStorage
                        vehicles = [];
                        localStorage.setItem('vehicles', JSON.stringify(vehicles));
                        loadVehicleData();
                        updateReports();
                        updatePDFReportData();
                        updateSyncStatus('success', 'Todos los vehículos eliminados');
                    }
                });
            }
        }

        // Función modificada para eliminar vehículo individual
        window.deleteVehicle = async function(index) {
            if (confirm('¿Está seguro de que desea eliminar este vehículo?')) {
                // Eliminar de Firebase si tiene ID
                if (vehicles[index].firebaseId) {
                    await deleteFromFirebase('vehicles', vehicles[index].firebaseId);
                }
                // Eliminar de localStorage
                vehicles.splice(index, 1);
                localStorage.setItem('vehicles', JSON.stringify(vehicles));
                loadVehicleData();
                updateReports();
                updatePDFReportData();
                updateSyncStatus('success', 'Vehículo eliminado');
            }
        };

        // ==================== SISTEMA DE CONTROL DE PAGOS ====================

        // Función modificada para guardar mantenimientos con estado de pago
        async function setupMaintenanceForm() {
            const form = document.getElementById('maintenanceForm');
            if (form) {
                form.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    const id = document.getElementById('maintenanceId').value;
                    const tipo = document.getElementById('tipoMantenimiento').value;
                    
                    const maintenance = {
                        placa: document.getElementById('placaMantenimiento').value,
                        tipo: tipo,
                        fecha: document.getElementById('fechaMantenimiento').value,
                        costo: document.getElementById('costoMantenimiento').value,
                        proveedor: document.getElementById('proveedorTaller').value,
                        centro: document.getElementById('centroMantenimiento').value,
                        estadoPago: document.getElementById('estadoPagoMantenimiento').value,
                        lastUpdated: new Date().toISOString()
                    };

                    if (tipo === 'preventivo') {
                        maintenance.kilometraje = document.getElementById('kilometrajePreventivo').value;
                        maintenance.descripcion = document.getElementById('descripcionPreventivo').value;
                    } else {
                        maintenance.descripcion = document.getElementById('descripcionCorrectivo').value;
                        maintenance.causa = document.getElementById('causaCorrectivo').value;
                    }

                    if (id === '') {
                        // NUEVO: Guardar en Firebase
                        const firebaseId = await saveToFirebase('maintenances', maintenance);
                        if (firebaseId) {
                            maintenance.firebaseId = firebaseId;
                        }
                        maintenances.push(maintenance);
                    } else {
                        // EDITAR: Actualizar en Firebase si tiene ID
                        if (maintenances[id].firebaseId) {
                            await updateInFirebase('maintenances', maintenances[id].firebaseId, maintenance);
                        }
                        maintenances[id] = maintenance;
                    }

                    localStorage.setItem('maintenances', JSON.stringify(maintenances));
                    loadMaintenanceData();
                    this.reset();
                    document.getElementById('maintenanceId').value = '';
                    updateReports();
                    updatePDFReportData();
                    updateTotalPendienteHeader();
                    updateSyncStatus('success', 'Guardado en Firebase');
                });

                const tipoSelect = document.getElementById('tipoMantenimiento');
                if (tipoSelect) {
                    tipoSelect.addEventListener('change', function() {
                        const tipo = this.value;
                        document.getElementById('camposPreventivo').classList.add('hidden');
                        document.getElementById('camposCorrectivo').classList.add('hidden');
                        
                        if (tipo === 'preventivo') {
                            document.getElementById('camposPreventivo').classList.remove('hidden');
                        } else if (tipo === 'correctivo') {
                            document.getElementById('camposCorrectivo').classList.remove('hidden');
                        }
                    });
                }
            }

            // Configurar botón de filtro para mantenimientos
            const toggleBtn = document.getElementById('togglePendientesMantenimiento');
            if (toggleBtn) {
                toggleBtn.addEventListener('click', function() {
                    mostrarSoloPendientes.mantenimientos = !mostrarSoloPendientes.mantenimientos;
                    this.textContent = mostrarSoloPendientes.mantenimientos ? 
                        'Mostrar Todos' : 'Solo Pendientes';
                    this.classList.toggle('bg-yellow-500', !mostrarSoloPendientes.mantenimientos);
                    this.classList.toggle('bg-gray-500', mostrarSoloPendientes.mantenimientos);
                    loadMaintenanceData();
                });
            }
        }

        // Función para alternar estado de pago de mantenimientos
        window.toggleEstadoPagoMantenimiento = async function(index) {
            if (index < 0 || index >= maintenances.length) return;
            
            const nuevoEstado = maintenances[index].estadoPago === 'pagado' ? 'pendiente' : 'pagado';
            const confirmacion = confirm(`¿Desea cambiar el estado de pago a "${nuevoEstado.toUpperCase()}"?`);
            
            if (confirmacion) {
                // Actualizar en Firebase si tiene ID
                if (maintenances[index].firebaseId) {
                    await updateInFirebase('maintenances', maintenances[index].firebaseId, {
                        ...maintenances[index],
                        estadoPago: nuevoEstado,
                        lastUpdated: new Date().toISOString()
                    });
                }
                
                maintenances[index].estadoPago = nuevoEstado;
                localStorage.setItem('maintenances', JSON.stringify(maintenances));
                loadMaintenanceData();
                updateReports();
                updatePDFReportData();
                updateTotalPendienteHeader();
                updateSyncStatus('success', 'Estado de pago actualizado');
            }
        };

        // Función modificada para eliminar mantenimiento
        window.deleteMaintenance = async function(index) {
            if (confirm('¿Está seguro de que desea eliminar este mantenimiento?')) {
                // Eliminar de Firebase si tiene ID
                if (maintenances[index].firebaseId) {
                    await deleteFromFirebase('maintenances', maintenances[index].firebaseId);
                }
                maintenances.splice(index, 1);
                localStorage.setItem('maintenances', JSON.stringify(maintenances));
                loadMaintenanceData();
                updateReports();
                updatePDFReportData();
                updateTotalPendienteHeader();
                updateSyncStatus('success', 'Mantenimiento eliminado');
            }
        };

        // ==================== INICIALIZACIÓN MEJORADA ====================

        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            // Verificación de que Chart.js está cargado
            if (typeof Chart === 'undefined') {
                console.error('Chart.js no está cargado correctamente');
                return;
            }
            
            initializeTabs();
            loadAllData();
            setupEventListeners();
            setupImportButtons();
            setupYearSelector();
            setupPDFYearSelector();
            updateReports();
            updatePDFReportData();
            updateTotalPendienteHeader();
            setupPDFReportListeners();
            
            // Sincronizar con Firebase al cargar la página
            setTimeout(() => {
                syncAllWithFirebase();
            }, 1000);
            
            // Configurar botón de sincronización
            const syncButton = document.getElementById('syncButton');
            if (syncButton) {
                syncButton.addEventListener('click', syncAllWithFirebase);
            }
        });

        // ==================== EL RESTO DE TU CÓDIGO ORIGINAL SE MANTIENE ====================
        
        // CORRECCIÓN: Función para configurar el selector de año
        function setupYearSelector() {
            const yearSelect = document.getElementById('reportYear');
            if (!yearSelect) return;
            
            const currentYear = new Date().getFullYear();
            yearSelect.innerHTML = '';
            
            for (let year = 2022; year <= currentYear; year++) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                if (year === currentYear) {
                    option.selected = true;
                }
                yearSelect.appendChild(option);
            }
        }

        // Configurar selector de año para PDF
        function setupPDFYearSelector() {
            const yearSelect = document.getElementById('pdfYear');
            if (!yearSelect) return;
            
            const currentYear = new Date().getFullYear();
            yearSelect.innerHTML = '';
            
            for (let year = 2022; year <= currentYear; year++) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                if (year === currentYear) {
                    option.selected = true;
                }
                yearSelect.appendChild(option);
            }
        }

        // Funciones de navegación por pestañas
        function initializeTabs() {
            const tabLinks = document.querySelectorAll('.tab-link');
            tabLinks.forEach(link => {
                link.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab-id');
                    switchTab(tabId);
                });
            });
        }

        function switchTab(tabId) {
            document.querySelectorAll('.tab-pane').forEach(pane => {
                pane.classList.add('hidden');
            });
            document.querySelectorAll('.tab-link').forEach(link => {
                link.classList.remove('active');
            });
            document.getElementById(tabId).classList.remove('hidden');
            document.querySelector(`[data-tab-id="${tabId}"]`).classList.add('active');
            
            if (tabId === 'reportes') {
                setupYearSelector();
                updateReports();
            } else if (tabId === 'reportes-pdf') {
                setupPDFYearSelector();
                updatePDFReportData();
            }
        }

        // Cargar todos los datos
        function loadAllData() {
            loadVehicleData();
            loadMaintenanceData();
            loadInspectionData();
            loadFuelData();
            loadSiniestroData();
            loadLavadoData();
            loadGasoilData();
        }

        // Funciones para Vehículos
        function loadVehicleData() {
            const tbody = document.getElementById('vehicleTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            vehicles.forEach((vehicle, index) => {
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-200 hover:bg-gray-100';
                row.innerHTML = `
                    <td class="py-3 px-4 md:px-6 text-left whitespace-nowrap font-semibold">${vehicle.placa}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${vehicle.marca}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${vehicle.modelo}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${vehicle.anio}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${vehicle.centroOperaciones}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${vehicle.capacidadTanque || 'N/A'}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${vehicle.departamentoAsignado || 'N/A'}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${vehicle.estado || 'N/A'}</td>
                    <td class="py-3 px-4 md:px-6 text-center">
                        <div class="flex flex-col md:flex-row md:space-x-1 space-y-1 md:space-y-0">
                            <button onclick="editVehicle(${index})" class="bg-blue-500 text-white px-2 py-1 md:px-3 md:py-1 rounded hover:bg-blue-600 transition duration-300 text-xs md:text-sm">Editar</button>
                            <button onclick="deleteVehicle(${index})" class="bg-red-500 text-white px-2 py-1 md:px-3 md:py-1 rounded hover:bg-red-600 transition duration-300 text-xs md:text-sm">Eliminar</button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
            updatePlacasList();
        }

        // Funciones para Mantenimientos con sistema de pagos
        function loadMaintenanceData() {
            const tbody = document.getElementById('maintenanceTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            let mantenimientosFiltrados = ordenarPorFecha(maintenances);
            
            // Aplicar filtro de pendientes si está activado
            if (mostrarSoloPendientes.mantenimientos) {
                mantenimientosFiltrados = mantenimientosFiltrados.filter(m => m.estadoPago === 'pendiente');
            }
            
            mantenimientosFiltrados.forEach((maintenance, index) => {
                const row = document.createElement('tr');
                row.className = `border-b border-gray-200 hover:bg-gray-100 ${maintenance.estadoPago === 'pagado' ? 'estado-pagado' : 'estado-pendiente'}`;
                
                // Encontrar el índice real en el array original
                const originalIndex = maintenances.findIndex(m => 
                    m.placa === maintenance.placa && 
                    m.fecha === maintenance.fecha && 
                    m.costo === maintenance.costo
                );
                
                const estadoPagoBadge = maintenance.estadoPago === 'pagado' ? 
                    '<span class="badge-pagado">PAGADO</span>' : 
                    '<span class="badge-pendiente">PENDIENTE</span>';
                
                row.innerHTML = `
                    <td class="py-3 px-4 md:px-6 text-left whitespace-nowrap font-semibold">${maintenance.placa}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${maintenance.tipo}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${formatearFecha(maintenance.fecha)}</td>
                    <td class="py-3 px-4 md:px-6 text-left font-semibold">$${parseFloat(maintenance.costo).toFixed(2)}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${maintenance.proveedor}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${maintenance.centro}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${estadoPagoBadge}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${maintenance.descripcion || 'N/A'}</td>
                    <td class="py-3 px-4 md:px-6 text-center">
                        <div class="flex flex-col space-y-1">
                            <button onclick="editMaintenance(${originalIndex})" class="bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600 transition duration-300 text-xs">Editar</button>
                            <button onclick="toggleEstadoPagoMantenimiento(${originalIndex})" class="bg-${maintenance.estadoPago === 'pagado' ? 'yellow' : 'green'}-500 text-white px-2 py-1 rounded hover:bg-${maintenance.estadoPago === 'pagado' ? 'yellow' : 'green'}-600 transition duration-300 text-xs">
                                ${maintenance.estadoPago === 'pagado' ? 'Marcar Pendiente' : 'Marcar Pagado'}
                            </button>
                            <button onclick="deleteMaintenance(${originalIndex})" class="bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600 transition duration-300 text-xs">Eliminar</button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Funciones para Inspecciones
        function loadInspectionData() {
            const tbody = document.getElementById('inspectionTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            const inspeccionesOrdenadas = ordenarPorFecha(inspections);
            
            inspeccionesOrdenadas.forEach((inspection, index) => {
                const checklistItems = Object.entries(inspection.chequeo || {})
                    .filter(([key, value]) => value === 'ok')
                    .map(([key]) => key)
                    .join(', ');
                    
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-200 hover:bg-gray-100';
                row.innerHTML = `
                    <td class="py-3 px-4 md:px-6 text-left whitespace-nowrap font-semibold">${inspection.placa}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${inspection.conductor}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${inspection.kilometraje}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${formatearFecha(inspection.fecha)}</td>
                    <td class="py-3 px-4 md:px-6 text-left text-xs">${checklistItems.substring(0, 50)}${checklistItems.length > 50 ? '...' : ''}</td>
                    <td class="py-3 px-4 md:px-6 text-left text-xs">${inspection.observaciones ? inspection.observaciones.substring(0, 50) + (inspection.observaciones.length > 50 ? '...' : '') : 'N/A'}</td>
                    <td class="py-3 px-4 md:px-6 text-center">
                        <div class="flex flex-col md:flex-row md:space-x-1 space-y-1 md:space-y-0">
                            <button onclick="editInspection(${index})" class="bg-blue-500 text-white px-2 py-1 md:px-3 md:py-1 rounded hover:bg-blue-600 transition duration-300 text-xs md:text-sm">Editar</button>
                            <button onclick="deleteInspection(${index})" class="bg-red-500 text-white px-2 py-1 md:px-3 md:py-1 rounded hover:bg-red-600 transition duration-300 text-xs md:text-sm">Eliminar</button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Funciones para Combustible con sistema de pagos
        async function setupFuelForm() {
            const form = document.getElementById('fuelForm');
            if (form) {
                form.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    const id = document.getElementById('fuelId').value;
                    const litros = parseFloat(document.getElementById('litros').value) || 0;
                    const fuel = {
                        placa: document.getElementById('placaCombustible').value,
                        fecha: document.getElementById('fechaCombustible').value,
                        litros: litros,
                        costo: litros * 0.50,
                        centro: document.getElementById('centroCombustible').value,
                        estadoPago: document.getElementById('estadoPagoCombustible').value,
                        lastUpdated: new Date().toISOString()
                    };

                    if (id === '') {
                        // NUEVO: Guardar en Firebase
                        const firebaseId = await saveToFirebase('fuelRecords', fuel);
                        if (firebaseId) {
                            fuel.firebaseId = firebaseId;
                        }
                        fuelRecords.push(fuel);
                    } else {
                        // EDITAR: Actualizar en Firebase si tiene ID
                        if (fuelRecords[id].firebaseId) {
                            await updateInFirebase('fuelRecords', fuelRecords[id].firebaseId, fuel);
                        }
                        fuelRecords[id] = fuel;
                    }

                    localStorage.setItem('fuelRecords', JSON.stringify(fuelRecords));
                    loadFuelData();
                    this.reset();
                    document.getElementById('fuelId').value = '';
                    updateReports();
                    updatePDFReportData();
                    updateTotalPendienteHeader();
                    updateSyncStatus('success', 'Guardado en Firebase');
                });

                const litrosInput = document.getElementById('litros');
                if (litrosInput) {
                    litrosInput.addEventListener('input', function() {
                        const litros = parseFloat(this.value) || 0;
                        document.getElementById('costoCombustible').value = (litros * 0.50).toFixed(2);
                    });
                }
            }

            // Configurar botón de filtro para combustible
            const toggleBtn = document.getElementById('togglePendientesCombustible');
            if (toggleBtn) {
                toggleBtn.addEventListener('click', function() {
                    mostrarSoloPendientes.combustible = !mostrarSoloPendientes.combustible;
                    this.textContent = mostrarSoloPendientes.combustible ? 
                        'Mostrar Todos' : 'Solo Pendientes';
                    this.classList.toggle('bg-yellow-500', !mostrarSoloPendientes.combustible);
                    this.classList.toggle('bg-gray-500', mostrarSoloPendientes.combustible);
                    loadFuelData();
                });
            }
        }

        function loadFuelData() {
            const tbody = document.getElementById('fuelTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            let fuelFiltrados = ordenarPorFecha(fuelRecords);
            
            // Aplicar filtro de pendientes si está activado
            if (mostrarSoloPendientes.combustible) {
                fuelFiltrados = fuelFiltrados.filter(f => f.estadoPago === 'pendiente');
            }
            
            fuelFiltrados.forEach((record, index) => {
                const row = document.createElement('tr');
                row.className = `border-b border-gray-200 hover:bg-gray-100 ${record.estadoPago === 'pagado' ? 'estado-pagado' : 'estado-pendiente'}`;
                
                // Encontrar el índice real en el array original
                const originalIndex = fuelRecords.findIndex(f => 
                    f.placa === record.placa && 
                    f.fecha === record.fecha && 
                    f.litros === record.litros
                );
                
                const estadoPagoBadge = record.estadoPago === 'pagado' ? 
                    '<span class="badge-pagado">PAGADO</span>' : 
                    '<span class="badge-pendiente">PENDIENTE</span>';
                
                row.innerHTML = `
                    <td class="py-3 px-4 md:px-6 text-left whitespace-nowrap font-semibold">${record.placa}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${formatearFecha(record.fecha)}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${record.litros} L</td>
                    <td class="py-3 px-4 md:px-6 text-left font-semibold">$${parseFloat(record.costo).toFixed(2)}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${record.centro}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${estadoPagoBadge}</td>
                    <td class="py-3 px-4 md:px-6 text-center">
                        <div class="flex flex-col space-y-1">
                            <button onclick="editFuel(${originalIndex})" class="bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600 transition duration-300 text-xs">Editar</button>
                            <button onclick="toggleEstadoPagoCombustible(${originalIndex})" class="bg-${record.estadoPago === 'pagado' ? 'yellow' : 'green'}-500 text-white px-2 py-1 rounded hover:bg-${record.estadoPago === 'pagado' ? 'yellow' : 'green'}-600 transition duration-300 text-xs">
                                ${record.estadoPago === 'pagado' ? 'Marcar Pendiente' : 'Marcar Pagado'}
                            </button>
                            <button onclick="deleteFuel(${originalIndex})" class="bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600 transition duration-300 text-xs">Eliminar</button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Función para alternar estado de pago de combustible
        window.toggleEstadoPagoCombustible = async function(index) {
            if (index < 0 || index >= fuelRecords.length) return;
            
            const nuevoEstado = fuelRecords[index].estadoPago === 'pagado' ? 'pendiente' : 'pagado';
            const confirmacion = confirm(`¿Desea cambiar el estado de pago a "${nuevoEstado.toUpperCase()}"?`);
            
            if (confirmacion) {
                // Actualizar en Firebase si tiene ID
                if (fuelRecords[index].firebaseId) {
                    await updateInFirebase('fuelRecords', fuelRecords[index].firebaseId, {
                        ...fuelRecords[index],
                        estadoPago: nuevoEstado,
                        lastUpdated: new Date().toISOString()
                    });
                }
                
                fuelRecords[index].estadoPago = nuevoEstado;
                localStorage.setItem('fuelRecords', JSON.stringify(fuelRecords));
                loadFuelData();
                updateReports();
                updatePDFReportData();
                updateTotalPendienteHeader();
                updateSyncStatus('success', 'Estado de pago actualizado');
            }
        };

        // Funciones para Siniestros
        function loadSiniestroData() {
            const tbody = document.getElementById('siniestroTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            const siniestrosOrdenados = ordenarPorFecha(siniestros, 'fechaHora');
            
            siniestrosOrdenados.forEach((siniestro, index) => {
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-200 hover:bg-gray-100';
                row.innerHTML = `
                    <td class="py-3 px-4 md:px-6 text-left whitespace-nowrap font-semibold">${siniestro.placa}</td>
                    <td class="py-3 px-4 md:px-6 text-left text-xs">${formatearFechaHora(siniestro.fechaHora)}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${siniestro.conductor}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${siniestro.poliza}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${siniestro.lugar.substring(0, 20)}${siniestro.lugar.length > 20 ? '...' : ''}</td>
                    <td class="py-3 px-4 md:px-6 text-left text-xs">${siniestro.descripcion.substring(0, 50)}...</td>
                    <td class="py-3 px-4 md:px-6 text-left font-semibold">$${parseFloat(siniestro.costoReparacion).toFixed(2)}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${siniestro.centro}</td>
                    <td class="py-3 px-4 md:px-6 text-center">
                        <div class="flex flex-col md:flex-row md:space-x-1 space-y-1 md:space-y-0">
                            <button onclick="editSiniestro(${index})" class="bg-blue-500 text-white px-2 py-1 md:px-3 md:py-1 rounded hover:bg-blue-600 transition duration-300 text-xs md:text-sm">Editar</button>
                            <button onclick="deleteSiniestro(${index})" class="bg-red-500 text-white px-2 py-1 md:px-3 md:py-1 rounded hover:bg-red-600 transition duration-300 text-xs md:text-sm">Eliminar</button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Funciones para Lavados con sistema de pagos
        async function setupLavadoForm() {
            const form = document.getElementById('lavadoForm');
            if (form) {
                form.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    const id = document.getElementById('lavadoId').value;
                    const lavado = {
                        placa: document.getElementById('placaLavado').value,
                        fecha: document.getElementById('fechaLavado').value,
                        costo: document.getElementById('costoLavado').value,
                        centro: document.getElementById('centroLavado').value,
                        estadoPago: document.getElementById('estadoPagoLavado').value,
                        lastUpdated: new Date().toISOString()
                    };

                    if (id === '') {
                        // NUEVO: Guardar en Firebase
                        const firebaseId = await saveToFirebase('lavados', lavado);
                        if (firebaseId) {
                            lavado.firebaseId = firebaseId;
                        }
                        lavados.push(lavado);
                    } else {
                        // EDITAR: Actualizar en Firebase si tiene ID
                        if (lavados[id].firebaseId) {
                            await updateInFirebase('lavados', lavados[id].firebaseId, lavado);
                        }
                        lavados[id] = lavado;
                    }

                    localStorage.setItem('lavados', JSON.stringify(lavados));
                    loadLavadoData();
                    this.reset();
                    document.getElementById('lavadoId').value = '';
                    updateReports();
                    updatePDFReportData();
                    updateTotalPendienteHeader();
                    updateSyncStatus('success', 'Guardado en Firebase');
                });
            }

            // Configurar botón de filtro para lavados
            const toggleBtn = document.getElementById('togglePendientesLavado');
            if (toggleBtn) {
                toggleBtn.addEventListener('click', function() {
                    mostrarSoloPendientes.lavados = !mostrarSoloPendientes.lavados;
                    this.textContent = mostrarSoloPendientes.lavados ? 
                        'Mostrar Todos' : 'Solo Pendientes';
                    this.classList.toggle('bg-yellow-500', !mostrarSoloPendientes.lavados);
                    this.classList.toggle('bg-gray-500', mostrarSoloPendientes.lavados);
                    loadLavadoData();
                });
            }
        }

        function loadLavadoData() {
            const tbody = document.getElementById('lavadoTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            let lavadosFiltrados = ordenarPorFecha(lavados);
            
            // Aplicar filtro de pendientes si está activado
            if (mostrarSoloPendientes.lavados) {
                lavadosFiltrados = lavadosFiltrados.filter(l => l.estadoPago === 'pendiente');
            }
            
            lavadosFiltrados.forEach((lavado, index) => {
                const row = document.createElement('tr');
                row.className = `border-b border-gray-200 hover:bg-gray-100 ${lavado.estadoPago === 'pagado' ? 'estado-pagado' : 'estado-pendiente'}`;
                
                // Encontrar el índice real en el array original
                const originalIndex = lavados.findIndex(l => 
                    l.placa === lavado.placa && 
                    l.fecha === lavado.fecha && 
                    l.costo === lavado.costo
                );
                
                const estadoPagoBadge = lavado.estadoPago === 'pagado' ? 
                    '<span class="badge-pagado">PAGADO</span>' : 
                    '<span class="badge-pendiente">PENDIENTE</span>';
                
                row.innerHTML = `
                    <td class="py-3 px-4 md:px-6 text-left whitespace-nowrap font-semibold">${lavado.placa}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${formatearFecha(lavado.fecha)}</td>
                    <td class="py-3 px-4 md:px-6 text-left font-semibold">$${parseFloat(lavado.costo).toFixed(2)}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${lavado.centro}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${estadoPagoBadge}</td>
                    <td class="py-3 px-4 md:px-6 text-center">
                        <div class="flex flex-col space-y-1">
                            <button onclick="editLavado(${originalIndex})" class="bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600 transition duration-300 text-xs">Editar</button>
                            <button onclick="toggleEstadoPagoLavado(${originalIndex})" class="bg-${lavado.estadoPago === 'pagado' ? 'yellow' : 'green'}-500 text-white px-2 py-1 rounded hover:bg-${lavado.estadoPago === 'pagado' ? 'yellow' : 'green'}-600 transition duration-300 text-xs">
                                ${lavado.estadoPago === 'pagado' ? 'Marcar Pendiente' : 'Marcar Pagado'}
                            </button>
                            <button onclick="deleteLavado(${originalIndex})" class="bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600 transition duration-300 text-xs">Eliminar</button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Función para alternar estado de pago de lavados
        window.toggleEstadoPagoLavado = async function(index) {
            if (index < 0 || index >= lavados.length) return;
            
            const nuevoEstado = lavados[index].estadoPago === 'pagado' ? 'pendiente' : 'pagado';
            const confirmacion = confirm(`¿Desea cambiar el estado de pago a "${nuevoEstado.toUpperCase()}"?`);
            
            if (confirmacion) {
                // Actualizar en Firebase si tiene ID
                if (lavados[index].firebaseId) {
                    await updateInFirebase('lavados', lavados[index].firebaseId, {
                        ...lavados[index],
                        estadoPago: nuevoEstado,
                        lastUpdated: new Date().toISOString()
                    });
                }
                
                lavados[index].estadoPago = nuevoEstado;
                localStorage.setItem('lavados', JSON.stringify(lavados));
                loadLavadoData();
                updateReports();
                updatePDFReportData();
                updateTotalPendienteHeader();
                updateSyncStatus('success', 'Estado de pago actualizado');
            }
        };

        // Funciones para Gasoil con sistema de pagos
        async function setupGasoilForm() {
            const form = document.getElementById('gasoilForm');
            if (form) {
                form.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    const id = document.getElementById('gasoilId').value;
                    const litros = parseFloat(document.getElementById('litrosGasoil').value) || 0;
                    const flete = parseFloat(document.getElementById('fleteGasoil').value) || 0;
                    const gasoil = {
                        placa: document.getElementById('placaGasoil').value,
                        fecha: document.getElementById('fechaGasoil').value,
                        litros: litros,
                        flete: flete,
                        costo: (litros * 0.48) + flete,
                        centro: document.getElementById('centroGasoil').value,
                        estadoPago: document.getElementById('estadoPagoGasoil').value,
                        lastUpdated: new Date().toISOString()
                    };

                    if (id === '') {
                        // NUEVO: Guardar en Firebase
                        const firebaseId = await saveToFirebase('gasoilRecords', gasoil);
                        if (firebaseId) {
                            gasoil.firebaseId = firebaseId;
                        }
                        gasoilRecords.push(gasoil);
                    } else {
                        // EDITAR: Actualizar en Firebase si tiene ID
                        if (gasoilRecords[id].firebaseId) {
                            await updateInFirebase('gasoilRecords', gasoilRecords[id].firebaseId, gasoil);
                        }
                        gasoilRecords[id] = gasoil;
                    }

                    localStorage.setItem('gasoilRecords', JSON.stringify(gasoilRecords));
                    loadGasoilData();
                    this.reset();
                    document.getElementById('gasoilId').value = '';
                    updateReports();
                    updatePDFReportData();
                    updateTotalPendienteHeader();
                    updateSyncStatus('success', 'Guardado en Firebase');
                });

                const litrosInput = document.getElementById('litrosGasoil');
                const fleteInput = document.getElementById('fleteGasoil');
                
                function calcularCostoGasoil() {
                    const litros = parseFloat(litrosInput.value) || 0;
                    const flete = parseFloat(fleteInput.value) || 0;
                    const costoTotal = (litros * 0.48) + flete;
                    document.getElementById('costoGasoil').value = costoTotal.toFixed(2);
                }

                if (litrosInput) {
                    litrosInput.addEventListener('input', calcularCostoGasoil);
                }
                if (fleteInput) {
                    fleteInput.addEventListener('input', calcularCostoGasoil);
                }
            }

            // Configurar botón de filtro para gasoil
            const toggleBtn = document.getElementById('togglePendientesGasoil');
            if (toggleBtn) {
                toggleBtn.addEventListener('click', function() {
                    mostrarSoloPendientes.gasoil = !mostrarSoloPendientes.gasoil;
                    this.textContent = mostrarSoloPendientes.gasoil ? 
                        'Mostrar Todos' : 'Solo Pendientes';
                    this.classList.toggle('bg-yellow-500', !mostrarSoloPendientes.gasoil);
                    this.classList.toggle('bg-gray-500', mostrarSoloPendientes.gasoil);
                    loadGasoilData();
                });
            }
        }

        function loadGasoilData() {
            const tbody = document.getElementById('gasoilTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            let gasoilFiltrados = ordenarPorFecha(gasoilRecords);
            
            // Aplicar filtro de pendientes si está activado
            if (mostrarSoloPendientes.gasoil) {
                gasoilFiltrados = gasoilFiltrados.filter(g => g.estadoPago === 'pendiente');
            }
            
            gasoilFiltrados.forEach((record, index) => {
                const row = document.createElement('tr');
                row.className = `border-b border-gray-200 hover:bg-gray-100 ${record.estadoPago === 'pagado' ? 'estado-pagado' : 'estado-pendiente'}`;
                
                // Encontrar el índice real en el array original
                const originalIndex = gasoilRecords.findIndex(g => 
                    g.placa === record.placa && 
                    g.fecha === record.fecha && 
                    g.litros === record.litros
                );
                
                const estadoPagoBadge = record.estadoPago === 'pagado' ? 
                    '<span class="badge-pagado">PAGADO</span>' : 
                    '<span class="badge-pendiente">PENDIENTE</span>';
                
                row.innerHTML = `
                    <td class="py-3 px-4 md:px-6 text-left whitespace-nowrap font-semibold">${record.placa}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${formatearFecha(record.fecha)}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${record.litros} L</td>
                    <td class="py-3 px-4 md:px-6 text-left">$${parseFloat(record.flete).toFixed(2)}</td>
                    <td class="py-3 px-4 md:px-6 text-left font-semibold">$${parseFloat(record.costo).toFixed(2)}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${record.centro}</td>
                    <td class="py-3 px-4 md:px-6 text-left">${estadoPagoBadge}</td>
                    <td class="py-3 px-4 md:px-6 text-center">
                        <div class="flex flex-col space-y-1">
                            <button onclick="editGasoil(${originalIndex})" class="bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600 transition duration-300 text-xs">Editar</button>
                            <button onclick="toggleEstadoPagoGasoil(${originalIndex})" class="bg-${record.estadoPago === 'pagado' ? 'yellow' : 'green'}-500 text-white px-2 py-1 rounded hover:bg-${record.estadoPago === 'pagado' ? 'yellow' : 'green'}-600 transition duration-300 text-xs">
                                ${record.estadoPago === 'pagado' ? 'Marcar Pendiente' : 'Marcar Pagado'}
                            </button>
                            <button onclick="deleteGasoil(${originalIndex})" class="bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600 transition duration-300 text-xs">Eliminar</button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Función para alternar estado de pago de gasoil
        window.toggleEstadoPagoGasoil = async function(index) {
            if (index < 0 || index >= gasoilRecords.length) return;
            
            const nuevoEstado = gasoilRecords[index].estadoPago === 'pagado' ? 'pendiente' : 'pagado';
            const confirmacion = confirm(`¿Desea cambiar el estado de pago a "${nuevoEstado.toUpperCase()}"?`);
            
            if (confirmacion) {
                // Actualizar en Firebase si tiene ID
                if (gasoilRecords[index].firebaseId) {
                    await updateInFirebase('gasoilRecords', gasoilRecords[index].firebaseId, {
                        ...gasoilRecords[index],
                        estadoPago: nuevoEstado,
                        lastUpdated: new Date().toISOString()
                    });
                }
                
                gasoilRecords[index].estadoPago = nuevoEstado;
                localStorage.setItem('gasoilRecords', JSON.stringify(gasoilRecords));
                loadGasoilData();
                updateReports();
                updatePDFReportData();
                updateTotalPendienteHeader();
                updateSyncStatus('success', 'Estado de pago actualizado');
            }
        };

        // FUNCIONES DE EDICIÓN Y ELIMINACIÓN PARA TODAS LAS PESTAÑAS

        // Vehículos
        window.editVehicle = function(index) {
            const vehicle = vehicles[index];
            document.getElementById('vehicleId').value = index;
            document.getElementById('placa').value = vehicle.placa;
            document.getElementById('marca').value = vehicle.marca;
            document.getElementById('modelo').value = vehicle.modelo;
            document.getElementById('anio').value = vehicle.anio;
            document.getElementById('centroOperaciones').value = vehicle.centroOperaciones;
            document.getElementById('capacidadTanque').value = vehicle.capacidadTanque || '';
            document.getElementById('departamentoAsignado').value = vehicle.departamentoAsignado || '';
            document.getElementById('estado').value = vehicle.estado || '';
        };

        // Mantenimientos
        window.editMaintenance = function(index) {
            const maintenance = maintenances[index];
            document.getElementById('maintenanceId').value = index;
            document.getElementById('placaMantenimiento').value = maintenance.placa;
            document.getElementById('tipoMantenimiento').value = maintenance.tipo;
            document.getElementById('fechaMantenimiento').value = maintenance.fecha;
            document.getElementById('costoMantenimiento').value = maintenance.costo;
            document.getElementById('proveedorTaller').value = maintenance.proveedor;
            document.getElementById('centroMantenimiento').value = maintenance.centro;
            document.getElementById('estadoPagoMantenimiento').value = maintenance.estadoPago || 'pendiente';

            document.getElementById('tipoMantenimiento').dispatchEvent(new Event('change'));
            
            if (maintenance.tipo === 'preventivo') {
                document.getElementById('kilometrajePreventivo').value = maintenance.kilometraje || '';
                document.getElementById('descripcionPreventivo').value = maintenance.descripcion || '';
            } else {
                document.getElementById('descripcionCorrectivo').value = maintenance.descripcion || '';
                document.getElementById('causaCorrectivo').value = maintenance.causa || '';
            }
        };

        // Inspecciones
        window.editInspection = function(index) {
            const inspection = inspections[index];
            document.getElementById('inspectionId').value = index;
            document.getElementById('placaInspeccion').value = inspection.placa;
            document.getElementById('conductorInspeccion').value = inspection.conductor;
            document.getElementById('kilometrajeInspeccion').value = inspection.kilometraje;
            document.getElementById('fechaInspeccion').value = inspection.fecha;
            document.getElementById('observacionesInspeccion').value = inspection.observaciones || '';

            const checkboxes = document.querySelectorAll('#inspectionForm input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = inspection.chequeo[checkbox.name] === 'ok';
            });
        };

        window.deleteInspection = async function(index) {
            if (confirm('¿Está seguro de que desea eliminar esta inspección?')) {
                // Eliminar de Firebase si tiene ID
                if (inspections[index].firebaseId) {
                    await deleteFromFirebase('inspections', inspections[index].firebaseId);
                }
                inspections.splice(index, 1);
                localStorage.setItem('inspections', JSON.stringify(inspections));
                loadInspectionData();
                updateSyncStatus('success', 'Inspección eliminada');
            }
        };

        // Combustible
        window.editFuel = function(index) {
            const record = fuelRecords[index];
            document.getElementById('fuelId').value = index;
            document.getElementById('placaCombustible').value = record.placa;
            document.getElementById('fechaCombustible').value = record.fecha;
            document.getElementById('litros').value = record.litros;
            document.getElementById('costoCombustible').value = record.costo;
            document.getElementById('centroCombustible').value = record.centro;
            document.getElementById('estadoPagoCombustible').value = record.estadoPago || 'pendiente';
        };

        window.deleteFuel = async function(index) {
            if (confirm('¿Está seguro de que desea eliminar este registro de combustible?')) {
                // Eliminar de Firebase si tiene ID
                if (fuelRecords[index].firebaseId) {
                    await deleteFromFirebase('fuelRecords', fuelRecords[index].firebaseId);
                }
                fuelRecords.splice(index, 1);
                localStorage.setItem('fuelRecords', JSON.stringify(fuelRecords));
                loadFuelData();
                updateReports();
                updatePDFReportData();
                updateTotalPendienteHeader();
                updateSyncStatus('success', 'Combustible eliminado');
            }
        };

        // Siniestros
        window.editSiniestro = function(index) {
            const siniestro = siniestros[index];
            document.getElementById('siniestroId').value = index;
            document.getElementById('placaSiniestro').value = siniestro.placa;
            document.getElementById('fechaHoraSiniestro').value = siniestro.fechaHora;
            document.getElementById('conductorSiniestro').value = siniestro.conductor;
            document.getElementById('polizaSiniestro').value = siniestro.poliza;
            document.getElementById('lugarSiniestro').value = siniestro.lugar;
            document.getElementById('descripcionSiniestro').value = siniestro.descripcion;
            document.getElementById('costoReparacion').value = siniestro.costoReparacion;
            document.getElementById('centroSiniestro').value = siniestro.centro;
        };

        window.deleteSiniestro = async function(index) {
            if (confirm('¿Está seguro de que desea eliminar este siniestro?')) {
                // Eliminar de Firebase si tiene ID
                if (siniestros[index].firebaseId) {
                    await deleteFromFirebase('siniestros', siniestros[index].firebaseId);
                }
                siniestros.splice(index, 1);
                localStorage.setItem('siniestros', JSON.stringify(siniestros));
                loadSiniestroData();
                updateReports();
                updateSyncStatus('success', 'Siniestro eliminado');
            }
        };

        // Lavados
        window.editLavado = function(index) {
            const lavado = lavados[index];
            document.getElementById('lavadoId').value = index;
            document.getElementById('placaLavado').value = lavado.placa;
            document.getElementById('fechaLavado').value = lavado.fecha;
            document.getElementById('costoLavado').value = lavado.costo;
            document.getElementById('centroLavado').value = lavado.centro;
            document.getElementById('estadoPagoLavado').value = lavado.estadoPago || 'pendiente';
        };

        window.deleteLavado = async function(index) {
            if (confirm('¿Está seguro de que desea eliminar este lavado?')) {
                // Eliminar de Firebase si tiene ID
                if (lavados[index].firebaseId) {
                    await deleteFromFirebase('lavados', lavados[index].firebaseId);
                }
                lavados.splice(index, 1);
                localStorage.setItem('lavados', JSON.stringify(lavados));
                loadLavadoData();
                updateReports();
                updatePDFReportData();
                updateTotalPendienteHeader();
                updateSyncStatus('success', 'Lavado eliminado');
            }
        };

        // Gasoil
        window.editGasoil = function(index) {
            const record = gasoilRecords[index];
            document.getElementById('gasoilId').value = index;
            document.getElementById('placaGasoil').value = record.placa;
            document.getElementById('fechaGasoil').value = record.fecha;
            document.getElementById('litrosGasoil').value = record.litros;
            document.getElementById('fleteGasoil').value = record.flete;
            document.getElementById('costoGasoil').value = record.costo;
            document.getElementById('centroGasoil').value = record.centro;
            document.getElementById('estadoPagoGasoil').value = record.estadoPago || 'pendiente';
        };

        window.deleteGasoil = async function(index) {
            if (confirm('¿Está seguro de que desea eliminar este registro de gasoil?')) {
                // Eliminar de Firebase si tiene ID
                if (gasoilRecords[index].firebaseId) {
                    await deleteFromFirebase('gasoilRecords', gasoilRecords[index].firebaseId);
                }
                gasoilRecords.splice(index, 1);
                localStorage.setItem('gasoilRecords', JSON.stringify(gasoilRecords));
                loadGasoilData();
                updateReports();
                updatePDFReportData();
                updateTotalPendienteHeader();
                updateSyncStatus('success', 'Gasoil eliminado');
            }
        };

        // FUNCIONES DE IMPORTACIÓN PARA TODAS LAS PESTAÑAS
        function setupImportButtons() {
            setupImportButton('importVehicleBtn', 'importVehicleFile', 'vehicles');
            setupImportButton('importMaintenanceBtn', 'importMaintenanceFile', 'maintenances');
            setupImportButton('importInspectionBtn', 'importInspectionFile', 'inspections');
            setupImportButton('importFuelBtn', 'importFuelFile', 'fuel');
            setupImportButton('importSiniestroBtn', 'importSiniestroFile', 'siniestros');
            setupImportButton('importLavadoBtn', 'importLavadoFile', 'lavados');
            setupImportButton('importGasoilBtn', 'importGasoilFile', 'gasoil');
        }

        function setupImportButton(buttonId, fileInputId, type) {
            const button = document.getElementById(buttonId);
            const fileInput = document.getElementById(fileInputId);
            
            if (button && fileInput) {
                button.addEventListener('click', function() {
                    fileInput.click();
                });

                fileInput.addEventListener('change', function(e) {
                    importFromExcel(e.target.files[0], type);
                });
            }
        }

        // Función de importación mejorada para todos los tipos
        function importFromExcel(file, type) {
            if (!file) {
                alert('No se seleccionó ningún archivo.');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet);

                    if (jsonData.length === 0) {
                        alert('El archivo está vacío o no tiene el formato correcto.');
                        return;
                    }

                    let importedData = [];
                    let validationErrors = [];

                    jsonData.forEach((row, index) => {
                        try {
                            let item = processRowData(row, type, index + 2);
                            if (item) {
                                importedData.push(item);
                            }
                        } catch (error) {
                            validationErrors.push(`Fila ${index + 2}: ${error.message}`);
                        }
                    });

                    if (validationErrors.length > 0) {
                        alert('Errores de validación:\n' + validationErrors.join('\n'));
                        return;
                    }

                    if (confirm(`¿Desea importar ${importedData.length} registros de ${type}?`)) {
                        saveImportedData(type, importedData);
                        alert(`Importación completada: ${importedData.length} registros importados exitosamente.`);
                    }
                } catch (error) {
                    console.error('Error en importación:', error);
                    alert('Error al importar el archivo: ' + error.message);
                }
            };
            
            reader.onerror = function(error) {
                alert('Error al leer el archivo seleccionado.');
            };
            
            reader.readAsArrayBuffer(file);
        }

        function processRowData(row, type, rowNumber) {
            switch (type) {
                case 'vehicles':
                    return processVehicleRow(row, rowNumber);
                case 'maintenances':
                    return processMaintenanceRow(row, rowNumber);
                case 'inspections':
                    return processInspectionRow(row, rowNumber);
                case 'fuel':
                    return processFuelRow(row, rowNumber);
                case 'siniestros':
                    return processSiniestroRow(row, rowNumber);
                case 'lavados':
                    return processLavadoRow(row, rowNumber);
                case 'gasoil':
                    return processGasoilRow(row, rowNumber);
                default:
                    throw new Error(`Tipo no soportado: ${type}`);
            }
        }

        function processVehicleRow(row, rowNumber) {
            const item = {
                placa: String(row.Placa || row.placa || '').toUpperCase().trim(),
                marca: String(row.Marca || row.marca || '').trim(),
                modelo: String(row.Modelo || row.modelo || '').trim(),
                anio: parseInt(row.Año || row.anio || row.Año || '0'),
                centroOperaciones: String(row['Centro de Operaciones'] || row.centroOperaciones || row.Centro || '').trim(),
                capacidadTanque: parseFloat(row['Capacidad Tanque'] || row.capacidadTanque || row.Capacidad || '0'),
                departamentoAsignado: String(row['Departamento Asignado'] || row.departamentoAsignado || row.Departamento || '').trim(),
                estado: String(row.Estado || row.estado || 'Operativo').trim()
            };
            
            if (!item.placa) throw new Error('La placa es requerida');
            if (!item.marca) throw new Error('La marca es requerida');
            if (!item.modelo) throw new Error('El modelo es requerido');
            
            return item;
        }

        function processMaintenanceRow(row, rowNumber) {
            const item = {
                placa: String(row.Placa || row.placa || '').toUpperCase().trim(),
                tipo: String(row.Tipo || row.tipo || row['Tipo de Mantenimiento'] || '').trim(),
                fecha: String(row.Fecha || row.fecha || '').trim(),
                costo: parseFloat(row.Costo || row.costo || '0'),
                proveedor: String(row.Proveedor || row.proveedor || row.Taller || '').trim(),
                centro: String(row.Centro || row.centro || row['Centro de Operaciones'] || '').trim(),
                estadoPago: String(row['Estado de Pago'] || row.estadoPago || 'pendiente').trim(),
                kilometraje: row.Kilometraje || row.kilometraje || '',
                descripcion: String(row.Descripción || row.descripcion || '').trim(),
                causa: String(row.Causa || row.causa || '').trim()
            };
            
            if (!item.placa) throw new Error('La placa es requerida');
            if (!item.tipo) throw new Error('El tipo de mantenimiento es requerido');
            if (!item.fecha) throw new Error('La fecha es requerida');
            
            return item;
        }

        function processInspectionRow(row, rowNumber) {
            const chequeo = {};
            const chequeoFields = ['Luces', 'Limpiaparabrisas', 'Liquido_de_frenos', 'Frenos', 'Cauchos', 'Retrovisores', 'Aire_acondicionado', 'Gato', 'Triangulo', 'Extintor', 'Caucho_de_repuesto', 'Documentos'];
            
            chequeoFields.forEach(field => {
                chequeo[field] = row[field] === 'ok' ? 'ok' : 'no';
            });

            const item = {
                placa: String(row.Placa || row.placa || '').toUpperCase().trim(),
                conductor: String(row.Conductor || row.conductor || '').trim(),
                kilometraje: parseFloat(row.Kilometraje || row.kilometraje || '0'),
                fecha: String(row.Fecha || row.fecha || '').trim(),
                chequeo: chequeo,
                observaciones: String(row.Observaciones || row.observaciones || '').trim()
            };
            
            if (!item.placa) throw new Error('La placa es requerida');
            if (!item.conductor) throw new Error('El conductor es requerido');
            
            return item;
        }

        function processFuelRow(row, rowNumber) {
            const litros = parseFloat(row.Litros || row.litros || '0');
            const item = {
                placa: String(row.Placa || row.placa || '').toUpperCase().trim(),
                fecha: String(row.Fecha || row.fecha || '').trim(),
                litros: litros,
                costo: litros * 0.50,
                centro: String(row.Centro || row.centro || row['Centro de Operaciones'] || '').trim(),
                estadoPago: String(row['Estado de Pago'] || row.estadoPago || 'pendiente').trim()
            };
            
            if (!item.placa) throw new Error('La placa es requerida');
            if (!item.fecha) throw new Error('La fecha es requerida');
            
            return item;
        }

        function processSiniestroRow(row, rowNumber) {
            const item = {
                placa: String(row.Placa || row.placa || '').toUpperCase().trim(),
                fechaHora: String(row['Fecha y Hora'] || row.fechaHora || row.Fecha || '').trim(),
                conductor: String(row.Conductor || row.conductor || '').trim(),
                poliza: String(row.Póliza || row.poliza || row['Número de Póliza'] || '').trim(),
                lugar: String(row.Lugar || row.lugar || row['Lugar del Siniestro'] || '').trim(),
                descripcion: String(row.Descripción || row.descripcion || row['Descripción del Siniestro'] || '').trim(),
                costoReparacion: parseFloat(row['Costo de Reparación'] || row.costoReparacion || row.Costo || '0'),
                centro: String(row.Centro || row.centro || row['Centro de Operaciones'] || '').trim()
            };
            
            if (!item.placa) throw new Error('La placa es requerida');
            if (!item.fechaHora) throw new Error('La fecha y hora son requeridas');
            
            return item;
        }

        function processLavadoRow(row, rowNumber) {
            const item = {
                placa: String(row.Placa || row.placa || '').toUpperCase().trim(),
                fecha: String(row.Fecha || row.fecha || '').trim(),
                costo: parseFloat(row.Costo || row.costo || '0'),
                centro: String(row.Centro || row.centro || row['Centro de Operaciones'] || '').trim(),
                estadoPago: String(row['Estado de Pago'] || row.estadoPago || 'pendiente').trim()
            };
            
            if (!item.placa) throw new Error('La placa es requerida');
            if (!item.fecha) throw new Error('La fecha es requerida');
            
            return item;
        }

        function processGasoilRow(row, rowNumber) {
            const litros = parseFloat(row.Litros || row.litros || '0');
            const flete = parseFloat(row.Flete || row.flete || '0');
            const item = {
                placa: String(row.Placa || row.placa || '').toUpperCase().trim(),
                fecha: String(row.Fecha || row.fecha || '').trim(),
                litros: litros,
                flete: flete,
                costo: (litros * 0.48) + flete,
                centro: String(row.Centro || row.centro || row['Centro de Operaciones'] || '').trim(),
                estadoPago: String(row['Estado de Pago'] || row.estadoPago || 'pendiente').trim()
            };
            
            if (!item.placa) throw new Error('La placa es requerida');
            if (!item.fecha) throw new Error('La fecha es requerida');
            
            return item;
        }

        async function saveImportedData(type, importedData) {
            // Guardar cada registro individualmente con Firebase
            for (const item of importedData) {
                const firebaseId = await saveToFirebase(type, item);
                if (firebaseId) {
                    item.firebaseId = firebaseId;
                }
            }

            switch (type) {
                case 'vehicles':
                    vehicles = [...vehicles, ...importedData];
                    localStorage.setItem('vehicles', JSON.stringify(vehicles));
                    loadVehicleData();
                    break;
                case 'maintenances':
                    maintenances = [...maintenances, ...importedData];
                    localStorage.setItem('maintenances', JSON.stringify(maintenances));
                    loadMaintenanceData();
                    break;
                case 'inspections':
                    inspections = [...inspections, ...importedData];
                    localStorage.setItem('inspections', JSON.stringify(inspections));
                    loadInspectionData();
                    break;
                case 'fuel':
                    fuelRecords = [...fuelRecords, ...importedData];
                    localStorage.setItem('fuelRecords', JSON.stringify(fuelRecords));
                    loadFuelData();
                    break;
                case 'siniestros':
                    siniestros = [...siniestros, ...importedData];
                    localStorage.setItem('siniestros', JSON.stringify(siniestros));
                    loadSiniestroData();
                    break;
                case 'lavados':
                    lavados = [...lavados, ...importedData];
                    localStorage.setItem('lavados', JSON.stringify(lavados));
                    loadLavadoData();
                    break;
                case 'gasoil':
                    gasoilRecords = [...gasoilRecords, ...importedData];
                    localStorage.setItem('gasoilRecords', JSON.stringify(gasoilRecords));
                    loadGasoilData();
                    break;
            }
            updateReports();
            updatePDFReportData();
            updateTotalPendienteHeader();
            updateSyncStatus('success', 'Importación completada');
        }

        // Funciones de utilidad
        function updatePlacasList() {
            const placasList = document.getElementById('placasList');
            if (placasList) {
                placasList.innerHTML = '';
                vehicles.forEach(vehicle => {
                    const option = document.createElement('option');
                    option.value = vehicle.placa;
                    placasList.appendChild(option);
                });
            }
        }

        // Configuración de event listeners para formularios
        function setupEventListeners() {
            setupVehicleForm();
            setupMaintenanceForm();
            setupInspectionForm();
            setupFuelForm();
            setupSiniestroForm();
            setupLavadoForm();
            setupGasoilForm();
            setupSearchFunctionality();
            setupReportEventListeners();
            setupExportButtons();
        }

        function setupInspectionForm() {
            const form = document.getElementById('inspectionForm');
            if (form) {
                form.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    const id = document.getElementById('inspectionId').value;
                    
                    const chequeo = {};
                    document.querySelectorAll('#inspectionForm input[type="checkbox"]').forEach(checkbox => {
                        chequeo[checkbox.name] = checkbox.checked ? 'ok' : 'no';
                    });

                    const inspection = {
                        placa: document.getElementById('placaInspeccion').value,
                        conductor: document.getElementById('conductorInspeccion').value,
                        kilometraje: document.getElementById('kilometrajeInspeccion').value,
                        fecha: document.getElementById('fechaInspeccion').value,
                        chequeo: chequeo,
                        observaciones: document.getElementById('observacionesInspeccion').value,
                        lastUpdated: new Date().toISOString()
                    };

                    if (id === '') {
                        // NUEVO: Guardar en Firebase
                        const firebaseId = await saveToFirebase('inspections', inspection);
                        if (firebaseId) {
                            inspection.firebaseId = firebaseId;
                        }
                        inspections.push(inspection);
                    } else {
                        // EDITAR: Actualizar en Firebase si tiene ID
                        if (inspections[id].firebaseId) {
                            await updateInFirebase('inspections', inspections[id].firebaseId, inspection);
                        }
                        inspections[id] = inspection;
                    }

                    localStorage.setItem('inspections', JSON.stringify(inspections));
                    loadInspectionData();
                    this.reset();
                    document.getElementById('inspectionId').value = '';
                    updateSyncStatus('success', 'Guardado en Firebase');
                });
            }
        }

        function setupSiniestroForm() {
            const form = document.getElementById('siniestroForm');
            if (form) {
                form.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    const id = document.getElementById('siniestroId').value;
                    const siniestro = {
                        placa: document.getElementById('placaSiniestro').value,
                        fechaHora: document.getElementById('fechaHoraSiniestro').value,
                        conductor: document.getElementById('conductorSiniestro').value,
                        poliza: document.getElementById('polizaSiniestro').value,
                        lugar: document.getElementById('lugarSiniestro').value,
                        descripcion: document.getElementById('descripcionSiniestro').value,
                        costoReparacion: document.getElementById('costoReparacion').value,
                        centro: document.getElementById('centroSiniestro').value,
                        lastUpdated: new Date().toISOString()
                    };

                    if (id === '') {
                        // NUEVO: Guardar en Firebase
                        const firebaseId = await saveToFirebase('siniestros', siniestro);
                        if (firebaseId) {
                            siniestro.firebaseId = firebaseId;
                        }
                        siniestros.push(siniestro);
                    } else {
                        // EDITAR: Actualizar en Firebase si tiene ID
                        if (siniestros[id].firebaseId) {
                            await updateInFirebase('siniestros', siniestros[id].firebaseId, siniestro);
                        }
                        siniestros[id] = siniestro;
                    }

                    localStorage.setItem('siniestros', JSON.stringify(siniestros));
                    loadSiniestroData();
                    this.reset();
                    document.getElementById('siniestroId').value = '';
                    updateReports();
                    updateSyncStatus('success', 'Guardado en Firebase');
                });
            }
        }

        function setupSearchFunctionality() {
            setupSearchInput('searchVehicleInput', 'vehicleTableBody');
            setupSearchInput('searchMaintenanceInput', 'maintenanceTableBody');
            setupSearchInput('searchInspectionInput', 'inspectionTableBody');
            setupSearchInput('searchFuelInput', 'fuelTableBody');
            setupSearchInput('searchSiniestroInput', 'siniestroTableBody');
            setupSearchInput('searchLavadoInput', 'lavadoTableBody');
            setupSearchInput('searchGasoilInput', 'gasoilTableBody');
        }

        function setupSearchInput(inputId, tbodyId) {
            const input = document.getElementById(inputId);
            if (input) {
                input.addEventListener('input', function(e) {
                    const searchTerm = e.target.value.toLowerCase();
                    const tbody = document.getElementById(tbodyId);
                    if (tbody) {
                        const rows = tbody.querySelectorAll('tr');
                        rows.forEach(row => {
                            const text = row.textContent.toLowerCase();
                            row.style.display = text.includes(searchTerm) ? '' : 'none';
                        });
                    }
                });
            }
        }

        // ==================== FUNCIONES PARA REPORTES CON SISTEMA DE PAGOS ====================

        function updateReports() {
            const year = document.getElementById('reportYear')?.value || new Date().getFullYear();
            const month = document.getElementById('reportMonth')?.value || 'all';
            const center = document.getElementById('reportCenter')?.value || 'all';
            
            updateSummaryCards(year, month, center);
            updateMonthlyComparisonChart(year);
            updateExpenseDistributionChart(year, center);
            updateMonthlyVehicleTables(year);
            updateFuelConsumptionTables(year);
            updateAnnualComparison(year);
            updateOriginalCounters();
            updatePaymentSummary();
        }

        function updateSummaryCards(year, month, center) {
            const msoTotal = calculateTotalExpenses('MSO', year, month, mostrarSoloPendientesReporte);
            const unccsTotal = calculateTotalExpenses('UN CCS', year, month, mostrarSoloPendientesReporte);
            
            document.getElementById('totalMSO').textContent = `$${msoTotal.toFixed(2)}`;
            document.getElementById('totalUNCCS').textContent = `$${unccsTotal.toFixed(2)}`;
            
            const prevYearMSO = calculateTotalExpenses('MSO', parseInt(year)-1, month, mostrarSoloPendientesReporte);
            const prevYearUNCCS = calculateTotalExpenses('UN CCS', parseInt(year)-1, month, mostrarSoloPendientesReporte);
            
            const msoTrend = msoTotal - prevYearMSO;
            const unccsTrend = unccsTotal - prevYearUNCCS;
            
            document.getElementById('msoTrend').textContent = 
                msoTrend >= 0 ? `+$${msoTrend.toFixed(2)} vs año anterior` : `-$${Math.abs(msoTrend).toFixed(2)} vs año anterior`;
            document.getElementById('msoTrend').className = `text-sm mt-1 ${msoTrend >= 0 ? 'text-red-600' : 'text-green-600'}`;
            
            document.getElementById('unccsTrend').textContent = 
                unccsTrend >= 0 ? `+$${unccsTrend.toFixed(2)} vs año anterior` : `-$${Math.abs(unccsTrend).toFixed(2)} vs año anterior`;
            document.getElementById('unccsTrend').className = `text-sm mt-1 ${unccsTrend >= 0 ? 'text-red-600' : 'text-green-600'}`;
        }

        function calculateTotalExpenses(center, year, month = 'all', soloPendientes = false) {
            let total = 0;
            
            // Mantenimientos - EXCLUIR PAGADOS si soloPendientes es true
            total += maintenances
                .filter(m => m.centro === center && 
                    (!soloPendientes || m.estadoPago !== 'pagado') &&
                    (month === 'all' || new Date(m.fecha).getMonth() + 1 == month) &&
                    new Date(m.fecha).getFullYear() == year)
                .reduce((sum, m) => sum + parseFloat(m.costo || 0), 0);
            
            // Combustible - EXCLUIR PAGADOS si soloPendientes es true
            total += fuelRecords
                .filter(f => f.centro === center && 
                    (!soloPendientes || f.estadoPago !== 'pagado') &&
                    (month === 'all' || new Date(f.fecha).getMonth() + 1 == month) &&
                    new Date(f.fecha).getFullYear() == year)
                .reduce((sum, f) => sum + parseFloat(f.costo || 0), 0);
            
            // Siniestros (no tienen sistema de pagos, siempre se incluyen)
            total += siniestros
                .filter(s => s.centro === center && 
                    (month === 'all' || new Date(s.fechaHora).getMonth() + 1 == month) &&
                    new Date(s.fechaHora).getFullYear() == year)
                .reduce((sum, s) => sum + parseFloat(s.costoReparacion || 0), 0);
            
            // Lavados - EXCLUIR PAGADOS si soloPendientes es true
            total += lavados
                .filter(l => l.centro === center && 
                    (!soloPendientes || l.estadoPago !== 'pagado') &&
                    (month === 'all' || new Date(l.fecha).getMonth() + 1 == month) &&
                    new Date(l.fecha).getFullYear() == year)
                .reduce((sum, l) => sum + parseFloat(l.costo || 0), 0);
            
            // Gasoil - EXCLUIR PAGADOS si soloPendientes es true
            total += gasoilRecords
                .filter(g => g.centro === center && 
                    (!soloPendientes || g.estadoPago !== 'pagado') &&
                    (month === 'all' || new Date(g.fecha).getMonth() + 1 == month) &&
                    new Date(g.fecha).getFullYear() == year)
                .reduce((sum, g) => sum + parseFloat(g.costo || 0), 0);
            
            return total;
        }

        // Función para calcular total pendiente
        function calcularTotalPendiente() {
            let totalPendiente = 0;
            
            totalPendiente += maintenances
                .filter(m => m.estadoPago === 'pendiente')
                .reduce((sum, m) => sum + parseFloat(m.costo || 0), 0);
            
            totalPendiente += fuelRecords
                .filter(f => f.estadoPago === 'pendiente')
                .reduce((sum, f) => sum + parseFloat(f.costo || 0), 0);
            
            totalPendiente += lavados
                .filter(l => l.estadoPago === 'pendiente')
                .reduce((sum, l) => sum + parseFloat(l.costo || 0), 0);
            
            totalPendiente += gasoilRecords
                .filter(g => g.estadoPago === 'pendiente')
                .reduce((sum, g) => sum + parseFloat(g.costo || 0), 0);
            
            return totalPendiente;
        }

        // Función para calcular total pagado
        function calcularTotalPagado() {
            let totalPagado = 0;
            
            totalPagado += maintenances
                .filter(m => m.estadoPago === 'pagado')
                .reduce((sum, m) => sum + parseFloat(m.costo || 0), 0);
            
            totalPagado += fuelRecords
                .filter(f => f.estadoPago === 'pagado')
                .reduce((sum, f) => sum + parseFloat(f.costo || 0), 0);
            
            totalPagado += lavados
                .filter(l => l.estadoPago === 'pagado')
                .reduce((sum, l) => sum + parseFloat(l.costo || 0), 0);
            
            totalPagado += gasoilRecords
                .filter(g => g.estadoPago === 'pagado')
                .reduce((sum, g) => sum + parseFloat(g.costo || 0), 0);
            
            return totalPagado;
        }

        // Actualizar resumen de pagos en el header
        function updateTotalPendienteHeader() {
            const totalPendiente = calcularTotalPendiente();
            const badge = document.getElementById('totalPendienteBadge');
            
            if (badge) {
                if (totalPendiente > 0) {
                    badge.textContent = `Pendiente: $${totalPendiente.toFixed(2)}`;
                    badge.classList.remove('hidden');
                } else {
                    badge.classList.add('hidden');
                }
            }
        }

        // Actualizar resumen de pagos en reportes
        function updatePaymentSummary() {
            const totalPendiente = calcularTotalPendiente();
            const totalPagado = calcularTotalPagado();
            const totalGeneral = totalPendiente + totalPagado;
            
            document.getElementById('totalPendiente').textContent = `$${totalPendiente.toFixed(2)}`;
            document.getElementById('totalPagado').textContent = `$${totalPagado.toFixed(2)}`;
            
            const porcentajePagado = totalGeneral > 0 ? (totalPagado / totalGeneral * 100).toFixed(1) : '0.0';
            document.getElementById('pendienteInfo').textContent = `${porcentajePagado}% del total`;
            document.getElementById('pagadoInfo').textContent = `${(100 - parseFloat(porcentajePagado)).toFixed(1)}% del total`;
        }

        // CORRECCIÓN: Función para gráfico de comparación mensual
        function updateMonthlyComparisonChart(year) {
            const ctx = document.getElementById('monthlyComparisonChart');
            if (!ctx) return;
            
            const months = ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'];
            const msoData = [];
            const unccsData = [];
            
            for (let month = 1; month <= 12; month++) {
                msoData.push(calculateTotalExpenses('MSO', year, month, mostrarSoloPendientesReporte));
                unccsData.push(calculateTotalExpenses('UN CCS', year, month, mostrarSoloPendientesReporte));
            }
            
            // CORRECCIÓN: Verificar si el gráfico existe antes de destruirlo
            if (monthlyComparisonChart) {
                monthlyComparisonChart.destroy();
            }
            
            monthlyComparisonChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [
                        {
                            label: 'MSO',
                            data: msoData,
                            borderColor: 'rgb(255, 99, 132)',
                            backgroundColor: 'rgba(255, 99, 132, 0.2)',
                            tension: 0.1
                        },
                        {
                            label: 'UN CCS',
                            data: unccsData,
                            borderColor: 'rgb(54, 162, 235)',
                            backgroundColor: 'rgba(54, 162, 235, 0.2)',
                            tension: 0.1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: `Comparativa Mensual ${year} ${mostrarSoloPendientesReporte ? '(Solo Pendientes)' : ''}`
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toFixed(2);
                                }
                            }
                        }
                    }
                }
            });
        }

        // CORRECCIÓN: Función para gráfico de distribución de gastos
        function updateExpenseDistributionChart(year, center = 'all') {
            const ctx = document.getElementById('expenseDistributionChart');
            if (!ctx) return;
            
            const categories = ['Mantenimientos', 'Combustible', 'Siniestros', 'Lavados', 'Gasoil'];
            let data = [];
            
            if (center === 'all') {
                data = [
                    calculateCategoryExpenses('maintenances', year, 'all', mostrarSoloPendientesReporte),
                    calculateCategoryExpenses('fuel', year, 'all', mostrarSoloPendientesReporte),
                    calculateCategoryExpenses('siniestros', year, 'all', false),
                    calculateCategoryExpenses('lavados', year, 'all', mostrarSoloPendientesReporte),
                    calculateCategoryExpenses('gasoil', year, 'all', mostrarSoloPendientesReporte)
                ];
            } else {
                data = [
                    calculateCategoryExpenses('maintenances', year, center, mostrarSoloPendientesReporte),
                    calculateCategoryExpenses('fuel', year, center, mostrarSoloPendientesReporte),
                    calculateCategoryExpenses('siniestros', year, center, false),
                    calculateCategoryExpenses('lavados', year, center, mostrarSoloPendientesReporte),
                    calculateCategoryExpenses('gasoil', year, center, mostrarSoloPendientesReporte)
                ];
            }
            
            // CORRECCIÓN: Verificar si el gráfico existe antes de destruirlo
            if (expenseDistributionChart) {
                expenseDistributionChart.destroy();
            }
            
            expenseDistributionChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: categories,
                    datasets: [{
                        label: 'Gastos por Categoría',
                        data: data,
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.6)',
                            'rgba(54, 162, 235, 0.6)',
                            'rgba(255, 206, 86, 0.6)',
                            'rgba(75, 192, 192, 0.6)',
                            'rgba(153, 102, 255, 0.6)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: `Distribución de Gastos ${year} ${mostrarSoloPendientesReporte ? '(Solo Pendientes)' : ''}`
                        }
                    }
                }
            });
        }

        function calculateCategoryExpenses(category, year, center = 'all', soloPendientes = false) {
            let total = 0;
            let records = [];
            
            switch (category) {
                case 'maintenances':
                    records = maintenances;
                    break;
                case 'fuel':
                    records = fuelRecords;
                    break;
                case 'siniestros':
                    records = siniestros;
                    break;
                case 'lavados':
                    records = lavados;
                    break;
                case 'gasoil':
                    records = gasoilRecords;
                    break;
            }
            
            const filteredRecords = records.filter(record => 
                (center === 'all' || record.centro === center) &&
                (!soloPendientes || category === 'siniestros' || record.estadoPago !== 'pagado') &&
                new Date(record.fecha || record.fechaHora).getFullYear() == year
            );
            
            filteredRecords.forEach(record => {
                if (category === 'siniestros') {
                    total += parseFloat(record.costoReparacion || 0);
                } else {
                    total += parseFloat(record.costo || 0);
                }
            });
            
            return total;
        }

        function updateMonthlyVehicleTables(year) {
            updateVehicleTable('MSO', year, 'msoMonthlyTableBody');
            updateVehicleTable('UN CCS', year, 'unccsMonthlyTableBody');
        }

        function updateVehicleTable(center, year, tableBodyId) {
            const tbody = document.getElementById(tableBodyId);
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            const centerVehicles = vehicles.filter(v => v.centroOperaciones === center);
            const vehiclePlacas = [...new Set(centerVehicles.map(v => v.placa))];
            
            vehiclePlacas.forEach(placa => {
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-200 hover:bg-gray-100';
                
                let rowHTML = `<td class="py-3 px-4 md:px-6 text-left font-semibold">${placa}</td>`;
                let yearlyTotal = 0;
                
                for (let month = 1; month <= 12; month++) {
                    const monthlyExpense = calculateVehicleMonthlyExpense(placa, year, month);
                    yearlyTotal += monthlyExpense;
                    rowHTML += `<td class="py-3 px-2 md:px-3 text-left">$${monthlyExpense.toFixed(2)}</td>`;
                }
                
                rowHTML += `<td class="py-3 px-4 md:px-6 text-left font-bold text-inter-primary">$${yearlyTotal.toFixed(2)}</td>`;
                row.innerHTML = rowHTML;
                tbody.appendChild(row);
            });
            
            const totalRow = document.createElement('tr');
            totalRow.className = 'border-t-2 border-gray-300 bg-gray-50 font-bold';
            let totalHTML = `<td class="py-3 px-4 md:px-6 text-left">TOTAL ${center}</td>`;
            let grandTotal = 0;
            
            for (let month = 1; month <= 12; month++) {
                const monthTotal = calculateTotalExpenses(center, year, month, mostrarSoloPendientesReporte);
                grandTotal += monthTotal;
                totalHTML += `<td class="py-3 px-2 md:px-3 text-left text-inter-primary">$${monthTotal.toFixed(2)}</td>`;
            }
            
            totalHTML += `<td class="py-3 px-4 md:px-6 text-left text-inter-primary">$${grandTotal.toFixed(2)}</td>`;
            totalRow.innerHTML = totalHTML;
            tbody.appendChild(totalRow);
        }

        function calculateVehicleMonthlyExpense(placa, year, month) {
            let total = 0;
            
            total += maintenances
                .filter(m => m.placa === placa && 
                    (!mostrarSoloPendientesReporte || m.estadoPago !== 'pagado') &&
                    new Date(m.fecha).getMonth() + 1 == month &&
                    new Date(m.fecha).getFullYear() == year)
                .reduce((sum, m) => sum + parseFloat(m.costo || 0), 0);
            
            total += fuelRecords
                .filter(f => f.placa === placa && 
                    (!mostrarSoloPendientesReporte || f.estadoPago !== 'pagado') &&
                    new Date(f.fecha).getMonth() + 1 == month &&
                    new Date(f.fecha).getFullYear() == year)
                .reduce((sum, f) => sum + parseFloat(f.costo || 0), 0);
            
            total += siniestros
                .filter(s => s.placa === placa && 
                    new Date(s.fechaHora).getMonth() + 1 == month &&
                    new Date(s.fechaHora).getFullYear() == year)
                .reduce((sum, s) => sum + parseFloat(s.costoReparacion || 0), 0);
            
            total += lavados
                .filter(l => l.placa === placa && 
                    (!mostrarSoloPendientesReporte || l.estadoPago !== 'pagado') &&
                    new Date(l.fecha).getMonth() + 1 == month &&
                    new Date(l.fecha).getFullYear() == year)
                .reduce((sum, l) => sum + parseFloat(l.costo || 0), 0);
            
            total += gasoilRecords
                .filter(g => g.placa === placa && 
                    (!mostrarSoloPendientesReporte || g.estadoPago !== 'pagado') &&
                    new Date(g.fecha).getMonth() + 1 == month &&
                    new Date(g.fecha).getFullYear() == year)
                .reduce((sum, g) => sum + parseFloat(g.costo || 0), 0);
            
            return total;
        }

        function updateFuelConsumptionTables(year) {
            updateFuelTable('MSO', year, 'msoFuelTableBody');
            updateFuelTable('UN CCS', year, 'unccsFuelTableBody');
        }

        function updateFuelTable(center, year, tableBodyId) {
            const tbody = document.getElementById(tableBodyId);
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            const centerVehicles = vehicles.filter(v => v.centroOperaciones === center);
            const vehiclePlacas = [...new Set(centerVehicles.map(v => v.placa))];
            
            vehiclePlacas.forEach(placa => {
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-200 hover:bg-gray-100';
                
                let rowHTML = `<td class="py-3 px-4 md:px-6 text-left font-semibold">${placa}</td>`;
                let yearlyTotalLitros = 0;
                let yearlyTotalCosto = 0;
                
                for (let month = 1; month <= 12; month++) {
                    const monthlyFuel = calculateVehicleMonthlyFuel(placa, year, month);
                    yearlyTotalLitros += monthlyFuel.litros;
                    yearlyTotalCosto += monthlyFuel.costo;
                    rowHTML += `<td class="py-3 px-2 md:px-3 text-left">${monthlyFuel.litros.toFixed(2)}</td>`;
                }
                
                rowHTML += `<td class="py-3 px-4 md:px-6 text-left font-bold text-inter-primary">${yearlyTotalLitros.toFixed(2)}</td>`;
                rowHTML += `<td class="py-3 px-4 md:px-6 text-left font-bold text-inter-primary">$${yearlyTotalCosto.toFixed(2)}</td>`;
                row.innerHTML = rowHTML;
                tbody.appendChild(row);
            });
            
            const totalRow = document.createElement('tr');
            totalRow.className = 'border-t-2 border-gray-300 bg-gray-50 font-bold';
            let totalHTML = `<td class="py-3 px-4 md:px-6 text-left">TOTAL ${center}</td>`;
            let grandTotalLitros = 0;
            let grandTotalCosto = 0;
            
            for (let month = 1; month <= 12; month++) {
                const monthFuel = calculateCenterMonthlyFuel(center, year, month);
                grandTotalLitros += monthFuel.litros;
                grandTotalCosto += monthFuel.costo;
                totalHTML += `<td class="py-3 px-2 md:px-3 text-left text-inter-primary">${monthFuel.litros.toFixed(2)}</td>`;
            }
            
            totalHTML += `<td class="py-3 px-4 md:px-6 text-left text-inter-primary">${grandTotalLitros.toFixed(2)}</td>`;
            totalHTML += `<td class="py-3 px-4 md:px-6 text-left text-inter-primary">$${grandTotalCosto.toFixed(2)}</td>`;
            totalRow.innerHTML = totalHTML;
            tbody.appendChild(totalRow);
        }

        function calculateVehicleMonthlyFuel(placa, year, month) {
            let litros = 0;
            let costo = 0;
            
            fuelRecords
                .filter(f => f.placa === placa && 
                    (!mostrarSoloPendientesReporte || f.estadoPago !== 'pagado') &&
                    new Date(f.fecha).getMonth() + 1 == month &&
                    new Date(f.fecha).getFullYear() == year)
                .forEach(f => {
                    litros += parseFloat(f.litros || 0);
                    costo += parseFloat(f.costo || 0);
                });
            
            return { litros, costo };
        }

        function calculateCenterMonthlyFuel(center, year, month) {
            let litros = 0;
            let costo = 0;
            
            fuelRecords
                .filter(f => f.centro === center && 
                    (!mostrarSoloPendientesReporte || f.estadoPago !== 'pagado') &&
                    new Date(f.fecha).getMonth() + 1 == month &&
                    new Date(f.fecha).getFullYear() == year)
                .forEach(f => {
                    litros += parseFloat(f.litros || 0);
                    costo += parseFloat(f.costo || 0);
                });
            
            return { litros, costo };
        }

        function updateAnnualComparison(year) {
            updateAnnualBreakdown('MSO', year, 'msoAnnualBreakdown');
            updateAnnualBreakdown('UN CCS', year, 'unccsAnnualBreakdown');
        }

        function updateAnnualBreakdown(center, year, elementId) {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            const categories = {
                'Mantenimientos': calculateCategoryExpenses('maintenances', year, center, mostrarSoloPendientesReporte),
                'Combustible': calculateCategoryExpenses('fuel', year, center, mostrarSoloPendientesReporte),
                'Siniestros': calculateCategoryExpenses('siniestros', year, center, false),
                'Lavados': calculateCategoryExpenses('lavados', year, center, mostrarSoloPendientesReporte),
                'Gasoil': calculateCategoryExpenses('gasoil', year, center, mostrarSoloPendientesReporte)
            };
            
            let html = '';
            let total = 0;
            
            Object.entries(categories).forEach(([category, amount]) => {
                total += amount;
                const percentage = total > 0 ? ((amount / total) * 100).toFixed(1) : '0.0';
                html += `
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600 text-sm">${category}</span>
                        <div class="flex items-center space-x-2">
                            <span class="font-semibold text-sm">$${amount.toFixed(2)}</span>
                            <span class="text-xs text-gray-500">${percentage}%</span>
                        </div>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div class="bg-inter-primary h-2 rounded-full" style="width: ${percentage}%"></div>
                    </div>
                `;
            });
            
            html += `
                <div class="flex justify-between items-center pt-2 border-t border-gray-300 mt-2">
                    <span class="font-bold text-gray-800 text-sm">TOTAL ANUAL</span>
                    <span class="font-bold text-inter-primary text-sm">$${total.toFixed(2)}</span>
                </div>
            `;
            
            element.innerHTML = html;
        }

        function updateOriginalCounters() {
            document.getElementById('totalVehicles').textContent = vehicles.length;
            document.getElementById('totalMaintenances').textContent = maintenances.length;
            document.getElementById('totalFuel').textContent = fuelRecords.reduce((sum, record) => sum + parseFloat(record.litros || 0), 0).toFixed(2) + ' L';
            document.getElementById('totalSiniestros').textContent = siniestros.length;
            document.getElementById('totalLavados').textContent = lavados.length;
            document.getElementById('totalGasoil').textContent = gasoilRecords.reduce((sum, record) => sum + parseFloat(record.litros || 0), 0).toFixed(2) + ' L';
        }

        // Configuración de event listeners para reportes
        function setupReportEventListeners() {
            const applyFiltersBtn = document.getElementById('applyFilters');
            if (applyFiltersBtn) {
                applyFiltersBtn.addEventListener('click', updateReports);
            }
            
            const mostrarSoloPendientesBtn = document.getElementById('mostrarSoloPendientesReporte');
            if (mostrarSoloPendientesBtn) {
                mostrarSoloPendientesBtn.addEventListener('click', function() {
                    mostrarSoloPendientesReporte = !mostrarSoloPendientesReporte;
                    this.textContent = mostrarSoloPendientesReporte ? 
                        'Mostrar Todos' : 'Solo Pendientes de Pago';
                    this.classList.toggle('bg-yellow-500', !mostrarSoloPendientesReporte);
                    this.classList.toggle('bg-gray-500', mostrarSoloPendientesReporte);
                    updateReports();
                });
            }
            
            const filterSelects = ['reportYear', 'reportMonth', 'reportCenter'];
            filterSelects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    select.addEventListener('change', updateReports);
                }
            });
        }

        // Configuración de botones de exportación
        function setupExportButtons() {
            setupExportButton('exportVehicleBtn', 'vehicles');
            setupExportButton('exportMaintenanceBtn', 'maintenances');
            setupExportButton('exportInspectionBtn', 'inspections');
            setupExportButton('exportFuelBtn', 'fuel');
            setupExportButton('exportSiniestroBtn', 'siniestros');
            setupExportButton('exportLavadoBtn', 'lavados');
            setupExportButton('exportGasoilBtn', 'gasoil');
        }

        function setupExportButton(buttonId, type) {
            const button = document.getElementById(buttonId);
            if (button) {
                button.addEventListener('click', function() {
                    exportToExcel(type);
                });
            }
        }

        function exportToExcel(type) {
            let data = [];
            let fileName = '';
            let headers = [];

            switch (type) {
                case 'vehicles':
                    data = vehicles;
                    fileName = 'vehiculos.xlsx';
                    headers = ['Placa', 'Marca', 'Modelo', 'Año', 'Centro de Operaciones', 'Capacidad Tanque', 'Departamento Asignado', 'Estado'];
                    break;
                case 'maintenances':
                    data = maintenances;
                    fileName = 'mantenimientos.xlsx';
                    headers = ['Placa', 'Tipo', 'Fecha', 'Costo', 'Proveedor/Taller', 'Centro de Operaciones', 'Estado de Pago', 'Descripción'];
                    break;
                case 'inspections':
                    data = inspections;
                    fileName = 'inspecciones.xlsx';
                    headers = ['Placa', 'Conductor', 'Kilometraje', 'Fecha', 'Chequeo', 'Observaciones'];
                    break;
                case 'fuel':
                    data = fuelRecords;
                    fileName = 'combustible.xlsx';
                    headers = ['Placa', 'Fecha', 'Litros', 'Costo', 'Centro de Operaciones', 'Estado de Pago'];
                    break;
                case 'siniestros':
                    data = siniestros;
                    fileName = 'siniestros.xlsx';
                    headers = ['Placa', 'Fecha y Hora', 'Conductor', 'Póliza', 'Lugar', 'Descripción', 'Costo Reparación', 'Centro de Operaciones'];
                    break;
                case 'lavados':
                    data = lavados;
                    fileName = 'lavados.xlsx';
                    headers = ['Placa', 'Fecha', 'Costo', 'Centro de Operaciones', 'Estado de Pago'];
                    break;
                case 'gasoil':
                    data = gasoilRecords;
                    fileName = 'gasoil.xlsx';
                    headers = ['Placa', 'Fecha', 'Litros', 'Flete', 'Costo Total', 'Centro de Operaciones', 'Estado de Pago'];
                    break;
            }

            if (data.length === 0) {
                alert('No hay datos para exportar.');
                return;
            }

            const ws = XLSX.utils.json_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Datos');
            
            XLSX.writeFile(wb, fileName);
        }

        // ==================== FUNCIONES PARA REPORTES PDF ====================

        // Configurar event listeners para reportes PDF
        function setupPDFReportListeners() {
            // Botones de vista
            document.getElementById('showPagados')?.addEventListener('click', function() {
                currentViewType = 'pagados';
                updatePDFReportData();
                updateViewButtons();
            });
            
            document.getElementById('showPendientes')?.addEventListener('click', function() {
                currentViewType = 'pendientes';
                updatePDFReportData();
                updateViewButtons();
            });
            
            document.getElementById('showTodos')?.addEventListener('click', function() {
                currentViewType = 'todos';
                updatePDFReportData();
                updateViewButtons();
            });
            
            // Botones de generación
            document.getElementById('previewReport')?.addEventListener('click', function() {
                previewPDFReport();
            });
            
            document.getElementById('generatePDF')?.addEventListener('click', function() {
                generatePDFReport();
            });
            
            document.getElementById('generateExcel')?.addEventListener('click', function() {
                generateExcelReport();
            });
            
            document.getElementById('closePreview')?.addEventListener('click', function() {
                document.getElementById('reportPreview').classList.add('hidden');
            });
            
            // Filtros
            const filterSelects = ['pdfYear', 'pdfMonth', 'pdfCenter', 'pdfTipoReporte'];
            filterSelects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    select.addEventListener('change', function() {
                        updatePDFReportData();
                    });
                }
            });
            
            // Checkboxes de categorías
            const categoryCheckboxes = ['pdfMantenimientos', 'pdfCombustible', 'pdfLavados', 'pdfGasoil'];
            categoryCheckboxes.forEach(checkboxId => {
                const checkbox = document.getElementById(checkboxId);
                if (checkbox) {
                    checkbox.addEventListener('change', function() {
                        updatePDFReportData();
                    });
                }
            });
        }

        // Actualizar datos del reporte PDF
        function updatePDFReportData() {
            currentFilterYear = document.getElementById('pdfYear')?.value || new Date().getFullYear();
            currentFilterMonth = document.getElementById('pdfMonth')?.value || 'all';
            currentFilterCenter = document.getElementById('pdfCenter')?.value || 'all';
            
            updateSummaryData();
            updateDetailedTable();
            updateDistributionData();
        }

        // Actualizar resumen de datos
        function updateSummaryData() {
            const year = currentFilterYear;
            const month = currentFilterMonth;
            const center = currentFilterCenter;
            
            // Calcular totales
            let totalPagado = 0;
            let totalPendiente = 0;
            let totalGeneral = 0;
            
            // Mantenimientos
            if (document.getElementById('pdfMantenimientos')?.checked) {
                const mantenimientosPagados = maintenances.filter(m => 
                    m.estadoPago === 'pagado' &&
                    (center === 'all' || m.centro === center) &&
                    (month === 'all' || new Date(m.fecha).getMonth() + 1 == month) &&
                    new Date(m.fecha).getFullYear() == year
                );
                
                const mantenimientosPendientes = maintenances.filter(m => 
                    m.estadoPago === 'pendiente' &&
                    (center === 'all' || m.centro === center) &&
                    (month === 'all' || new Date(m.fecha).getMonth() + 1 == month) &&
                    new Date(m.fecha).getFullYear() == year
                );
                
                totalPagado += mantenimientosPagados.reduce((sum, m) => sum + parseFloat(m.costo || 0), 0);
                totalPendiente += mantenimientosPendientes.reduce((sum, m) => sum + parseFloat(m.costo || 0), 0);
            }
            
            // Combustible
            if (document.getElementById('pdfCombustible')?.checked) {
                const combustiblePagado = fuelRecords.filter(f => 
                    f.estadoPago === 'pagado' &&
                    (center === 'all' || f.centro === center) &&
                    (month === 'all' || new Date(f.fecha).getMonth() + 1 == month) &&
                    new Date(f.fecha).getFullYear() == year
                );
                
                const combustiblePendiente = fuelRecords.filter(f => 
                    f.estadoPago === 'pendiente' &&
                    (center === 'all' || f.centro === center) &&
                    (month === 'all' || new Date(f.fecha).getMonth() + 1 == month) &&
                    new Date(f.fecha).getFullYear() == year
                );
                
                totalPagado += combustiblePagado.reduce((sum, f) => sum + parseFloat(f.costo || 0), 0);
                totalPendiente += combustiblePendiente.reduce((sum, f) => sum + parseFloat(f.costo || 0), 0);
            }
            
            // Lavados
            if (document.getElementById('pdfLavados')?.checked) {
                const lavadosPagados = lavados.filter(l => 
                    l.estadoPago === 'pagado' &&
                    (center === 'all' || l.centro === center) &&
                    (month === 'all' || new Date(l.fecha).getMonth() + 1 == month) &&
                    new Date(l.fecha).getFullYear() == year
                );
                
                const lavadosPendientes = lavados.filter(l => 
                    l.estadoPago === 'pendiente' &&
                    (center === 'all' || l.centro === center) &&
                    (month === 'all' || new Date(l.fecha).getMonth() + 1 == month) &&
                    new Date(l.fecha).getFullYear() == year
                );
                
                totalPagado += lavadosPagados.reduce((sum, l) => sum + parseFloat(l.costo || 0), 0);
                totalPendiente += lavadosPendientes.reduce((sum, l) => sum + parseFloat(l.costo || 0), 0);
            }
            
            // Gasoil
            if (document.getElementById('pdfGasoil')?.checked) {
                const gasoilPagado = gasoilRecords.filter(g => 
                    g.estadoPago === 'pagado' &&
                    (center === 'all' || g.centro === center) &&
                    (month === 'all' || new Date(g.fecha).getMonth() + 1 == month) &&
                    new Date(g.fecha).getFullYear() == year
                );
                
                const gasoilPendiente = gasoilRecords.filter(g => 
                    g.estadoPago === 'pendiente' &&
                    (center === 'all' || g.centro === center) &&
                    (month === 'all' || new Date(g.fecha).getMonth() + 1 == month) &&
                    new Date(g.fecha).getFullYear() == year
                );
                
                totalPagado += gasoilPagado.reduce((sum, g) => sum + parseFloat(g.costo || 0), 0);
                totalPendiente += gasoilPendiente.reduce((sum, g) => sum + parseFloat(g.costo || 0), 0);
            }
            
            totalGeneral = totalPagado + totalPendiente;
            
            // Actualizar UI
            document.getElementById('resumenPagado').textContent = `$${totalPagado.toFixed(2)}`;
            document.getElementById('resumenPendiente').textContent = `$${totalPendiente.toFixed(2)}`;
            document.getElementById('resumenTotal').textContent = `$${totalGeneral.toFixed(2)}`;
            
            document.getElementById('tablePagado').textContent = `$${totalPagado.toFixed(2)}`;
            document.getElementById('tablePendiente').textContent = `$${totalPendiente.toFixed(2)}`;
            document.getElementById('tableTotal').textContent = `$${totalGeneral.toFixed(2)}`;
        }

        // Actualizar tabla detallada
        function updateDetailedTable() {
            const tbody = document.getElementById('detailedExpensesBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            const year = currentFilterYear;
            const month = currentFilterMonth;
            const center = currentFilterCenter;
            
            let allExpenses = [];
            
            // Agregar mantenimientos si están seleccionados
            if (document.getElementById('pdfMantenimientos')?.checked) {
                const mantenimientosFiltrados = maintenances.filter(m => 
                    (center === 'all' || m.centro === center) &&
                    (month === 'all' || new Date(m.fecha).getMonth() + 1 == month) &&
                    new Date(m.fecha).getFullYear() == year
                );
                
                mantenimientosFiltrados.forEach(m => {
                    allExpenses.push({
                        fecha: formatearFecha(m.fecha),
                        categoria: `Mantenimiento ${m.tipo}`,
                        vehiculo: m.placa,
                        descripcion: m.descripcion || 'Sin descripción',
                        centro: m.centro,
                        estado: m.estadoPago,
                        monto: parseFloat(m.costo || 0),
                        tipo: 'mantenimiento'
                    });
                });
            }
            
            // Agregar combustible si está seleccionado
            if (document.getElementById('pdfCombustible')?.checked) {
                const combustibleFiltrado = fuelRecords.filter(f => 
                    (center === 'all' || f.centro === center) &&
                    (month === 'all' || new Date(f.fecha).getMonth() + 1 == month) &&
                    new Date(f.fecha).getFullYear() == year
                );
                
                combustibleFiltrado.forEach(f => {
                    allExpenses.push({
                        fecha: formatearFecha(f.fecha),
                        categoria: 'Combustible',
                        vehiculo: f.placa,
                        descripcion: `${f.litros} litros`,
                        centro: f.centro,
                        estado: f.estadoPago,
                        monto: parseFloat(f.costo || 0),
                        tipo: 'combustible'
                    });
                });
            }
            
            // Agregar lavados si están seleccionados
            if (document.getElementById('pdfLavados')?.checked) {
                const lavadosFiltrados = lavados.filter(l => 
                    (center === 'all' || l.centro === center) &&
                    (month === 'all' || new Date(l.fecha).getMonth() + 1 == month) &&
                    new Date(l.fecha).getFullYear() == year
                );
                
                lavadosFiltrados.forEach(l => {
                    allExpenses.push({
                        fecha: formatearFecha(l.fecha),
                        categoria: 'Lavado',
                        vehiculo: l.placa,
                        descripcion: 'Lavado de vehículo',
                        centro: l.centro,
                        estado: l.estadoPago,
                        monto: parseFloat(l.costo || 0),
                        tipo: 'lavado'
                    });
                });
            }
            
            // Agregar gasoil si está seleccionado
            if (document.getElementById('pdfGasoil')?.checked) {
                const gasoilFiltrado = gasoilRecords.filter(g => 
                    (center === 'all' || g.centro === center) &&
                    (month === 'all' || new Date(g.fecha).getMonth() + 1 == month) &&
                    new Date(g.fecha).getFullYear() == year
                );
                
                gasoilFiltrado.forEach(g => {
                    allExpenses.push({
                        fecha: formatearFecha(g.fecha),
                        categoria: 'Gasoil Head End',
                        vehiculo: g.placa,
                        descripcion: `${g.litros} litros + flete $${g.flete}`,
                        centro: g.centro,
                        estado: g.estadoPago,
                        monto: parseFloat(g.costo || 0),
                        tipo: 'gasoil'
                    });
                });
            }
            
            // Ordenar por fecha (más reciente primero)
            allExpenses.sort((a, b) => {
                const dateA = new Date(a.fecha.split('/').reverse().join('-'));
                const dateB = new Date(b.fecha.split('/').reverse().join('-'));
                return dateB - dateA;
            });
            
            // Filtrar según la vista actual
            let filteredExpenses = allExpenses;
            if (currentViewType === 'pagados') {
                filteredExpenses = allExpenses.filter(e => e.estado === 'pagado');
            } else if (currentViewType === 'pendientes') {
                filteredExpenses = allExpenses.filter(e => e.estado === 'pendiente');
            }
            
            // Agregar filas a la tabla
            filteredExpenses.forEach(expense => {
                const row = document.createElement('tr');
                row.className = `border-b border-gray-200 hover:bg-gray-100 ${expense.estado === 'pagado' ? 'estado-pagado' : 'estado-pendiente'}`;
                
                const estadoBadge = expense.estado === 'pagado' ? 
                    '<span class="badge-pagado">PAGADO</span>' : 
                    '<span class="badge-pendiente">PENDIENTE</span>';
                
                row.innerHTML = `
                    <td class="py-3 px-4 md:px-6 text-left text-xs md:text-sm">${expense.fecha}</td>
                    <td class="py-3 px-4 md:px-6 text-left text-xs md:text-sm">${expense.categoria}</td>
                    <td class="py-3 px-4 md:px-6 text-left font-semibold text-xs md:text-sm">${expense.vehiculo}</td>
                    <td class="py-3 px-4 md:px-6 text-left text-xs md:text-sm">${expense.descripcion}</td>
                    <td class="py-3 px-4 md:px-6 text-left text-xs md:text-sm">${expense.centro}</td>
                    <td class="py-3 px-4 md:px-6 text-left text-xs md:text-sm">${estadoBadge}</td>
                    <td class="py-3 px-4 md:px-6 text-left font-semibold text-xs md:text-sm">$${expense.monto.toFixed(2)}</td>
                `;
                tbody.appendChild(row);
            });
            
            // Actualizar botones de vista
            updateViewButtons();
        }

        // Actualizar botones de vista
        function updateViewButtons() {
            const showPagados = document.getElementById('showPagados');
            const showPendientes = document.getElementById('showPendientes');
            const showTodos = document.getElementById('showTodos');
            
            if (showPagados && showPendientes && showTodos) {
                // Resetear todos los botones
                showPagados.classList.remove('bg-green-600', 'text-white');
                showPagados.classList.add('bg-green-100', 'text-green-700');
                
                showPendientes.classList.remove('bg-yellow-600', 'text-white');
                showPendientes.classList.add('bg-yellow-100', 'text-yellow-700');
                
                showTodos.classList.remove('bg-blue-600', 'text-white');
                showTodos.classList.add('bg-blue-100', 'text-blue-700');
                
                // Activar el botón correspondiente
                if (currentViewType === 'pagados') {
                    showPagados.classList.remove('bg-green-100', 'text-green-700');
                    showPagados.classList.add('bg-green-600', 'text-white');
                } else if (currentViewType === 'pendientes') {
                    showPendientes.classList.remove('bg-yellow-100', 'text-yellow-700');
                    showPendientes.classList.add('bg-yellow-600', 'text-white');
                } else {
                    showTodos.classList.remove('bg-blue-100', 'text-blue-700');
                    showTodos.classList.add('bg-blue-600', 'text-white');
                }
            }
        }

        // Actualizar datos de distribución
        function updateDistributionData() {
            const element = document.getElementById('distribucionCategoria');
            if (!element) return;
            
            const year = currentFilterYear;
            const month = currentFilterMonth;
            const center = currentFilterCenter;
            
            let categorias = {};
            let totalGeneral = 0;
            
            // Mantenimientos
            if (document.getElementById('pdfMantenimientos')?.checked) {
                const mantenimientos = maintenances.filter(m => 
                    (center === 'all' || m.centro === center) &&
                    (month === 'all' || new Date(m.fecha).getMonth() + 1 == month) &&
                    new Date(m.fecha).getFullYear() == year
                );
                
                const totalMantenimientos = mantenimientos.reduce((sum, m) => sum + parseFloat(m.costo || 0), 0);
                categorias['Mantenimientos'] = totalMantenimientos;
                totalGeneral += totalMantenimientos;
            }
            
            // Combustible
            if (document.getElementById('pdfCombustible')?.checked) {
                const combustible = fuelRecords.filter(f => 
                    (center === 'all' || f.centro === center) &&
                    (month === 'all' || new Date(f.fecha).getMonth() + 1 == month) &&
                    new Date(f.fecha).getFullYear() == year
                );
                
                const totalCombustible = combustible.reduce((sum, f) => sum + parseFloat(f.costo || 0), 0);
                categorias['Combustible'] = totalCombustible;
                totalGeneral += totalCombustible;
            }
            
            // Lavados
            if (document.getElementById('pdfLavados')?.checked) {
                const lavadosFiltrados = lavados.filter(l => 
                    (center === 'all' || l.centro === center) &&
                    (month === 'all' || new Date(l.fecha).getMonth() + 1 == month) &&
                    new Date(l.fecha).getFullYear() == year
                );
                
                const totalLavados = lavadosFiltrados.reduce((sum, l) => sum + parseFloat(l.costo || 0), 0);
                categorias['Lavados'] = totalLavados;
                totalGeneral += totalLavados;
            }
            
            // Gasoil
            if (document.getElementById('pdfGasoil')?.checked) {
                const gasoilFiltrado = gasoilRecords.filter(g => 
                    (center === 'all' || g.centro === center) &&
                    (month === 'all' || new Date(g.fecha).getMonth() + 1 == month) &&
                    new Date(g.fecha).getFullYear() == year
                );
                
                const totalGasoil = gasoilFiltrado.reduce((sum, g) => sum + parseFloat(g.costo || 0), 0);
                categorias['Gasoil Head End'] = totalGasoil;
                totalGeneral += totalGasoil;
            }
            
            let html = '';
            Object.entries(categorias).forEach(([categoria, monto]) => {
                const porcentaje = totalGeneral > 0 ? ((monto / totalGeneral) * 100).toFixed(1) : '0.0';
                html += `
                    <div class="flex justify-between items-center mb-1">
                        <span class="text-gray-600 text-sm">${categoria}</span>
                        <div class="flex items-center space-x-2">
                            <span class="font-semibold text-sm">$${monto.toFixed(2)}</span>
                            <span class="text-xs text-gray-500">${porcentaje}%</span>
                        </div>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2 mb-3">
                        <div class="bg-inter-primary h-2 rounded-full" style="width: ${porcentaje}%"></div>
                    </div>
                `;
            });
            
            element.innerHTML = html;
        }

        // Vista previa del reporte PDF
        function previewPDFReport() {
            const previewContent = document.getElementById('previewContent');
            if (!previewContent) return;
            
            const year = currentFilterYear;
            const month = currentFilterMonth;
            const center = currentFilterCenter;
            const tipoReporte = document.getElementById('pdfTipoReporte')?.value || 'completo';
            
            // Obtener datos
            const summaryData = getSummaryData();
            const detailedData = getDetailedData();
            const distributionData = getDistributionData();
            
            // Generar HTML para la vista previa
            let html = `
                <div style="font-family: Arial, sans-serif; padding: 10px; font-size: 12px;">
                    <h1 style="color: #005BAA; text-align: center; margin-bottom: 5px; font-size: 16px;">
                        Reporte de Gastos - Gestión de Flota
                    </h1>
                    
                    <div style="text-align: center; margin-bottom: 10px; color: #666; font-size: 10px;">
                        <p><strong>Período:</strong> ${month === 'all' ? `Año ${year}` : `Mes ${month}/${year}`}</p>
                        <p><strong>Centro:</strong> ${center === 'all' ? 'Todos los centros' : center}</p>
                        <p><strong>Tipo de Reporte:</strong> ${getTipoReporteNombre(tipoReporte)}</p>
                        <p><strong>Fecha de Generación:</strong> ${new Date().toLocaleDateString()}</p>
                    </div>
                    
                    <hr style="margin: 10px 0; border: 1px solid #eee;">
            `;
            
            // Resumen ejecutivo
            if (document.getElementById('pdfResumen')?.checked) {
                html += `
                    <h2 style="color: #005BAA; margin-top: 10px; margin-bottom: 5px; font-size: 14px;">Resumen Ejecutivo</h2>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 10px;">
                        <div style="background-color: #dcfce7; padding: 8px; border-radius: 6px; text-align: center;">
                            <h3 style="color: #166534; margin: 0 0 5px 0; font-size: 10px;">Total Pagado</h3>
                            <p style="font-size: 14px; font-weight: bold; color: #166534; margin: 0;">$${summaryData.totalPagado.toFixed(2)}</p>
                        </div>
                        <div style="background-color: #fef3c7; padding: 8px; border-radius: 6px; text-align: center;">
                            <h3 style="color: #92400e; margin: 0 0 5px 0; font-size: 10px;">Total Pendiente</h3>
                            <p style="font-size: 14px; font-weight: bold; color: #92400e; margin: 0;">$${summaryData.totalPendiente.toFixed(2)}</p>
                        </div>
                        <div style="background-color: #dbeafe; padding: 8px; border-radius: 6px; text-align: center;">
                            <h3 style="color: #1e40af; margin: 0 0 5px 0; font-size: 10px;">Total General</h3>
                            <p style="font-size: 14px; font-weight: bold; color: #1e40af; margin: 0;">$${summaryData.totalGeneral.toFixed(2)}</p>
                        </div>
                    </div>
                `;
            }
            
            // Distribución por categoría
            if (distributionData.length > 0) {
                html += `
                    <h2 style="color: #005BAA; margin-top: 10px; margin-bottom: 5px; font-size: 14px;">Distribución por Categoría</h2>
                    <table style="width: 100%; border-collapse: collapse; margin-bottom: 10px; font-size: 10px;">
                        <thead>
                            <tr style="background-color: #f3f4f6;">
                                <th style="border: 1px solid #ddd; padding: 6px; text-align: left;">Categoría</th>
                                <th style="border: 1px solid #ddd; padding: 6px; text-align: right;">Monto</th>
                                <th style="border: 1px solid #ddd; padding: 6px; text-align: right;">Porcentaje</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                distributionData.forEach(item => {
                    html += `
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 6px;">${item.categoria}</td>
                            <td style="border: 1px solid #ddd; padding: 6px; text-align: right;">$${item.monto.toFixed(2)}</td>
                            <td style="border: 1px solid #ddd; padding: 6px; text-align: right;">${item.porcentaje}%</td>
                        </tr>
                    `;
                });
                
                html += `
                        </tbody>
                    </table>
                `;
            }
            
            // Detalle por vehículo
            if (document.getElementById('pdfDetalle')?.checked && detailedData.length > 0) {
                html += `
                    <h2 style="color: #005BAA; margin-top: 10px; margin-bottom: 5px; font-size: 14px;">Detalle de Gastos</h2>
                    <table style="width: 100%; border-collapse: collapse; margin-bottom: 10px; font-size: 9px;">
                        <thead>
                            <tr style="background-color: #f3f4f6;">
                                <th style="border: 1px solid #ddd; padding: 5px; text-align: left;">Fecha</th>
                                <th style="border: 1px solid #ddd; padding: 5px; text-align: left;">Categoría</th>
                                <th style="border: 1px solid #ddd; padding: 5px; text-align: left;">Vehículo</th>
                                <th style="border: 1px solid #ddd; padding: 5px; text-align: left;">Descripción</th>
                                <th style="border: 1px solid #ddd; padding: 5px; text-align: left;">Centro</th>
                                <th style="border: 1px solid #ddd; padding: 5px; text-align: left;">Estado</th>
                                <th style="border: 1px solid #ddd; padding: 5px; text-align: right;">Monto</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                detailedData.forEach(item => {
                    const estadoStyle = item.estado === 'pagado' ? 
                        'background-color: #dcfce7; color: #166534; padding: 2px 5px; border-radius: 10px; font-size: 8px;' :
                        'background-color: #fef3c7; color: #92400e; padding: 2px 5px; border-radius: 10px; font-size: 8px;';
                    
                    html += `
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 5px;">${item.fecha}</td>
                            <td style="border: 1px solid #ddd; padding: 5px;">${item.categoria}</td>
                            <td style="border: 1px solid #ddd; padding: 5px;">${item.vehiculo}</td>
                            <td style="border: 1px solid #ddd; padding: 5px;">${item.descripcion}</td>
                            <td style="border: 1px solid #ddd; padding: 5px;">${item.centro}</td>
                            <td style="border: 1px solid #ddd; padding: 5px;">
                                <span style="${estadoStyle}">${item.estado.toUpperCase()}</span>
                            </td>
                            <td style="border: 1px solid #ddd; padding: 5px; text-align: right;">$${item.monto.toFixed(2)}</td>
                        </tr>
                    `;
                });
                
                html += `
                        </tbody>
                    </table>
                `;
            }
            
            // Sumatorias
            if (document.getElementById('pdfSumatorias')?.checked) {
                html += `
                    <h2 style="color: #005BAA; margin-top: 10px; margin-bottom: 5px; font-size: 14px;">Resumen de Sumatorias</h2>
                    <table style="width: 100%; border-collapse: collapse; margin-bottom: 10px; font-size: 10px;">
                        <tbody>
                            <tr>
                                <td style="border: 1px solid #ddd; padding: 6px; text-align: right; font-weight: bold;">Total Gastos Pagados:</td>
                                <td style="border: 1px solid #ddd; padding: 6px; text-align: right; color: #166534; font-weight: bold;">$${summaryData.totalPagado.toFixed(2)}</td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #ddd; padding: 6px; text-align: right; font-weight: bold;">Total Gastos Pendientes:</td>
                                <td style="border: 1px solid #ddd; padding: 6px; text-align: right; color: #92400e; font-weight: bold;">$${summaryData.totalPendiente.toFixed(2)}</td>
                            </tr>
                            <tr style="border-top: 2px solid #005BAA;">
                                <td style="border: 1px solid #ddd; padding: 6px; text-align: right; font-weight: bold;">TOTAL GENERAL:</td>
                                <td style="border: 1px solid #ddd; padding: 6px; text-align: right; color: #005BAA; font-weight: bold;">$${summaryData.totalGeneral.toFixed(2)}</td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }
            
            html += `
                    <hr style="margin: 10px 0; border: 1px solid #eee;">
                    <div style="text-align: center; color: #666; font-size: 8px; margin-top: 10px;">
                        <p>Reporte generado automáticamente por el Sistema de Gestión de Flota</p>
                        <p>© ${new Date().getFullYear()} - Todos los derechos reservados</p>
                    </div>
                </div>
            `;
            
            previewContent.innerHTML = html;
            document.getElementById('reportPreview').classList.remove('hidden');
        }

        // Obtener datos para el resumen
        function getSummaryData() {
            const year = currentFilterYear;
            const month = currentFilterMonth;
            const center = currentFilterCenter;
            
            let totalPagado = 0;
            let totalPendiente = 0;
            
            // Mantenimientos
            if (document.getElementById('pdfMantenimientos')?.checked) {
                const mantenimientosPagados = maintenances.filter(m => 
                    m.estadoPago === 'pagado' &&
                    (center === 'all' || m.centro === center) &&
                    (month === 'all' || new Date(m.fecha).getMonth() + 1 == month) &&
                    new Date(m.fecha).getFullYear() == year
                );
                
                const mantenimientosPendientes = maintenances.filter(m => 
                    m.estadoPago === 'pendiente' &&
                    (center === 'all' || m.centro === center) &&
                    (month === 'all' || new Date(m.fecha).getMonth() + 1 == month) &&
                    new Date(m.fecha).getFullYear() == year
                );
                
                totalPagado += mantenimientosPagados.reduce((sum, m) => sum + parseFloat(m.costo || 0), 0);
                totalPendiente += mantenimientosPendientes.reduce((sum, m) => sum + parseFloat(m.costo || 0), 0);
            }
            
            // Combustible
            if (document.getElementById('pdfCombustible')?.checked) {
                const combustiblePagado = fuelRecords.filter(f => 
                    f.estadoPago === 'pagado' &&
                    (center === 'all' || f.centro === center) &&
                    (month === 'all' || new Date(f.fecha).getMonth() + 1 == month) &&
                    new Date(f.fecha).getFullYear() == year
                );
                
                const combustiblePendiente = fuelRecords.filter(f => 
                    f.estadoPago === 'pendiente' &&
                    (center === 'all' || f.centro === center) &&
                    (month === 'all' || new Date(f.fecha).getMonth() + 1 == month) &&
                    new Date(f.fecha).getFullYear() == year
                );
                
                totalPagado += combustiblePagado.reduce((sum, f) => sum + parseFloat(f.costo || 0), 0);
                totalPendiente += combustiblePendiente.reduce((sum, f) => sum + parseFloat(f.costo || 0), 0);
            }
            
            // Lavados
            if (document.getElementById('pdfLavados')?.checked) {
                const lavadosPagados = lavados.filter(l => 
                    l.estadoPago === 'pagado' &&
                    (center === 'all' || l.centro === center) &&
                    (month === 'all' || new Date(l.fecha).getMonth() + 1 == month) &&
                    new Date(l.fecha).getFullYear() == year
                );
                
                const lavadosPendientes = lavados.filter(l => 
                    l.estadoPago === 'pendiente' &&
                    (center === 'all' || l.centro === center) &&
                    (month === 'all' || new Date(l.fecha).getMonth() + 1 == month) &&
                    new Date(l.fecha).getFullYear() == year
                );
                
                totalPagado += lavadosPagados.reduce((sum, l) => sum + parseFloat(l.costo || 0), 0);
                totalPendiente += lavadosPendientes.reduce((sum, l) => sum + parseFloat(l.costo || 0), 0);
            }
            
            // Gasoil
            if (document.getElementById('pdfGasoil')?.checked) {
                const gasoilPagado = gasoilRecords.filter(g => 
                    g.estadoPago === 'pagado' &&
                    (center === 'all' || g.centro === center) &&
                    (month === 'all' || new Date(g.fecha).getMonth() + 1 == month) &&
                    new Date(g.fecha).getFullYear() == year
                );
                
                const gasoilPendiente = gasoilRecords.filter(g => 
                    g.estadoPago === 'pendiente' &&
                    (center === 'all' || g.centro === center) &&
                    (month === 'all' || new Date(g.fecha).getMonth() + 1 == month) &&
                    new Date(g.fecha).getFullYear() == year
                );
                
                totalPagado += gasoilPagado.reduce((sum, g) => sum + parseFloat(g.costo || 0), 0);
                totalPendiente += gasoilPendiente.reduce((sum, g) => sum + parseFloat(g.costo || 0), 0);
            }
            
            const totalGeneral = totalPagado + totalPendiente;
            
            return {
                totalPagado,
                totalPendiente,
                totalGeneral
            };
        }

        // Obtener datos detallados
        function getDetailedData() {
            const year = currentFilterYear;
            const month = currentFilterMonth;
            const center = currentFilterCenter;
            const tipoReporte = document.getElementById('pdfTipoReporte')?.value || 'completo';
            
            let allExpenses = [];
            
            // Agregar mantenimientos si están seleccionados
            if (document.getElementById('pdfMantenimientos')?.checked) {
                const mantenimientosFiltrados = maintenances.filter(m => 
                    (center === 'all' || m.centro === center) &&
                    (month === 'all' || new Date(m.fecha).getMonth() + 1 == month) &&
                    new Date(m.fecha).getFullYear() == year
                );
                
                mantenimientosFiltrados.forEach(m => {
                    allExpenses.push({
                        fecha: formatearFecha(m.fecha),
                        categoria: `Mantenimiento ${m.tipo}`,
                        vehiculo: m.placa,
                        descripcion: m.descripcion || 'Sin descripción',
                        centro: m.centro,
                        estado: m.estadoPago,
                        monto: parseFloat(m.costo || 0),
                        tipo: 'mantenimiento'
                    });
                });
            }
            
            // Agregar combustible si está seleccionado
            if (document.getElementById('pdfCombustible')?.checked) {
                const combustibleFiltrado = fuelRecords.filter(f => 
                    (center === 'all' || f.centro === center) &&
                    (month === 'all' || new Date(f.fecha).getMonth() + 1 == month) &&
                    new Date(f.fecha).getFullYear() == year
                );
                
                combustibleFiltrado.forEach(f => {
                    allExpenses.push({
                        fecha: formatearFecha(f.fecha),
                        categoria: 'Combustible',
                        vehiculo: f.placa,
                        descripcion: `${f.litros} litros`,
                        centro: f.centro,
                        estado: f.estadoPago,
                        monto: parseFloat(f.costo || 0),
                        tipo: 'combustible'
                    });
                });
            }
            
            // Agregar lavados si están seleccionados
            if (document.getElementById('pdfLavados')?.checked) {
                const lavadosFiltrados = lavados.filter(l => 
                    (center === 'all' || l.centro === center) &&
                    (month === 'all' || new Date(l.fecha).getMonth() + 1 == month) &&
                    new Date(l.fecha).getFullYear() == year
                );
                
                lavadosFiltrados.forEach(l => {
                    allExpenses.push({
                        fecha: formatearFecha(l.fecha),
                        categoria: 'Lavado',
                        vehiculo: l.placa,
                        descripcion: 'Lavado de vehículo',
                        centro: l.centro,
                        estado: l.estadoPago,
                        monto: parseFloat(l.costo || 0),
                        tipo: 'lavado'
                    });
                });
            }
            
            // Agregar gasoil si está seleccionado
            if (document.getElementById('pdfGasoil')?.checked) {
                const gasoilFiltrado = gasoilRecords.filter(g => 
                    (center === 'all' || g.centro === center) &&
                    (month === 'all' || new Date(g.fecha).getMonth() + 1 == month) &&
                    new Date(g.fecha).getFullYear() == year
                );
                
                gasoilFiltrado.forEach(g => {
                    allExpenses.push({
                        fecha: formatearFecha(g.fecha),
                        categoria: 'Gasoil Head End',
                        vehiculo: g.placa,
                        descripcion: `${g.litros} litros + flete $${g.flete}`,
                        centro: g.centro,
                        estado: g.estadoPago,
                        monto: parseFloat(g.costo || 0),
                        tipo: 'gasoil'
                    });
                });
            }
            
            // Ordenar por fecha (más reciente primero)
            allExpenses.sort((a, b) => {
                const dateA = new Date(a.fecha.split('/').reverse().join('-'));
                const dateB = new Date(b.fecha.split('/').reverse().join('-'));
                return dateB - dateA;
            });
            
            // Filtrar según el tipo de reporte
            if (tipoReporte === 'pagados') {
                return allExpenses.filter(e => e.estado === 'pagado');
            } else if (tipoReporte === 'pendientes') {
                return allExpenses.filter(e => e.estado === 'pendiente');
            }
            
            return allExpenses;
        }

        // Obtener datos de distribución
        function getDistributionData() {
            const year = currentFilterYear;
            const month = currentFilterMonth;
            const center = currentFilterCenter;
            
            let categorias = {};
            let totalGeneral = 0;
            
            // Mantenimientos
            if (document.getElementById('pdfMantenimientos')?.checked) {
                const mantenimientos = maintenances.filter(m => 
                    (center === 'all' || m.centro === center) &&
                    (month === 'all' || new Date(m.fecha).getMonth() + 1 == month) &&
                    new Date(m.fecha).getFullYear() == year
                );
                
                const totalMantenimientos = mantenimientos.reduce((sum, m) => sum + parseFloat(m.costo || 0), 0);
                categorias['Mantenimientos'] = totalMantenimientos;
                totalGeneral += totalMantenimientos;
            }
            
            // Combustible
            if (document.getElementById('pdfCombustible')?.checked) {
                const combustible = fuelRecords.filter(f => 
                    (center === 'all' || f.centro === center) &&
                    (month === 'all' || new Date(f.fecha).getMonth() + 1 == month) &&
                    new Date(f.fecha).getFullYear() == year
                );
                
                const totalCombustible = combustible.reduce((sum, f) => sum + parseFloat(f.costo || 0), 0);
                categorias['Combustible'] = totalCombustible;
                totalGeneral += totalCombustible;
            }
            
            // Lavados
            if (document.getElementById('pdfLavados')?.checked) {
                const lavadosFiltrados = lavados.filter(l => 
                    (center === 'all' || l.centro === center) &&
                    (month === 'all' || new Date(l.fecha).getMonth() + 1 == month) &&
                    new Date(l.fecha).getFullYear() == year
                );
                
                const totalLavados = lavadosFiltrados.reduce((sum, l) => sum + parseFloat(l.costo || 0), 0);
                categorias['Lavados'] = totalLavados;
                totalGeneral += totalLavados;
            }
            
            // Gasoil
            if (document.getElementById('pdfGasoil')?.checked) {
                const gasoilFiltrado = gasoilRecords.filter(g => 
                    (center === 'all' || g.centro === center) &&
                    (month === 'all' || new Date(g.fecha).getMonth() + 1 == month) &&
                    new Date(g.fecha).getFullYear() == year
                );
                
                const totalGasoil = gasoilFiltrado.reduce((sum, g) => sum + parseFloat(g.costo || 0), 0);
                categorias['Gasoil Head End'] = totalGasoil;
                totalGeneral += totalGasoil;
            }
            
            const distributionData = [];
            Object.entries(categorias).forEach(([categoria, monto]) => {
                const porcentaje = totalGeneral > 0 ? ((monto / totalGeneral) * 100).toFixed(1) : '0.0';
                distributionData.push({
                    categoria,
                    monto,
                    porcentaje
                });
            });
            
            return distributionData;
        }

        function getTipoReporteNombre(tipo) {
            switch(tipo) {
                case 'completo': return 'Reporte Completo';
                case 'pagados': return 'Solo Pagados';
                case 'pendientes': return 'Solo Pendientes';
                case 'detallado': return 'Detallado por Categoría';
                default: return 'Reporte Completo';
            }
        }

        // Función para generar PDF
        function generatePDFReport() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            const year = currentFilterYear;
            const month = currentFilterMonth;
            const center = currentFilterCenter;
            const tipoReporte = document.getElementById('pdfTipoReporte')?.value || 'completo';
            
            // Obtener datos
            const summaryData = getSummaryData();
            const detailedData = getDetailedData();
            const distributionData = getDistributionData();
            
            // Configurar PDF
            doc.setFontSize(16);
            doc.setTextColor(0, 91, 170);
            doc.text('Reporte de Gastos - Gestión de Flota', 105, 15, { align: 'center' });
            
            doc.setFontSize(10);
            doc.setTextColor(100, 100, 100);
            doc.text(`Período: ${month === 'all' ? `Año ${year}` : `Mes ${month}/${year}`}`, 20, 25);
            doc.text(`Centro: ${center === 'all' ? 'Todos los centros' : center}`, 20, 30);
            doc.text(`Tipo de Reporte: ${getTipoReporteNombre(tipoReporte)}`, 20, 35);
            doc.text(`Fecha de Generación: ${new Date().toLocaleDateString()}`, 20, 40);
            
            let yPosition = 50;
            
            // Resumen ejecutivo
            if (document.getElementById('pdfResumen')?.checked) {
                doc.setFontSize(14);
                doc.setTextColor(0, 91, 170);
                doc.text('Resumen Ejecutivo', 20, yPosition);
                yPosition += 10;
                
                doc.setFontSize(10);
                doc.setTextColor(0, 0, 0);
                
                // Total Pagado
                doc.setFillColor(220, 252, 231);
                doc.roundedRect(20, yPosition, 55, 20, 3, 3, 'F');
                doc.setTextColor(22, 101, 52);
                doc.setFontSize(8);
                doc.text('Total Pagado', 25, yPosition + 7);
                doc.setFontSize(12);
                doc.text(`$${summaryData.totalPagado.toFixed(2)}`, 25, yPosition + 15);
                
                // Total Pendiente
                doc.setFillColor(254, 243, 199);
                doc.roundedRect(80, yPosition, 55, 20, 3, 3, 'F');
                doc.setTextColor(146, 64, 14);
                doc.setFontSize(8);
                doc.text('Total Pendiente', 85, yPosition + 7);
                doc.setFontSize(12);
                doc.text(`$${summaryData.totalPendiente.toFixed(2)}`, 85, yPosition + 15);
                
                // Total General
                doc.setFillColor(219, 234, 254);
                doc.roundedRect(140, yPosition, 55, 20, 3, 3, 'F');
                doc.setTextColor(30, 64, 175);
                doc.setFontSize(8);
                doc.text('Total General', 145, yPosition + 7);
                doc.setFontSize(12);
                doc.text(`$${summaryData.totalGeneral.toFixed(2)}`, 145, yPosition + 15);
                
                yPosition += 30;
            }
            
            // Distribución por categoría
            if (distributionData.length > 0) {
                doc.setFontSize(14);
                doc.setTextColor(0, 91, 170);
                doc.text('Distribución por Categoría', 20, yPosition);
                yPosition += 10;
                
                doc.setFontSize(10);
                doc.setTextColor(0, 0, 0);
                
                // Encabezados de tabla
                doc.setFillColor(243, 244, 246);
                doc.rect(20, yPosition, 175, 10, 'F');
                doc.setTextColor(100, 100, 100);
                doc.text('Categoría', 25, yPosition + 7);
                doc.text('Monto', 125, yPosition + 7);
                doc.text('Porcentaje', 155, yPosition + 7);
                
                yPosition += 10;
                
                // Filas de datos
                distributionData.forEach(item => {
                    if (yPosition > 270) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    
                    doc.setTextColor(0, 0, 0);
                    doc.text(item.categoria, 25, yPosition + 7);
                    doc.text(`$${item.monto.toFixed(2)}`, 125, yPosition + 7);
                    doc.text(`${item.porcentaje}%`, 155, yPosition + 7);
                    
                    yPosition += 10;
                });
                
                yPosition += 5;
            }
            
            // Detalle por vehículo
            if (document.getElementById('pdfDetalle')?.checked && detailedData.length > 0) {
                if (yPosition > 250) {
                    doc.addPage();
                    yPosition = 20;
                }
                
                doc.setFontSize(14);
                doc.setTextColor(0, 91, 170);
                doc.text('Detalle de Gastos', 20, yPosition);
                yPosition += 10;
                
                doc.setFontSize(8);
                doc.setTextColor(0, 0, 0);
                
                // Encabezados de tabla
                doc.setFillColor(243, 244, 246);
                doc.rect(20, yPosition, 175, 8, 'F');
                doc.setTextColor(100, 100, 100);
                doc.text('Fecha', 22, yPosition + 5);
                doc.text('Categoría', 40, yPosition + 5);
                doc.text('Vehículo', 70, yPosition + 5);
                doc.text('Descripción', 90, yPosition + 5);
                doc.text('Centro', 140, yPosition + 5);
                doc.text('Estado', 155, yPosition + 5);
                doc.text('Monto', 175, yPosition + 5);
                
                yPosition += 8;
                
                // Filas de datos
                detailedData.forEach((item, index) => {
                    if (yPosition > 280) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    
                    doc.setTextColor(0, 0, 0);
                    doc.text(item.fecha, 22, yPosition + 5);
                    doc.text(item.categoria, 40, yPosition + 5);
                    doc.text(item.vehiculo, 70, yPosition + 5);
                    
                    // Truncar descripción si es muy larga
                    const descripcion = item.descripcion.length > 30 ? 
                        item.descripcion.substring(0, 27) + '...' : item.descripcion;
                    doc.text(descripcion, 90, yPosition + 5);
                    
                    doc.text(item.centro, 140, yPosition + 5);
                    
                    // Estado con color
                    if (item.estado === 'pagado') {
                        doc.setTextColor(22, 101, 52);
                    } else {
                        doc.setTextColor(146, 64, 14);
                    }
                    doc.text(item.estado.toUpperCase(), 155, yPosition + 5);
                    
                    doc.setTextColor(0, 0, 0);
                    doc.text(`$${item.monto.toFixed(2)}`, 175, yPosition + 5);
                    
                    yPosition += 8;
                });
                
                yPosition += 5;
            }
            
            // Sumatorias
            if (document.getElementById('pdfSumatorias')?.checked) {
                if (yPosition > 270) {
                    doc.addPage();
                    yPosition = 20;
                }
                
                doc.setFontSize(14);
                doc.setTextColor(0, 91, 170);
                doc.text('Resumen de Sumatorias', 20, yPosition);
                yPosition += 10;
                
                doc.setFontSize(10);
                
                // Total Pagado
                doc.setTextColor(0, 0, 0);
                doc.text('Total Gastos Pagados:', 120, yPosition + 5);
                doc.setTextColor(22, 101, 52);
                doc.text(`$${summaryData.totalPagado.toFixed(2)}`, 185, yPosition + 5);
                yPosition += 8;
                
                // Total Pendiente
                doc.setTextColor(0, 0, 0);
                doc.text('Total Gastos Pendientes:', 120, yPosition + 5);
                doc.setTextColor(146, 64, 14);
                doc.text(`$${summaryData.totalPendiente.toFixed(2)}`, 185, yPosition + 5);
                yPosition += 8;
                
                // Total General
                doc.setDrawColor(0, 91, 170);
                doc.setLineWidth(0.5);
                doc.line(20, yPosition, 195, yPosition);
                yPosition += 5;
                
                doc.setTextColor(0, 0, 0);
                doc.setFontSize(12);
                doc.text('TOTAL GENERAL:', 120, yPosition + 5);
                doc.setTextColor(0, 91, 170);
                doc.setFontSize(14);
                doc.text(`$${summaryData.totalGeneral.toFixed(2)}`, 185, yPosition + 5);
                
                yPosition += 15;
            }
            
            // Pie de página
            if (document.getElementById('pdfFechaGeneracion')?.checked) {
                doc.setFontSize(8);
                doc.setTextColor(100, 100, 100);
                doc.text('Reporte generado automáticamente por el Sistema de Gestión de Flota', 105, 285, { align: 'center' });
                doc.text(`© ${new Date().getFullYear()} - Todos los derechos reservados`, 105, 290, { align: 'center' });
            }
            
            // Guardar PDF
            const fileName = `reporte_gastos_${year}_${month === 'all' ? 'anual' : `mes_${month}`}_${center === 'all' ? 'todos_centros' : center}.pdf`;
            doc.save(fileName);
        }

        // Función para generar Excel
        function generateExcelReport() {
            const year = currentFilterYear;
            const month = currentFilterMonth;
            const center = currentFilterCenter;
            
            // Obtener datos detallados
            const detailedData = getDetailedData();
            
            if (detailedData.length === 0) {
                alert('No hay datos para exportar.');
                return;
            }
            
            // Preparar datos para Excel
            const excelData = detailedData.map(item => ({
                'Fecha': item.fecha,
                'Categoría': item.categoria,
                'Vehículo': item.vehiculo,
                'Descripción': item.descripcion,
                'Centro': item.centro,
                'Estado': item.estado.toUpperCase(),
                'Monto': `$${item.monto.toFixed(2)}`
            }));
            
            // Crear hoja de cálculo
            const ws = XLSX.utils.json_to_sheet(excelData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Gastos');
            
            // Nombre del archivo
            const fileName = `reporte_gastos_${year}_${month === 'all' ? 'anual' : `mes_${month}`}_${center === 'all' ? 'todos_centros' : center}.xlsx`;
            
            // Descargar archivo
            XLSX.writeFile(wb, fileName);
        }
    </script>
</body>
</html>
